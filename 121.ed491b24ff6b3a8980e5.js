(self.webpackChunkmessenger=self.webpackChunkmessenger||[]).push([[121],{5452:(Rt,Ve,X)=>{"use strict";X.d(Ve,{Jn:()=>Zt,qX:()=>xe,Xd:()=>De,Mq:()=>dt,ZF:()=>Tt,KN:()=>yt});var E=X(6034),V=X(300),me=X(4685);class m{constructor(se){this.container=se}getPlatformInfoString(){return this.container.getProviders().map(Ce=>{if(function(de){const se=de.getComponent();return"VERSION"===(null==se?void 0:se.type)}(Ce)){const He=Ce.getImmediate();return`${He.library}/${He.version}`}return null}).filter(Ce=>Ce).join(" ")}}const Ue="@firebase/app",Se=new V.Yd("@firebase/app"),Te="[DEFAULT]",je={[Ue]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},ie=new Map,ce=new Map;function ze(de,se){try{de.container.addComponent(se)}catch(Ce){Se.debug(`Component ${se.name} failed to register with FirebaseApp ${de.name}`,Ce)}}function De(de){const se=de.name;if(ce.has(se))return Se.debug(`There were multiple attempts to register component ${se}.`),!1;ce.set(se,de);for(const Ce of ie.values())ze(Ce,de);return!0}function xe(de,se){return de.container.getProvider(se)}const qe=new me.LL("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function."});class ft{constructor(se,Ce,He){this._isDeleted=!1,this._options=Object.assign({},se),this._config=Object.assign({},Ce),this._name=Ce.name,this._automaticDataCollectionEnabled=Ce.automaticDataCollectionEnabled,this._container=He,this.container.addComponent(new E.wA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(se){this.checkDestroyed(),this._automaticDataCollectionEnabled=se}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(se){this._isDeleted=se}checkDestroyed(){if(this.isDeleted)throw qe.create("app-deleted",{appName:this._name})}}const Zt="9.0.0";function Tt(de,se={}){"object"!=typeof se&&(se={name:se});const Ce=Object.assign({name:Te,automaticDataCollectionEnabled:!1},se),He=Ce.name;if("string"!=typeof He||!He)throw qe.create("bad-app-name",{appName:String(He)});const tt=ie.get(He);if(tt){if((0,me.vZ)(de,tt.options)&&(0,me.vZ)(Ce,tt.config))return tt;throw qe.create("duplicate-app",{appName:He})}const wt=new E.H0(He);for(const _t of ce.values())wt.addComponent(_t);const Ke=new ft(de,Ce,wt);return ie.set(He,Ke),Ke}function dt(de=Te){const se=ie.get(de);if(!se)throw qe.create("no-app",{appName:de});return se}function yt(de,se,Ce){var He;let tt=null!==(He=je[de])&&void 0!==He?He:de;Ce&&(tt+=`-${Ce}`);const wt=tt.match(/\s|\//),Ke=se.match(/\s|\//);if(wt||Ke){const _t=[`Unable to register library "${tt}" with version "${se}":`];return wt&&_t.push(`library name "${tt}" contains illegal characters (whitespace or "/")`),wt&&Ke&&_t.push("and"),Ke&&_t.push(`version name "${se}" contains illegal characters (whitespace or "/")`),void Se.warn(_t.join(" "))}De(new E.wA(`${tt}-version`,()=>({library:tt,version:se}),"VERSION"))}De(new E.wA("platform-logger",se=>new m(se),"PRIVATE")),yt(Ue,"0.7.0",undefined),yt("fire-js","")},3128:(Rt,Ve,X)=>{"use strict";X.d(Ve,{Xb:()=>xo,v0:()=>Ta,e5:()=>Do,w7:()=>mi});var E=X(8239),V=X(4685),me=X(5452),m=X(4762),Ie=X(300),Ue=X(6034);const we=new V.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Z=new Ie.Yd("@firebase/auth");function ee(a,...r){Z.logLevel<=Ie.in.ERROR&&Z.error(`Auth (${me.Jn}): ${a}`,...r)}function te(a,...r){throw he(a,...r)}function ne(a,...r){return he(a,...r)}function he(a,...r){if("string"!=typeof a){const s=r[0],l=[...r.slice(1)];return l[0]&&(l[0].appName=a.name),a._errorFactory.create(s,...l)}return we.create(a,...r)}function x(a,r,...s){if(!a)throw he(r,...s)}function Qe(a){const r="INTERNAL ASSERTION FAILED: "+a;throw ee(r),new Error(r)}function Ee(a,r){a||Qe(r)}const Be=new Map;function P(a){Ee(a instanceof Function,"Expected a class definition");let r=Be.get(a);return r?(Ee(r instanceof a,"Instance stored in cache mismatched with class"),r):(r=new a,Be.set(a,r),r)}function M(){var a;return"undefined"!=typeof self&&(null===(a=self.location)||void 0===a?void 0:a.href)||""}function G(){var a;return"undefined"!=typeof self&&(null===(a=self.location)||void 0===a?void 0:a.protocol)||null}class je{constructor(r,s){this.shortDelay=r,this.longDelay=s,Ee(s>r,"Short delay should be less than long delay!"),this.isMobile=(0,V.uI)()||(0,V.b$)()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===G()||"https:"===G()||(0,V.ru)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function ie(a,r){Ee(a.emulator,"Emulator should always be set here");const{url:s}=a.emulator;return r?`${s}${r.startsWith("/")?r.slice(1):r}`:s}class ce{static initialize(r,s,l){this.fetchImpl=r,s&&(this.headersImpl=s),l&&(this.responseImpl=l)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void Qe("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void Qe("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void Qe("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const ze={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded"},$e=new je(3e4,6e4);function De(a,r){return a.tenantId&&!r.tenantId?Object.assign(Object.assign({},r),{tenantId:a.tenantId}):r}function xe(a,r,s,l){return Pt.apply(this,arguments)}function Pt(){return(Pt=(0,E.Z)(function*(a,r,s,l,d={}){return cn(a,d,()=>{let p={},b={};l&&("GET"===r?b=l:p={body:JSON.stringify(l)});const U=(0,V.xO)(Object.assign({key:a.config.apiKey},b)).slice(1),J=new(ce.headers());return J.set("Content-Type","application/json"),J.set("X-Client-Version",a._getSdkClientVersion()),a.languageCode&&J.set("X-Firebase-Locale",a.languageCode),ce.fetch()(Zt(a,a.config.apiHost,s,U),Object.assign({method:r,headers:J,referrerPolicy:"no-referrer"},p))})})).apply(this,arguments)}function cn(a,r,s){return it.apply(this,arguments)}function it(){return(it=(0,E.Z)(function*(a,r,s){a._canInitEmulator=!1;const l=Object.assign(Object.assign({},ze),r);try{const d=new Tt(a),p=yield Promise.race([s(),d.promise]);d.clearNetworkTimeout();const b=yield p.json();if("needConfirmation"in b)throw dt(a,"account-exists-with-different-credential",b);if(p.ok&&!("errorMessage"in b))return b;{const J=(p.ok?b.errorMessage:b.error.message).split(" : ")[0];if("FEDERATED_USER_ID_ALREADY_LINKED"===J)throw dt(a,"credential-already-in-use",b);if("EMAIL_EXISTS"===J)throw dt(a,"email-already-in-use",b);te(a,l[J]||J.toLowerCase().replace(/[_\s]+/g,"-"))}}catch(d){if(d instanceof V.ZR)throw d;te(a,"network-request-failed")}})).apply(this,arguments)}function qe(a,r,s,l){return ft.apply(this,arguments)}function ft(){return(ft=(0,E.Z)(function*(a,r,s,l,d={}){const p=yield xe(a,r,s,l,d);return"mfaPendingCredential"in p&&te(a,"multi-factor-auth-required",{serverResponse:p}),p})).apply(this,arguments)}function Zt(a,r,s,l){const d=`${r}${s}?${l}`;return a.config.emulator?ie(a.config,d):`${a.config.apiScheme}://${d}`}class Tt{constructor(r){this.auth=r,this.timer=null,this.promise=new Promise((s,l)=>{this.timer=setTimeout(()=>l(ne(this.auth,"timeout")),$e.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function dt(a,r,s){const l={appName:a.name};s.email&&(l.email=s.email),s.phoneNumber&&(l.phoneNumber=s.phoneNumber);const d=ne(a,r,l);return d.customData._tokenResponse=s,d}function gt(){return(gt=(0,E.Z)(function*(a,r){return xe(a,"POST","/v1/accounts:delete",r)})).apply(this,arguments)}function Qt(a,r){return jt.apply(this,arguments)}function jt(){return(jt=(0,E.Z)(function*(a,r){return xe(a,"POST","/v1/accounts:lookup",r)})).apply(this,arguments)}function ht(a){if(a)try{const r=new Date(Number(a));if(!isNaN(r.getTime()))return r.toUTCString()}catch(r){}}function Ce(){return(Ce=(0,E.Z)(function*(a,r=!1){const s=(0,V.m9)(a),l=yield s.getIdToken(r),d=tt(l);x(d&&d.exp&&d.auth_time&&d.iat,s.auth,"internal-error");const p="object"==typeof d.firebase?d.firebase:void 0,b=null==p?void 0:p.sign_in_provider;return{claims:d,token:l,authTime:ht(He(d.auth_time)),issuedAtTime:ht(He(d.iat)),expirationTime:ht(He(d.exp)),signInProvider:b||null,signInSecondFactor:(null==p?void 0:p.sign_in_second_factor)||null}})).apply(this,arguments)}function He(a){return 1e3*Number(a)}function tt(a){const[r,s,l]=a.split(".");if(void 0===r||void 0===s||void 0===l)return ee("JWT malformed, contained fewer than 3 sections"),null;try{const d=(0,V.tV)(s);return d?JSON.parse(d):(ee("Failed to decode base64 JWT payload"),null)}catch(d){return ee("Caught error parsing JWT payload as JSON",d),null}}function Ke(a,r){return _t.apply(this,arguments)}function _t(){return(_t=(0,E.Z)(function*(a,r,s=!1){if(s)return r;try{return yield r}catch(l){throw l instanceof V.ZR&&hn(l)&&a.auth.currentUser===a&&(yield a.auth.signOut()),l}})).apply(this,arguments)}function hn({code:a}){return"auth/user-disabled"===a||"auth/user-token-expired"===a}class Gn{constructor(r){this.user=r,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){!this.isRunning||(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(r){var s;if(r){const l=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),l}{this.errorBackoff=3e4;const d=(null!==(s=this.user.stsTokenManager.expirationTime)&&void 0!==s?s:0)-Date.now()-3e5;return Math.max(0,d)}}schedule(r=!1){var s=this;if(!this.isRunning)return;const l=this.getInterval(r);this.timerId=setTimeout((0,E.Z)(function*(){yield s.iteration()}),l)}iteration(){var r=this;return(0,E.Z)(function*(){try{yield r.user.getIdToken(!0)}catch(s){return void("auth/network-request-failed"===s.code&&r.schedule(!0))}r.schedule()})()}}class Jt{constructor(r,s){this.createdAt=r,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=ht(this.lastLoginAt),this.creationTime=ht(this.createdAt)}_copy(r){this.createdAt=r.createdAt,this.lastLoginAt=r.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function Nt(a){return Xt.apply(this,arguments)}function Xt(){return(Xt=(0,E.Z)(function*(a){var r;const s=a.auth,l=yield a.getIdToken(),d=yield Ke(a,Qt(s,{idToken:l}));x(null==d?void 0:d.users.length,s,"internal-error");const p=d.users[0];a._notifyReloadListener(p);const b=(null===(r=p.providerUserInfo)||void 0===r?void 0:r.length)?I(p.providerUserInfo):[],U=fn(a.providerData,b),ve=!!a.isAnonymous&&!(a.email&&p.passwordHash||(null==U?void 0:U.length)),et={uid:p.localId,displayName:p.displayName||null,photoURL:p.photoUrl||null,email:p.email||null,emailVerified:p.emailVerified||!1,phoneNumber:p.phoneNumber||null,tenantId:p.tenantId||null,providerData:U,metadata:new Jt(p.createdAt,p.lastLoginAt),isAnonymous:ve};Object.assign(a,et)})).apply(this,arguments)}function wn(){return(wn=(0,E.Z)(function*(a){const r=(0,V.m9)(a);yield Nt(r),yield r.auth._persistUserIfCurrent(r),r.auth._notifyListenersIfCurrent(r)})).apply(this,arguments)}function fn(a,r){return[...a.filter(l=>!r.some(d=>d.providerId===l.providerId)),...r]}function I(a){return a.map(r=>{var{providerId:s}=r,l=(0,m._T)(r,["providerId"]);return{providerId:s,uid:l.rawId||"",displayName:l.displayName||null,email:l.email||null,phoneNumber:l.phoneNumber||null,photoURL:l.photoUrl||null}})}function C(){return(C=(0,E.Z)(function*(a,r){const s=yield cn(a,{},()=>{const l=(0,V.xO)({grant_type:"refresh_token",refresh_token:r}).slice(1),{tokenApiHost:d,apiKey:p}=a.config,b=Zt(a,d,"/v1/token",`key=${p}`);return ce.fetch()(b,{method:"POST",headers:{"X-Client-Version":a._getSdkClientVersion(),"Content-Type":"application/x-www-form-urlencoded"},body:l})});return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}})).apply(this,arguments)}class S{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(r){x(r.idToken,"internal-error"),x(void 0!==r.idToken,"internal-error"),x(void 0!==r.refreshToken,"internal-error");const s="expiresIn"in r&&void 0!==r.expiresIn?Number(r.expiresIn):function(a){const r=tt(a);return x(r,"internal-error"),x(void 0!==r.exp,"internal-error"),x(void 0!==r.iat,"internal-error"),Number(r.exp)-Number(r.iat)}(r.idToken);this.updateTokensAndExpiration(r.idToken,r.refreshToken,s)}getToken(r,s=!1){var l=this;return(0,E.Z)(function*(){return x(!l.accessToken||l.refreshToken,r,"user-token-expired"),s||!l.accessToken||l.isExpired?l.refreshToken?(yield l.refresh(r,l.refreshToken),l.accessToken):null:l.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(r,s){var l=this;return(0,E.Z)(function*(){const{accessToken:d,refreshToken:p,expiresIn:b}=yield function(a,r){return C.apply(this,arguments)}(r,s);l.updateTokensAndExpiration(d,p,Number(b))})()}updateTokensAndExpiration(r,s,l){this.refreshToken=s||null,this.accessToken=r||null,this.expirationTime=Date.now()+1e3*l}static fromJSON(r,s){const{refreshToken:l,accessToken:d,expirationTime:p}=s,b=new S;return l&&(x("string"==typeof l,"internal-error",{appName:r}),b.refreshToken=l),d&&(x("string"==typeof d,"internal-error",{appName:r}),b.accessToken=d),p&&(x("number"==typeof p,"internal-error",{appName:r}),b.expirationTime=p),b}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(r){this.accessToken=r.accessToken,this.refreshToken=r.refreshToken,this.expirationTime=r.expirationTime}_clone(){return Object.assign(new S,this.toJSON())}_performRefresh(){return Qe("not implemented")}}function T(a,r){x("string"==typeof a||void 0===a,"internal-error",{appName:r})}class j{constructor(r){var{uid:s,auth:l,stsTokenManager:d}=r,p=(0,m._T)(r,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.emailVerified=!1,this.isAnonymous=!1,this.tenantId=null,this.providerData=[],this.proactiveRefresh=new Gn(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=s,this.auth=l,this.stsTokenManager=d,this.accessToken=d.accessToken,this.displayName=p.displayName||null,this.email=p.email||null,this.phoneNumber=p.phoneNumber||null,this.photoURL=p.photoURL||null,this.isAnonymous=p.isAnonymous||!1,this.metadata=new Jt(p.createdAt||void 0,p.lastLoginAt||void 0)}getIdToken(r){var s=this;return(0,E.Z)(function*(){const l=yield Ke(s,s.stsTokenManager.getToken(s.auth,r));return x(l,s.auth,"internal-error"),s.accessToken!==l&&(s.accessToken=l,yield s.auth._persistUserIfCurrent(s),s.auth._notifyListenersIfCurrent(s)),l})()}getIdTokenResult(r){return function(a){return Ce.apply(this,arguments)}(this,r)}reload(){return function(a){return wn.apply(this,arguments)}(this)}_assign(r){this!==r&&(x(this.uid===r.uid,this.auth,"internal-error"),this.displayName=r.displayName,this.photoURL=r.photoURL,this.email=r.email,this.emailVerified=r.emailVerified,this.phoneNumber=r.phoneNumber,this.isAnonymous=r.isAnonymous,this.tenantId=r.tenantId,this.providerData=r.providerData.map(s=>Object.assign({},s)),this.metadata._copy(r.metadata),this.stsTokenManager._assign(r.stsTokenManager))}_clone(r){return new j(Object.assign(Object.assign({},this),{auth:r,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(r){x(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=r,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(r){this.reloadListener?this.reloadListener(r):this.reloadUserInfo=r}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(r,s=!1){var l=this;return(0,E.Z)(function*(){let d=!1;r.idToken&&r.idToken!==l.stsTokenManager.accessToken&&(l.stsTokenManager.updateFromServerResponse(r),d=!0),s&&(yield Nt(l)),yield l.auth._persistUserIfCurrent(l),d&&l.auth._notifyListenersIfCurrent(l)})()}delete(){var r=this;return(0,E.Z)(function*(){const s=yield r.getIdToken();return yield Ke(r,function(a,r){return gt.apply(this,arguments)}(r.auth,{idToken:s})),r.stsTokenManager.clearRefreshToken(),r.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(r=>Object.assign({},r)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(r,s){var l,d,p,b,U,J,oe,ve;const et=null!==(l=s.displayName)&&void 0!==l?l:void 0,St=null!==(d=s.email)&&void 0!==d?d:void 0,Bt=null!==(p=s.phoneNumber)&&void 0!==p?p:void 0,Gi=null!==(b=s.photoURL)&&void 0!==b?b:void 0,Wn=null!==(U=s.tenantId)&&void 0!==U?U:void 0,Ls=null!==(J=s._redirectEventId)&&void 0!==J?J:void 0,Fs=null!==(oe=s.createdAt)&&void 0!==oe?oe:void 0,Us=null!==(ve=s.lastLoginAt)&&void 0!==ve?ve:void 0,{uid:Vi,emailVerified:qr,isAnonymous:Bi,providerData:Kr,stsTokenManager:bo}=s;x(Vi&&bo,r,"internal-error");const wa=S.fromJSON(this.name,bo);x("string"==typeof Vi,r,"internal-error"),T(et,r.name),T(St,r.name),x("boolean"==typeof qr,r,"internal-error"),x("boolean"==typeof Bi,r,"internal-error"),T(Bt,r.name),T(Gi,r.name),T(Wn,r.name),T(Ls,r.name),T(Fs,r.name),T(Us,r.name);const Yr=new j({uid:Vi,auth:r,email:St,emailVerified:qr,displayName:et,isAnonymous:Bi,photoURL:Gi,phoneNumber:Bt,tenantId:Wn,stsTokenManager:wa,createdAt:Fs,lastLoginAt:Us});return Kr&&Array.isArray(Kr)&&(Yr.providerData=Kr.map(Ca=>Object.assign({},Ca))),Ls&&(Yr._redirectEventId=Ls),Yr}static _fromIdTokenResponse(r,s,l=!1){return(0,E.Z)(function*(){const d=new S;d.updateFromServerResponse(s);const p=new j({uid:s.localId,auth:r,stsTokenManager:d,isAnonymous:l});return yield Nt(p),p})()}}const Pe=(()=>{class a{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,E.Z)(function*(){return!0})()}_set(s,l){var d=this;return(0,E.Z)(function*(){d.storage[s]=l})()}_get(s){var l=this;return(0,E.Z)(function*(){const d=l.storage[s];return void 0===d?null:d})()}_remove(s){var l=this;return(0,E.Z)(function*(){delete l.storage[s]})()}_addListener(s,l){}_removeListener(s,l){}}return a.type="NONE",a})();function ke(a,r,s){return`firebase:${a}:${r}:${s}`}class Re{constructor(r,s,l){this.persistence=r,this.auth=s,this.userKey=l;const{config:d,name:p}=this.auth;this.fullUserKey=ke(this.userKey,d.apiKey,p),this.fullPersistenceKey=ke("persistence",d.apiKey,p),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(r){return this.persistence._set(this.fullUserKey,r.toJSON())}getCurrentUser(){var r=this;return(0,E.Z)(function*(){const s=yield r.persistence._get(r.fullUserKey);return s?j._fromJSON(r.auth,s):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(r){var s=this;return(0,E.Z)(function*(){if(s.persistence===r)return;const l=yield s.getCurrentUser();return yield s.removeCurrentUser(),s.persistence=r,l?s.setCurrentUser(l):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(r,s,l="authUser"){return(0,E.Z)(function*(){if(!s.length)return new Re(P(Pe),r,l);const d=(yield Promise.all(s.map(function(){var oe=(0,E.Z)(function*(ve){if(yield ve._isAvailable())return ve});return function(ve){return oe.apply(this,arguments)}}()))).filter(oe=>oe);let p=d[0]||P(Pe);const b=ke(l,r.config.apiKey,r.name);let U=null;for(const oe of s)try{const ve=yield oe._get(b);if(ve){const et=j._fromJSON(r,ve);oe!==p&&(U=et),p=oe;break}}catch(ve){}const J=d.filter(oe=>oe._shouldAllowMigration);return p._shouldAllowMigration&&J.length?(p=J[0],U&&(yield p._set(b,U.toJSON())),yield Promise.all(s.map(function(){var oe=(0,E.Z)(function*(ve){if(ve!==p)try{yield ve._remove(b)}catch(et){}});return function(ve){return oe.apply(this,arguments)}}())),new Re(p,r,l)):new Re(p,r,l)})()}}function st(a){const r=a.toLowerCase();if(r.includes("opera/")||r.includes("opr/")||r.includes("opios/"))return"Opera";if(pn(r))return"IEMobile";if(r.includes("msie")||r.includes("trident/"))return"IE";if(r.includes("edge/"))return"Edge";if(ot(r))return"Firefox";if(r.includes("silk/"))return"Silk";if(kt(r))return"Blackberry";if(Bn(r))return"Webos";if(rt(r))return"Safari";if((r.includes("chrome/")||en(r))&&!r.includes("edge/"))return"Chrome";if(Jr(r))return"Android";{const l=a.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===(null==l?void 0:l.length))return l[1]}return"Other"}function ot(a=(0,V.z$)()){return/firefox\//i.test(a)}function rt(a=(0,V.z$)()){const r=a.toLowerCase();return r.includes("safari/")&&!r.includes("chrome/")&&!r.includes("crios/")&&!r.includes("android")}function en(a=(0,V.z$)()){return/crios\//i.test(a)}function pn(a=(0,V.z$)()){return/iemobile/i.test(a)}function Jr(a=(0,V.z$)()){return/android/i.test(a)}function kt(a=(0,V.z$)()){return/blackberry/i.test(a)}function Bn(a=(0,V.z$)()){return/webos/i.test(a)}function _n(a=(0,V.z$)()){return/iphone|ipad|ipod/i.test(a)}function cr(a=(0,V.z$)()){return _n(a)||Jr(a)||Bn(a)||kt(a)||/windows phone/i.test(a)||pn(a)}function Xr(a,r=[]){let s;switch(a){case"Browser":s=st((0,V.z$)());break;case"Worker":s=`${st((0,V.z$)())}-${a}`;break;default:s=a}const l=r.length?r.join(","):"FirebaseCore-web";return`${s}/JsCore/${me.Jn}/${l}`}class dr{constructor(r,s){this.app=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new jn(this),this.idTokenSubscription=new jn(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=we,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=r.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(r,s){var l=this;return s&&(this._popupRedirectResolver=P(s)),this._initializationPromise=this.queue((0,E.Z)(function*(){var d;l._deleted||(l.persistenceManager=yield Re.create(l,r),!l._deleted&&((null===(d=l._popupRedirectResolver)||void 0===d?void 0:d._shouldInitProactively)&&(yield l._popupRedirectResolver._initialize(l)),yield l.initializeCurrentUser(s),!l._deleted&&(l._isInitialized=!0)))})),this._initializationPromise}_onStorageEvent(){var r=this;return(0,E.Z)(function*(){if(r._deleted)return;const s=yield r.assertedPersistence.getCurrentUser();if(r.currentUser||s){if(r.currentUser&&s&&r.currentUser.uid===s.uid)return r._currentUser._assign(s),void(yield r.currentUser.getIdToken());yield r._updateCurrentUser(s)}})()}initializeCurrentUser(r){var s=this;return(0,E.Z)(function*(){var l;let d=yield s.assertedPersistence.getCurrentUser();if(r&&s.config.authDomain){yield s.getOrInitRedirectPersistenceManager();const p=null===(l=s.redirectUser)||void 0===l?void 0:l._redirectEventId,b=null==d?void 0:d._redirectEventId,U=yield s.tryRedirectSignIn(r);(!p||p===b)&&(null==U?void 0:U.user)&&(d=U.user)}return d?d._redirectEventId?(x(s._popupRedirectResolver,s,"argument-error"),yield s.getOrInitRedirectPersistenceManager(),s.redirectUser&&s.redirectUser._redirectEventId===d._redirectEventId?s.directlySetCurrentUser(d):s.reloadAndSetCurrentUserOrClear(d)):s.reloadAndSetCurrentUserOrClear(d):s.directlySetCurrentUser(null)})()}tryRedirectSignIn(r){var s=this;return(0,E.Z)(function*(){let l=null;try{l=yield s._popupRedirectResolver._completeRedirectFn(s,r,!0)}catch(d){yield s._setRedirectUser(null)}return l})()}reloadAndSetCurrentUserOrClear(r){var s=this;return(0,E.Z)(function*(){try{yield Nt(r)}catch(l){if("auth/network-request-failed"!==l.code)return s.directlySetCurrentUser(null)}return s.directlySetCurrentUser(r)})()}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const a=navigator;return a.languages&&a.languages[0]||a.language||null}()}_delete(){var r=this;return(0,E.Z)(function*(){r._deleted=!0})()}updateCurrentUser(r){var s=this;return(0,E.Z)(function*(){const l=r?(0,V.m9)(r):null;return l&&x(l.auth.config.apiKey===s.config.apiKey,s,"invalid-user-token"),s._updateCurrentUser(l&&l._clone(s))})()}_updateCurrentUser(r){var s=this;return(0,E.Z)(function*(){if(!s._deleted)return r&&x(s.tenantId===r.tenantId,s,"tenant-id-mismatch"),s.queue((0,E.Z)(function*(){yield s.directlySetCurrentUser(r),s.notifyAuthListeners()}))})()}signOut(){var r=this;return(0,E.Z)(function*(){return(r.redirectPersistenceManager||r._popupRedirectResolver)&&(yield r._setRedirectUser(null)),r._updateCurrentUser(null)})()}setPersistence(r){var s=this;return this.queue((0,E.Z)(function*(){yield s.assertedPersistence.setPersistence(P(r))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(r){this._errorFactory=new V.LL("auth","Firebase",r())}onAuthStateChanged(r,s,l){return this.registerStateListener(this.authStateSubscription,r,s,l)}onIdTokenChanged(r,s,l){return this.registerStateListener(this.idTokenSubscription,r,s,l)}toJSON(){var r;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(r=this._currentUser)||void 0===r?void 0:r.toJSON()}}_setRedirectUser(r,s){var l=this;return(0,E.Z)(function*(){const d=yield l.getOrInitRedirectPersistenceManager(s);return null===r?d.removeCurrentUser():d.setCurrentUser(r)})()}getOrInitRedirectPersistenceManager(r){var s=this;return(0,E.Z)(function*(){if(!s.redirectPersistenceManager){const l=r&&P(r)||s._popupRedirectResolver;x(l,s,"argument-error"),s.redirectPersistenceManager=yield Re.create(s,[P(l._redirectPersistence)],"redirectUser"),s.redirectUser=yield s.redirectPersistenceManager.getCurrentUser()}return s.redirectPersistenceManager})()}_redirectUserForId(r){var s=this;return(0,E.Z)(function*(){var l,d;return s._isInitialized&&(yield s.queue((0,E.Z)(function*(){}))),(null===(l=s._currentUser)||void 0===l?void 0:l._redirectEventId)===r?s._currentUser:(null===(d=s.redirectUser)||void 0===d?void 0:d._redirectEventId)===r?s.redirectUser:null})()}_persistUserIfCurrent(r){var s=this;return(0,E.Z)(function*(){if(r===s.currentUser)return s.queue((0,E.Z)(function*(){return s.directlySetCurrentUser(r)}))})()}_notifyListenersIfCurrent(r){r===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var r,s;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const l=null!==(s=null===(r=this.currentUser)||void 0===r?void 0:r.uid)&&void 0!==s?s:null;this.lastNotifiedUid!==l&&(this.lastNotifiedUid=l,this.authStateSubscription.next(this.currentUser))}registerStateListener(r,s,l,d){if(this._deleted)return()=>{};const p="function"==typeof s?s:s.next.bind(s),b=this._isInitialized?Promise.resolve():this._initializationPromise;return x(b,this,"internal-error"),b.then(()=>p(this.currentUser)),"function"==typeof s?r.addObserver(s,l,d):r.addObserver(s)}directlySetCurrentUser(r){var s=this;return(0,E.Z)(function*(){s.currentUser&&s.currentUser!==r&&(s._currentUser._stopProactiveRefresh(),r&&s.isProactiveRefreshEnabled&&r._startProactiveRefresh()),s.currentUser=r,r?yield s.assertedPersistence.setCurrentUser(r):yield s.assertedPersistence.removeCurrentUser()})()}queue(r){return this.operations=this.operations.then(r,r),this.operations}get assertedPersistence(){return x(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(r){!r||this.frameworks.includes(r)||(this.frameworks.push(r),this.frameworks.sort(),this.clientVersion=Xr(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getSdkClientVersion(){return this.clientVersion}}function at(a){return(0,V.m9)(a)}class jn{constructor(r){this.auth=r,this.observer=null,this.addObserver=(0,V.ne)(s=>this.observer=s)}get next(){return x(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}class hr{constructor(r,s){this.providerId=r,this.signInMethod=s}toJSON(){return Qe("not implemented")}_getIdTokenResponse(r){return Qe("not implemented")}_linkToIdToken(r,s){return Qe("not implemented")}_getReauthenticationResolver(r){return Qe("not implemented")}}function Je(){return(Je=(0,E.Z)(function*(a,r){return xe(a,"POST","/v1/accounts:update",r)})).apply(this,arguments)}function Kn(){return(Kn=(0,E.Z)(function*(a,r){return qe(a,"POST","/v1/accounts:signInWithPassword",De(a,r))})).apply(this,arguments)}function _e(){return(_e=(0,E.Z)(function*(a,r){return qe(a,"POST","/v1/accounts:signInWithEmailLink",De(a,r))})).apply(this,arguments)}function gr(){return(gr=(0,E.Z)(function*(a,r){return qe(a,"POST","/v1/accounts:signInWithEmailLink",De(a,r))})).apply(this,arguments)}class Ot extends hr{constructor(r,s,l,d=null){super("password",l),this._email=r,this._password=s,this._tenantId=d}static _fromEmailAndPassword(r,s){return new Ot(r,s,"password")}static _fromEmailAndCode(r,s,l=null){return new Ot(r,s,"emailLink",l)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(r){const s="string"==typeof r?JSON.parse(r):r;if((null==s?void 0:s.email)&&(null==s?void 0:s.password)){if("password"===s.signInMethod)return this._fromEmailAndPassword(s.email,s.password);if("emailLink"===s.signInMethod)return this._fromEmailAndCode(s.email,s.password,s.tenantId)}return null}_getIdTokenResponse(r){var s=this;return(0,E.Z)(function*(){switch(s.signInMethod){case"password":return function(a,r){return Kn.apply(this,arguments)}(r,{returnSecureToken:!0,email:s._email,password:s._password});case"emailLink":return function(a,r){return _e.apply(this,arguments)}(r,{email:s._email,oobCode:s._password});default:te(r,"internal-error")}})()}_linkToIdToken(r,s){var l=this;return(0,E.Z)(function*(){switch(l.signInMethod){case"password":return function(a,r){return Je.apply(this,arguments)}(r,{idToken:s,returnSecureToken:!0,email:l._email,password:l._password});case"emailLink":return function(a,r){return gr.apply(this,arguments)}(r,{idToken:s,email:l._email,oobCode:l._password});default:te(r,"internal-error")}})()}_getReauthenticationResolver(r){return this._getIdTokenResponse(r)}}function Ye(a,r){return An.apply(this,arguments)}function An(){return(An=(0,E.Z)(function*(a,r){return qe(a,"POST","/v1/accounts:signInWithIdp",De(a,r))})).apply(this,arguments)}class pe{constructor(r){var s,l,d,p,b,U;const J=(0,V.zd)((0,V.pd)(r)),oe=null!==(s=J.apiKey)&&void 0!==s?s:null,ve=null!==(l=J.oobCode)&&void 0!==l?l:null,et=function(a){switch(a){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(d=J.mode)&&void 0!==d?d:null);x(oe&&ve&&et,"argument-error"),this.apiKey=oe,this.operation=et,this.code=ve,this.continueUrl=null!==(p=J.continueUrl)&&void 0!==p?p:null,this.languageCode=null!==(b=J.languageCode)&&void 0!==b?b:null,this.tenantId=null!==(U=J.tenantId)&&void 0!==U?U:null}static parseLink(r){const s=function(a){const r=(0,V.zd)((0,V.pd)(a)).link,s=r?(0,V.zd)((0,V.pd)(r)).deep_link_id:null,l=(0,V.zd)((0,V.pd)(a)).deep_link_id;return(l?(0,V.zd)((0,V.pd)(l)).link:null)||l||s||r||a}(r);try{return new pe(s)}catch(l){return null}}}let Mt=(()=>{class a{constructor(){this.providerId=a.PROVIDER_ID}static credential(s,l){return Ot._fromEmailAndPassword(s,l)}static credentialWithLink(s,l){const d=pe.parseLink(l);return x(d,"argument-error"),Ot._fromEmailAndCode(s,d.code,d.tenantId)}}return a.PROVIDER_ID="password",a.EMAIL_PASSWORD_SIGN_IN_METHOD="password",a.EMAIL_LINK_SIGN_IN_METHOD="emailLink",a})();class It{constructor(r){this.providerId=r,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(r){this.defaultLanguageCode=r}setCustomParameters(r){return this.customParameters=r,this}getCustomParameters(){return this.customParameters}}class Lt extends It{constructor(){super(...arguments),this.scopes=[]}addScope(r){return this.scopes.includes(r)||this.scopes.push(r),this}getScopes(){return[...this.scopes]}}function Rn(a,r){return Jn.apply(this,arguments)}function Jn(){return(Jn=(0,E.Z)(function*(a,r){return qe(a,"POST","/v1/accounts:signUp",De(a,r))})).apply(this,arguments)}class Xe{constructor(r){this.user=r.user,this.providerId=r.providerId,this._tokenResponse=r._tokenResponse,this.operationType=r.operationType}static _fromIdTokenResponse(r,s,l,d=!1){return(0,E.Z)(function*(){const p=yield j._fromIdTokenResponse(r,l,d),b=wr(l);return new Xe({user:p,providerId:b,_tokenResponse:l,operationType:s})})()}static _forOperation(r,s,l){return(0,E.Z)(function*(){yield r._updateTokensIfNecessary(l,!0);const d=wr(l);return new Xe({user:r,providerId:d,_tokenResponse:l,operationType:s})})()}}function wr(a){return a.providerId?a.providerId:"phoneNumber"in a?"phone":null}class gn extends V.ZR{constructor(r,s,l,d){var p;super(s.code,s.message),this.operationType=l,this.user=d,this.name="FirebaseError",Object.setPrototypeOf(this,gn.prototype),this.appName=r.name,this.code=s.code,this.tenantId=null!==(p=r.tenantId)&&void 0!==p?p:void 0,this.serverResponse=s.customData.serverResponse}static _fromErrorAndOperation(r,s,l,d){return new gn(r,s,l,d)}}function Ki(a,r,s,l){return("reauthenticate"===r?s._getReauthenticationResolver(a):s._getIdTokenResponse(a)).catch(p=>{throw"auth/multi-factor-auth-required"===p.code?gn._fromErrorAndOperation(a,p,r,l):p})}function yn(a,r){return Pn.apply(this,arguments)}function Pn(){return(Pn=(0,E.Z)(function*(a,r,s=!1){const l=yield Ke(a,r._linkToIdToken(a.auth,yield a.getIdToken()),s);return Xe._forOperation(a,"link",l)})).apply(this,arguments)}function _(){return(_=(0,E.Z)(function*(a,r,s=!1){const{auth:l}=a,d="reauthenticate";try{const p=yield Ke(a,Ki(l,d,r,a),s);x(p.idToken,l,"internal-error");const b=tt(p.idToken);x(b,l,"internal-error");const{sub:U}=b;return x(a.uid===U,l,"user-mismatch"),Xe._forOperation(a,d,p)}catch(p){throw"auth/user-not-found"===(null==p?void 0:p.code)&&te(l,"user-mismatch"),p}})).apply(this,arguments)}function w(a,r){return N.apply(this,arguments)}function N(){return(N=(0,E.Z)(function*(a,r,s=!1){const l="signIn",d=yield Ki(a,l,r),p=yield Xe._fromIdTokenResponse(a,l,d);return s||(yield a._updateCurrentUser(p.user)),p})).apply(this,arguments)}function W(){return(W=(0,E.Z)(function*(a,r){return w(at(a),r)})).apply(this,arguments)}function xo(a,r,s){return Sr.apply(this,arguments)}function Sr(){return(Sr=(0,E.Z)(function*(a,r,s){const l=at(a),d=yield Rn(l,{returnSecureToken:!0,email:r,password:s}),p=yield Xe._fromIdTokenResponse(l,"signIn",d);return yield l._updateCurrentUser(p.user),p})).apply(this,arguments)}function Do(a,r,s){return function(a,r){return W.apply(this,arguments)}((0,V.m9)(a),Mt.credential(r,s))}function mi(a){return(0,V.m9)(a).signOut()}new WeakMap;const Vt="__sak";class gi{constructor(r,s){this.storage=r,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(Vt,"1"),this.storage.removeItem(Vt),Promise.resolve(!0)):Promise.resolve(!1)}catch(r){return Promise.resolve(!1)}}_set(r,s){return this.storage.setItem(r,JSON.stringify(s)),Promise.resolve()}_get(r){const s=this.storage.getItem(r);return Promise.resolve(s?JSON.parse(s):null)}_remove(r){return this.storage.removeItem(r),Promise.resolve()}}const Go=(()=>{class a extends gi{constructor(){super(window.localStorage,"LOCAL"),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const a=(0,V.z$)();return rt(a)||_n(a)}()&&function(){try{return!(!window||window===window.top)}catch(a){return!1}}(),this.fallbackToPolling=cr(),this._shouldAllowMigration=!0,this.boundEventHandler=this.onStorageEvent.bind(this)}forAllChangedKeys(s){for(const l of Object.keys(this.listeners)){const d=this.storage.getItem(l),p=this.localCache[l];d!==p&&s(l,p,d)}}onStorageEvent(s,l=!1){if(!s.key)return void this.forAllChangedKeys((U,J,oe)=>{this.notifyListeners(U,oe)});const d=s.key;if(l?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const U=this.storage.getItem(d);if(s.newValue!==U)null!==s.newValue?this.storage.setItem(d,s.newValue):this.storage.removeItem(d);else if(this.localCache[d]===s.newValue&&!l)return}const p=()=>{const U=this.storage.getItem(d);!l&&this.localCache[d]===U||this.notifyListeners(d,U)},b=this.storage.getItem(d);(0,V.w1)()&&10===document.documentMode&&b!==s.newValue&&s.newValue!==s.oldValue?setTimeout(p,10):p()}notifyListeners(s,l){this.localCache[s]=l;const d=this.listeners[s];if(d)for(const p of Array.from(d))p(l&&JSON.parse(l))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((s,l,d)=>{this.onStorageEvent(new StorageEvent("storage",{key:s,oldValue:l,newValue:d}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(s,l){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[s]||(this.listeners[s]=new Set,this.localCache[s]=this.storage.getItem(s)),this.listeners[s].add(l)}_removeListener(s,l){this.listeners[s]&&(this.listeners[s].delete(l),0===this.listeners[s].size&&delete this.listeners[s]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(s,l){var d=()=>super._set,p=this;return(0,E.Z)(function*(){yield d().call(p,s,l),p.localCache[s]=JSON.stringify(l)})()}_get(s){var l=()=>super._get,d=this;return(0,E.Z)(function*(){const p=yield l().call(d,s);return d.localCache[s]=JSON.stringify(p),p})()}_remove(s){var l=()=>super._remove,d=this;return(0,E.Z)(function*(){yield l().call(d,s),delete d.localCache[s]})()}}return a.type="LOCAL",a})(),Zs=(()=>{class a extends gi{constructor(){super(window.sessionStorage,"SESSION")}_addListener(s,l){}_removeListener(s,l){}}return a.type="SESSION",a})();let Bo=(()=>{class a{constructor(s){this.eventTarget=s,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(s){const l=this.receivers.find(p=>p.isListeningto(s));if(l)return l;const d=new a(s);return this.receivers.push(d),d}isListeningto(s){return this.eventTarget===s}handleEvent(s){var l=this;return(0,E.Z)(function*(){const d=s,{eventId:p,eventType:b,data:U}=d.data,J=l.handlersMap[b];if(!(null==J?void 0:J.size))return;d.ports[0].postMessage({status:"ack",eventId:p,eventType:b});const oe=Array.from(J).map(function(){var et=(0,E.Z)(function*(St){return St(d.origin,U)});return function(St){return et.apply(this,arguments)}}()),ve=yield function(a){return Promise.all(a.map(function(){var r=(0,E.Z)(function*(s){try{return{fulfilled:!0,value:yield s}}catch(l){return{fulfilled:!1,reason:l}}});return function(s){return r.apply(this,arguments)}}()))}(oe);d.ports[0].postMessage({status:"done",eventId:p,eventType:b,response:ve})})()}_subscribe(s,l){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[s]||(this.handlersMap[s]=new Set),this.handlersMap[s].add(l)}_unsubscribe(s,l){this.handlersMap[s]&&l&&this.handlersMap[s].delete(l),(!l||0===this.handlersMap[s].size)&&delete this.handlersMap[s],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return a.receivers=[],a})();function os(a="",r=10){let s="";for(let l=0;l<r;l++)s+=Math.floor(10*Math.random());return a+s}class Qs{constructor(r){this.target=r,this.handlers=new Set}removeMessageHandler(r){r.messageChannel&&(r.messageChannel.port1.removeEventListener("message",r.onMessage),r.messageChannel.port1.close()),this.handlers.delete(r)}_send(r,s,l=50){var d=this;return(0,E.Z)(function*(){const p="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!p)throw new Error("connection_unavailable");let b,U;return new Promise((J,oe)=>{const ve=os("",20);p.port1.start();const et=setTimeout(()=>{oe(new Error("unsupported_event"))},l);U={messageChannel:p,onMessage(St){const Bt=St;if(Bt.data.eventId===ve)switch(Bt.data.status){case"ack":clearTimeout(et),b=setTimeout(()=>{oe(new Error("timeout"))},3e3);break;case"done":clearTimeout(b),J(Bt.data.response);break;default:clearTimeout(et),clearTimeout(b),oe(new Error("invalid_response"))}}},d.handlers.add(U),p.port1.addEventListener("message",U.onMessage),d.target.postMessage({eventType:r,eventId:ve,data:s},[p.port2])}).finally(()=>{U&&d.removeMessageHandler(U)})})()}}function nt(){return window}function as(){return void 0!==nt().WorkerGlobalScope&&"function"==typeof nt().importScripts}function ls(){return(ls=(0,E.Z)(function*(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(yield navigator.serviceWorker.ready).active}catch(a){return null}})).apply(this,arguments)}const xr="firebaseLocalStorageDb",Dr="firebaseLocalStorage",Mr="fbase_key";class Lr{constructor(r){this.request=r}toPromise(){return new Promise((r,s)=>{this.request.addEventListener("success",()=>{r(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function ir(a,r){return a.transaction([Dr],r?"readwrite":"readonly").objectStore(Dr)}function vi(){const a=indexedDB.open(xr,1);return new Promise((r,s)=>{a.addEventListener("error",()=>{s(a.error)}),a.addEventListener("upgradeneeded",()=>{const l=a.result;try{l.createObjectStore(Dr,{keyPath:Mr})}catch(d){s(d)}}),a.addEventListener("success",(0,E.Z)(function*(){const l=a.result;l.objectStoreNames.contains(Dr)?r(l):(l.close(),yield function(){const a=indexedDB.deleteDatabase(xr);return new Lr(a).toPromise()}(),r(yield vi()))}))})}function Xs(a,r,s){return cs.apply(this,arguments)}function cs(){return(cs=(0,E.Z)(function*(a,r,s){const l=ir(a,!0).put({[Mr]:r,value:s});return new Lr(l).toPromise()})).apply(this,arguments)}function Fr(){return(Fr=(0,E.Z)(function*(a,r){const s=ir(a,!1).get(r),l=yield new Lr(s).toPromise();return void 0===l?null:l.value})).apply(this,arguments)}function to(a,r){const s=ir(a,!0).delete(r);return new Lr(s).toPromise()}const no=(()=>{class a{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var s=this;return(0,E.Z)(function*(){return s.db||(s.db=yield vi()),s.db})()}_withRetries(s){var l=this;return(0,E.Z)(function*(){let d=0;for(;;)try{const p=yield l._openDb();return yield s(p)}catch(p){if(d++>3)throw p;l.db&&(l.db.close(),l.db=void 0)}})()}initializeServiceWorkerMessaging(){var s=this;return(0,E.Z)(function*(){return as()?s.initializeReceiver():s.initializeSender()})()}initializeReceiver(){var s=this;return(0,E.Z)(function*(){s.receiver=Bo._getInstance(as()?self:null),s.receiver._subscribe("keyChanged",function(){var l=(0,E.Z)(function*(d,p){return{keyProcessed:(yield s._poll()).includes(p.key)}});return function(d,p){return l.apply(this,arguments)}}()),s.receiver._subscribe("ping",function(){var l=(0,E.Z)(function*(d,p){return["keyChanged"]});return function(d,p){return l.apply(this,arguments)}}())})()}initializeSender(){var s=this;return(0,E.Z)(function*(){var l,d;if(s.activeServiceWorker=yield function(){return ls.apply(this,arguments)}(),!s.activeServiceWorker)return;s.sender=new Qs(s.activeServiceWorker);const p=yield s.sender._send("ping",{},800);!p||(null===(l=p[0])||void 0===l?void 0:l.fulfilled)&&(null===(d=p[0])||void 0===d?void 0:d.value.includes("keyChanged"))&&(s.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(s){var l=this;return(0,E.Z)(function*(){if(l.sender&&l.activeServiceWorker&&function(){var a;return(null===(a=null==navigator?void 0:navigator.serviceWorker)||void 0===a?void 0:a.controller)||null}()===l.activeServiceWorker)try{yield l.sender._send("keyChanged",{key:s},l.serviceWorkerReceiverAvailable?800:50)}catch(d){}})()}_isAvailable(){return(0,E.Z)(function*(){try{if(!indexedDB)return!1;const s=yield vi();return yield Xs(s,Vt,"1"),yield to(s,Vt),!0}catch(s){}return!1})()}_withPendingWrite(s){var l=this;return(0,E.Z)(function*(){l.pendingWrites++;try{yield s()}finally{l.pendingWrites--}})()}_set(s,l){var d=this;return(0,E.Z)(function*(){return d._withPendingWrite((0,E.Z)(function*(){return yield d._withRetries(p=>Xs(p,s,l)),d.localCache[s]=l,d.notifyServiceWorker(s)}))})()}_get(s){var l=this;return(0,E.Z)(function*(){const d=yield l._withRetries(p=>function(a,r){return Fr.apply(this,arguments)}(p,s));return l.localCache[s]=d,d})()}_remove(s){var l=this;return(0,E.Z)(function*(){return l._withPendingWrite((0,E.Z)(function*(){return yield l._withRetries(d=>to(d,s)),delete l.localCache[s],l.notifyServiceWorker(s)}))})()}_poll(){var s=this;return(0,E.Z)(function*(){const l=yield s._withRetries(b=>{const U=ir(b,!1).getAll();return new Lr(U).toPromise()});if(!l)return[];if(0!==s.pendingWrites)return[];const d=[],p=new Set;for(const{fbase_key:b,value:U}of l)p.add(b),JSON.stringify(s.localCache[b])!==JSON.stringify(U)&&(s.notifyListeners(b,U),d.push(b));for(const b of Object.keys(s.localCache))s.localCache[b]&&!p.has(b)&&(s.notifyListeners(b,null),d.push(b));return d})()}notifyListeners(s,l){this.localCache[s]=l;const d=this.listeners[s];if(d)for(const p of Array.from(d))p(l)}startPolling(){var s=this;this.stopPolling(),this.pollTimer=setInterval((0,E.Z)(function*(){return s._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(s,l){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[s]||(this.listeners[s]=new Set,this._get(s)),this.listeners[s].add(l)}_removeListener(s,l){this.listeners[s]&&(this.listeners[s].delete(l),0===this.listeners[s].size&&delete this.listeners[s]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return a.type="LOCAL",a})();function so(a){return`__${a}${Math.floor(1e6*Math.random())}`}function Mn(a,r){return r?P(r):(x(a._popupRedirectResolver,a,"argument-error"),a._popupRedirectResolver)}so("rcb"),new je(3e4,6e4);class ms extends hr{constructor(r){super("custom","custom"),this.params=r}_getIdTokenResponse(r){return Ye(r,this._buildIdpRequest())}_linkToIdToken(r,s){return Ye(r,this._buildIdpRequest(s))}_getReauthenticationResolver(r){return Ye(r,this._buildIdpRequest())}_buildIdpRequest(r){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return r&&(s.idToken=r),s}}function ia(a){return w(a.auth,new ms(a),a.bypassAuthState)}function ho(a){const{auth:r,user:s}=a;return x(s,r,"internal-error"),function(a,r){return _.apply(this,arguments)}(s,new ms(a),a.bypassAuthState)}function gs(a){return ys.apply(this,arguments)}function ys(){return(ys=(0,E.Z)(function*(a){const{auth:r,user:s}=a;return x(s,r,"internal-error"),yn(s,new ms(a),a.bypassAuthState)})).apply(this,arguments)}new je(2e3,1e4);const Es=new Map;class or extends class{constructor(r,s,l,d,p=!1){this.auth=r,this.resolver=l,this.user=d,this.bypassAuthState=p,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){var r=this;return new Promise(function(){var s=(0,E.Z)(function*(l,d){r.pendingPromise={resolve:l,reject:d};try{r.eventManager=yield r.resolver._initialize(r.auth),yield r.onExecution(),r.eventManager.registerConsumer(r)}catch(p){r.reject(p)}});return function(l,d){return s.apply(this,arguments)}}())}onAuthEvent(r){var s=this;return(0,E.Z)(function*(){const{urlResponse:l,sessionId:d,postBody:p,tenantId:b,error:U,type:J}=r;if(U)return void s.reject(U);const oe={auth:s.auth,requestUri:l,sessionId:d,tenantId:b||void 0,postBody:p||void 0,user:s.user,bypassAuthState:s.bypassAuthState};try{s.resolve(yield s.getIdpTask(J)(oe))}catch(ve){s.reject(ve)}})()}onError(r){this.reject(r)}getIdpTask(r){switch(r){case"signInViaPopup":case"signInViaRedirect":return ia;case"linkViaPopup":case"linkViaRedirect":return gs;case"reauthViaPopup":case"reauthViaRedirect":return ho;default:te(this.auth,"internal-error")}}resolve(r){Ee(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(r),this.unregisterAndCleanUp()}reject(r){Ee(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(r),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}{constructor(r,s,l=!1){super(r,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,l),this.eventId=null}execute(){var r=()=>super.execute,s=this;return(0,E.Z)(function*(){let l=Es.get(s.auth._key());if(!l){try{const p=(yield function(a,r){return Ni.apply(this,arguments)}(s.resolver,s.auth))?yield r().call(s):null;l=()=>Promise.resolve(p)}catch(d){l=()=>Promise.reject(d)}Es.set(s.auth._key(),l)}return l()})()}onAuthEvent(r){var s=()=>super.onAuthEvent,l=this;return(0,E.Z)(function*(){if("signInViaRedirect"===r.type)return s().call(l,r);if("unknown"!==r.type){if(r.eventId){const d=yield l.auth._redirectUserForId(r.eventId);if(d)return l.user=d,s().call(l,r);l.resolve(null)}}else l.resolve(null)})()}onExecution(){return(0,E.Z)(function*(){})()}cleanUp(){}}function Ni(){return(Ni=(0,E.Z)(function*(a,r){const s=Oi(r),l="true"===(yield Gr(a)._get(s));return yield Gr(a)._remove(s),l})).apply(this,arguments)}function Gr(a){return P(a._redirectPersistence)}function Oi(a){return ke("pendingRedirect",a.config.apiKey,a.name)}function mo(a,r){return xi.apply(this,arguments)}function xi(){return(xi=(0,E.Z)(function*(a,r,s=!1){const l=at(a),d=Mn(l,r),b=yield new or(l,d,s).execute();return b&&!s&&(delete b.user._redirectEventId,yield l._persistUserIfCurrent(b.user),yield l._setRedirectUser(null,r)),b})).apply(this,arguments)}class Mi{constructor(r){this.auth=r,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(r){this.consumers.add(r),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,r)&&(this.sendToConsumer(this.queuedRedirectEvent,r),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(r){this.consumers.delete(r)}onEvent(r){if(this.hasEventBeenHandled(r))return!1;let s=!1;return this.consumers.forEach(l=>{this.isEventForConsumer(r,l)&&(s=!0,this.sendToConsumer(r,l),this.saveEventToCache(r))}),this.hasHandledPotentialRedirect||!function(a){switch(a.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Li(a);default:return!1}}(r)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=r,s=!0)),s}sendToConsumer(r,s){var l;if(r.error&&!Li(r)){const d=(null===(l=r.error.code)||void 0===l?void 0:l.split("auth/")[1])||"internal-error";s.onError(ne(this.auth,d))}else s.onAuthEvent(r)}isEventForConsumer(r,s){const l=null===s.eventId||!!r.eventId&&r.eventId===s.eventId;return s.filter.includes(r.type)&&l}hasEventBeenHandled(r){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Tn(r))}saveEventToCache(r){this.cachedEventUids.add(Tn(r)),this.lastProcessedEventTime=Date.now()}}function Tn(a){return[a.type,a.eventId,a.sessionId,a.tenantId].filter(r=>r).join("-")}function Li({type:a,error:r}){return"unknown"===a&&"auth/no-auth-event"===(null==r?void 0:r.code)}function la(a){return lr.apply(this,arguments)}function lr(){return(lr=(0,E.Z)(function*(a,r={}){return xe(a,"GET","/v1/projects",r)})).apply(this,arguments)}const yo=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ua=/^https?/;function Hr(){return(Hr=(0,E.Z)(function*(a){if(a.config.emulator)return;const{authorizedDomains:r}=yield la(a);for(const s of r)try{if(ca(s))return}catch(l){}te(a,"unauthorized-domain")})).apply(this,arguments)}function ca(a){const r=M(),{protocol:s,hostname:l}=new URL(r);if(a.startsWith("chrome-extension://")){const b=new URL(a);return""===b.hostname&&""===l?"chrome-extension:"===s&&a.replace("chrome-extension://","")===r.replace("chrome-extension://",""):"chrome-extension:"===s&&b.hostname===l}if(!ua.test(s))return!1;if(yo.test(a))return l===a;const d=a.replace(/\./g,"\\.");return new RegExp("^(.+\\."+d+"|"+d+")$","i").test(l)}const da=new je(3e4,6e4);function vo(){const a=nt().___jsl;if(null==a?void 0:a.H)for(const r of Object.keys(a.H))if(a.H[r].r=a.H[r].r||[],a.H[r].L=a.H[r].L||[],a.H[r].r=[...a.H[r].L],a.CP)for(let s=0;s<a.CP.length;s++)a.CP[s]=null}let Fn=null;function Io(a){return Fn=Fn||function(a){return new Promise((r,s)=>{var l,d,p;function b(){vo(),gapi.load("gapi.iframes",{callback:()=>{r(gapi.iframes.getContext())},ontimeout:()=>{vo(),s(ne(a,"network-request-failed"))},timeout:da.get()})}if(null===(d=null===(l=nt().gapi)||void 0===l?void 0:l.iframes)||void 0===d?void 0:d.Iframe)r(gapi.iframes.getContext());else{if(!(null===(p=nt().gapi)||void 0===p?void 0:p.load)){const U=so("iframefcb");return nt()[U]=()=>{gapi.load?b():s(ne(a,"network-request-failed"))},function(a){return new Promise((r,s)=>{const l=document.createElement("script");l.setAttribute("src",a),l.onload=r,l.onerror=d=>{const p=ne("internal-error");p.customData=d,s(p)},l.type="text/javascript",l.charset="UTF-8",function(){var a,r;return null!==(r=null===(a=document.getElementsByTagName("head"))||void 0===a?void 0:a[0])&&void 0!==r?r:document}().appendChild(l)})}(`https://apis.google.com/js/api.js?onload=${U}`)}b()}}).catch(r=>{throw Fn=null,r})}(a),Fn}const ha=new je(5e3,15e3),zr={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},fa=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Eo(a){const r=a.config;x(r.authDomain,a,"auth-domain-config-required");const s=r.emulator?ie(r,"emulator/auth/iframe"):`https://${a.config.authDomain}/__/auth/iframe`,l={apiKey:r.apiKey,appName:a.name,v:me.Jn},d=fa.get(a.config.apiHost);d&&(l.eid=d);const p=a._getFrameworks();return p.length&&(l.fw=p.join(",")),`${s}?${(0,V.xO)(l).slice(1)}`}function Un(){return(Un=(0,E.Z)(function*(a){const r=yield Io(a),s=nt().gapi;return x(s,a,"internal-error"),r.open({where:document.body,url:Eo(a),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:zr,dontclear:!0},l=>new Promise(function(){var d=(0,E.Z)(function*(p,b){yield l.restyle({setHideOnLeave:!1});const U=ne(a,"network-request-failed"),J=nt().setTimeout(()=>{b(U)},ha.get());function oe(){nt().clearTimeout(J),p(l)}l.ping(oe).then(oe,()=>{b(U)})});return function(p,b){return d.apply(this,arguments)}}()))})).apply(this,arguments)}const Ns={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class $r{constructor(r){this.window=r,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(r){}}}function Os(a,r,s,l,d,p){x(a.config.authDomain,a,"auth-domain-config-required"),x(a.config.apiKey,a,"invalid-api-key");const b={apiKey:a.config.apiKey,appName:a.name,authType:s,redirectUrl:l,v:me.Jn,eventId:d};if(r instanceof It){r.setDefaultLanguage(a.languageCode),b.providerId=r.providerId||"",(0,V.xb)(r.getCustomParameters())||(b.customParameters=JSON.stringify(r.getCustomParameters()));for(const[J,oe]of Object.entries(p||{}))b[J]=oe}if(r instanceof Lt){const J=r.getScopes().filter(oe=>""!==oe);J.length>0&&(b.scopes=J.join(","))}a.tenantId&&(b.tid=a.tenantId);const U=b;for(const J of Object.keys(U))void 0===U[J]&&delete U[J];return`${function({config:a}){return a.emulator?ie(a,"emulator/auth/handler"):`https://${a.authDomain}/__/auth/handler`}(a)}?${(0,V.xO)(U).slice(1)}`}const xs="webStorageSupport",Co=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Zs,this._completeRedirectFn=mo}_openPopup(r,s,l,d){var p=this;return(0,E.Z)(function*(){var b;Ee(null===(b=p.eventManagers[r._key()])||void 0===b?void 0:b.manager,"_initialize() not called before _openPopup()");const U=Os(r,s,l,M(),d);return function(a,r,s,l=500,d=600){const p=Math.max((window.screen.availHeight-d)/2,0).toString(),b=Math.max((window.screen.availWidth-l)/2,0).toString();let U="";const J=Object.assign(Object.assign({},Ns),{width:l.toString(),height:d.toString(),top:p,left:b}),oe=(0,V.z$)().toLowerCase();s&&(U=en(oe)?"_blank":s),ot(oe)&&(r=r||"http://localhost",J.scrollbars="yes");const ve=Object.entries(J).reduce((St,[Bt,Gi])=>`${St}${Bt}=${Gi},`,"");if(function(a=(0,V.z$)()){var r;return _n(a)&&!!(null===(r=window.navigator)||void 0===r?void 0:r.standalone)}(oe)&&"_self"!==U)return function(a,r){const s=document.createElement("a");s.href=a,s.target=r;const l=document.createEvent("MouseEvent");l.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(l)}(r||"",U),new $r(null);const et=window.open(r||"",U,ve);x(et,a,"popup-blocked");try{et.focus()}catch(St){}return new $r(et)}(r,U,os())})()}_openRedirect(r,s,l,d){var p=this;return(0,E.Z)(function*(){return yield p._originValidation(r),a=Os(r,s,l,M(),d),nt().location.href=a,new Promise(()=>{});var a})()}_initialize(r){const s=r._key();if(this.eventManagers[s]){const{manager:d,promise:p}=this.eventManagers[s];return d?Promise.resolve(d):(Ee(p,"If manager is not set, promise should be"),p)}const l=this.initAndGetManager(r);return this.eventManagers[s]={promise:l},l}initAndGetManager(r){var s=this;return(0,E.Z)(function*(){const l=yield function(a){return Un.apply(this,arguments)}(r),d=new Mi(r);return l.register("authEvent",p=>(x(null==p?void 0:p.authEvent,r,"invalid-auth-event"),{status:d.onEvent(p.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),s.eventManagers[r._key()]={manager:d},s.iframes[r._key()]=l,d})()}_isIframeWebStorageSupported(r,s){this.iframes[r._key()].send(xs,{type:xs},d=>{var p;const b=null===(p=null==d?void 0:d[0])||void 0===p?void 0:p[xs];void 0!==b&&s(!!b),te(r,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(r){const s=r._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=function(a){return Hr.apply(this,arguments)}(r)),this.originValidationPromises[s]}get _shouldInitProactively(){return cr()||rt()||_n()}};var a;class Wi{constructor(r){this.auth=r,this.internalListeners=new Map}getUid(){var r;return this.assertAuthConfigured(),(null===(r=this.auth.currentUser)||void 0===r?void 0:r.uid)||null}getToken(r){var s=this;return(0,E.Z)(function*(){return s.assertAuthConfigured(),yield s.auth._initializationPromise,s.auth.currentUser?{accessToken:yield s.auth.currentUser.getIdToken(r)}:null})()}addAuthTokenListener(r){if(this.assertAuthConfigured(),this.internalListeners.has(r))return;const s=this.auth.onIdTokenChanged(l=>{var d;r((null===(d=l)||void 0===d?void 0:d.stsTokenManager.accessToken)||null)});this.internalListeners.set(r,s),this.updateProactiveRefresh()}removeAuthTokenListener(r){this.assertAuthConfigured();const s=this.internalListeners.get(r);!s||(this.internalListeners.delete(r),s(),this.updateProactiveRefresh())}assertAuthConfigured(){x(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Ta(a=(0,me.Mq)()){const r=(0,me.qX)(a,"auth");return r.isInitialized()?r.getImmediate():function(a,r){const s=(0,me.qX)(a,"auth");if(s.isInitialized()){const d=s.getImmediate(),p=s.getOptions();if((0,V.vZ)(p,null!=r?r:{}))return d;te(d,"already-initialized")}return s.initialize({options:r})}(a,{popupRedirectResolver:Co,persistence:[no,Go,Zs]})}a="Browser",(0,me.Xd)(new Ue.wA("auth",(r,{options:s})=>{const l=r.getProvider("app").getImmediate(),{apiKey:d,authDomain:p}=l.options;return(b=>{x(d&&!d.includes(":"),"invalid-api-key",{appName:b.name}),x(!(null==p?void 0:p.includes(":")),"argument-error",{appName:b.name});const U={apiKey:d,authDomain:p,clientPlatform:a,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Xr(a)},J=new dr(b,U);return function(a,r){const s=(null==r?void 0:r.persistence)||[],l=(Array.isArray(s)?s:[s]).map(P);(null==r?void 0:r.errorMap)&&a._updateErrorMap(r.errorMap),a._initializeWithPersistence(l,null==r?void 0:r.popupRedirectResolver)}(J,s),J})(l)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((r,s,l)=>{r.getProvider("auth-internal").initialize()})),(0,me.Xd)(new Ue.wA("auth-internal",r=>{const s=at(r.getProvider("auth").getImmediate());return new Wi(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,me.KN)("@firebase/auth","0.17.1",void 0)},6034:(Rt,Ve,X)=>{"use strict";X.d(Ve,{wA:()=>me,H0:()=>Se});var E=X(4762),V=X(4685),me=function(){function $(k,K,H){this.name=k,this.instanceFactory=K,this.type=H,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return $.prototype.setInstantiationMode=function(k){return this.instantiationMode=k,this},$.prototype.setMultipleInstances=function(k){return this.multipleInstances=k,this},$.prototype.setServiceProps=function(k){return this.serviceProps=k,this},$.prototype.setInstanceCreatedCallback=function(k){return this.onInstanceCreated=k,this},$}(),m="[DEFAULT]",Ie=function(){function $(k,K){this.name=k,this.container=K,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}return $.prototype.get=function(k){var K=this.normalizeInstanceIdentifier(k);if(!this.instancesDeferred.has(K)){var H=new V.BH;if(this.instancesDeferred.set(K,H),this.isInitialized(K)||this.shouldAutoInitialize())try{var L=this.getOrInitializeService({instanceIdentifier:K});L&&H.resolve(L)}catch(Y){}}return this.instancesDeferred.get(K).promise},$.prototype.getImmediate=function(k){var K,H=this.normalizeInstanceIdentifier(null==k?void 0:k.identifier),L=null!==(K=null==k?void 0:k.optional)&&void 0!==K&&K;if(!this.isInitialized(H)&&!this.shouldAutoInitialize()){if(L)return null;throw Error("Service "+this.name+" is not available")}try{return this.getOrInitializeService({instanceIdentifier:H})}catch(Y){if(L)return null;throw Y}},$.prototype.getComponent=function(){return this.component},$.prototype.setComponent=function(k){var K,H;if(k.name!==this.name)throw Error("Mismatching Component "+k.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=k,this.shouldAutoInitialize()){if(function($){return"EAGER"===$.instantiationMode}(k))try{this.getOrInitializeService({instanceIdentifier:m})}catch(te){}try{for(var L=(0,E.XA)(this.instancesDeferred.entries()),Y=L.next();!Y.done;Y=L.next()){var ye=(0,E.CR)(Y.value,2),B=ye[1],Z=this.normalizeInstanceIdentifier(ye[0]);try{var ee=this.getOrInitializeService({instanceIdentifier:Z});B.resolve(ee)}catch(te){}}}catch(te){K={error:te}}finally{try{Y&&!Y.done&&(H=L.return)&&H.call(L)}finally{if(K)throw K.error}}}},$.prototype.clearInstance=function(k){void 0===k&&(k=m),this.instancesDeferred.delete(k),this.instancesOptions.delete(k),this.instances.delete(k)},$.prototype.delete=function(){return(0,E.mG)(this,void 0,void 0,function(){var k;return(0,E.Jh)(this,function(K){switch(K.label){case 0:return k=Array.from(this.instances.values()),[4,Promise.all((0,E.ev)((0,E.ev)([],(0,E.CR)(k.filter(function(H){return"INTERNAL"in H}).map(function(H){return H.INTERNAL.delete()}))),(0,E.CR)(k.filter(function(H){return"_delete"in H}).map(function(H){return H._delete()}))))];case 1:return K.sent(),[2]}})})},$.prototype.isComponentSet=function(){return null!=this.component},$.prototype.isInitialized=function(k){return void 0===k&&(k=m),this.instances.has(k)},$.prototype.getOptions=function(k){return void 0===k&&(k=m),this.instancesOptions.get(k)||{}},$.prototype.initialize=function(k){var K,H;void 0===k&&(k={});var L=k.options,Y=void 0===L?{}:L,ye=this.normalizeInstanceIdentifier(k.instanceIdentifier);if(this.isInitialized(ye))throw Error(this.name+"("+ye+") has already been initialized");if(!this.isComponentSet())throw Error("Component "+this.name+" has not been registered yet");var we=this.getOrInitializeService({instanceIdentifier:ye,options:Y});try{for(var B=(0,E.XA)(this.instancesDeferred.entries()),Z=B.next();!Z.done;Z=B.next()){var ee=(0,E.CR)(Z.value,2),ne=ee[1];ye===this.normalizeInstanceIdentifier(ee[0])&&ne.resolve(we)}}catch(x){K={error:x}}finally{try{Z&&!Z.done&&(H=B.return)&&H.call(B)}finally{if(K)throw K.error}}return we},$.prototype.onInit=function(k,K){var H,L=this.normalizeInstanceIdentifier(K),Y=null!==(H=this.onInitCallbacks.get(L))&&void 0!==H?H:new Set;Y.add(k),this.onInitCallbacks.set(L,Y);var ye=this.instances.get(L);return ye&&k(ye,L),function(){Y.delete(k)}},$.prototype.invokeOnInitCallbacks=function(k,K){var H,L,Y=this.onInitCallbacks.get(K);if(Y)try{for(var ye=(0,E.XA)(Y),we=ye.next();!we.done;we=ye.next()){var B=we.value;try{B(k,K)}catch(Z){}}}catch(Z){H={error:Z}}finally{try{we&&!we.done&&(L=ye.return)&&L.call(ye)}finally{if(H)throw H.error}}},$.prototype.getOrInitializeService=function(k){var K=k.instanceIdentifier,H=k.options,L=void 0===H?{}:H,Y=this.instances.get(K);if(!Y&&this.component&&(Y=this.component.instanceFactory(this.container,{instanceIdentifier:Ue(K),options:L}),this.instances.set(K,Y),this.instancesOptions.set(K,L),this.invokeOnInitCallbacks(Y,K),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,K,Y)}catch(ye){}return Y||null},$.prototype.normalizeInstanceIdentifier=function(k){return void 0===k&&(k=m),this.component?this.component.multipleInstances?k:m:k},$.prototype.shouldAutoInitialize=function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode},$}();function Ue($){return $===m?void 0:$}var Se=function(){function $(k){this.name=k,this.providers=new Map}return $.prototype.addComponent=function(k){var K=this.getProvider(k.name);if(K.isComponentSet())throw new Error("Component "+k.name+" has already been registered with "+this.name);K.setComponent(k)},$.prototype.addOrOverwriteComponent=function(k){this.getProvider(k.name).isComponentSet()&&this.providers.delete(k.name),this.addComponent(k)},$.prototype.getProvider=function(k){if(this.providers.has(k))return this.providers.get(k);var K=new Ie(k,this);return this.providers.set(k,K),K},$.prototype.getProviders=function(){return Array.from(this.providers.values())},$}()},300:(Rt,Ve,X)=>{"use strict";function E(){for(var H=0,L=0,Y=arguments.length;L<Y;L++)H+=arguments[L].length;var ye=Array(H),we=0;for(L=0;L<Y;L++)for(var B=arguments[L],Z=0,ee=B.length;Z<ee;Z++,we++)ye[we]=B[Z];return ye}X.d(Ve,{in:()=>m,Yd:()=>$});var V,me=[],m=(()=>{return(H=m||(m={}))[H.DEBUG=0]="DEBUG",H[H.VERBOSE=1]="VERBOSE",H[H.INFO=2]="INFO",H[H.WARN=3]="WARN",H[H.ERROR=4]="ERROR",H[H.SILENT=5]="SILENT",m;var H})(),Ie={debug:m.DEBUG,verbose:m.VERBOSE,info:m.INFO,warn:m.WARN,error:m.ERROR,silent:m.SILENT},Ue=m.INFO,Ae=((V={})[m.DEBUG]="log",V[m.VERBOSE]="log",V[m.INFO]="info",V[m.WARN]="warn",V[m.ERROR]="error",V),Se=function(H,L){for(var Y=[],ye=2;ye<arguments.length;ye++)Y[ye-2]=arguments[ye];if(!(L<H.logLevel)){var we=(new Date).toISOString(),B=Ae[L];if(!B)throw new Error("Attempted to log a message with an invalid logType (value: "+L+")");console[B].apply(console,E(["["+we+"]  "+H.name+":"],Y))}},$=function(){function H(L){this.name=L,this._logLevel=Ue,this._logHandler=Se,this._userLogHandler=null,me.push(this)}return Object.defineProperty(H.prototype,"logLevel",{get:function(){return this._logLevel},set:function(L){if(!(L in m))throw new TypeError('Invalid value "'+L+'" assigned to `logLevel`');this._logLevel=L},enumerable:!1,configurable:!0}),H.prototype.setLogLevel=function(L){this._logLevel="string"==typeof L?Ie[L]:L},Object.defineProperty(H.prototype,"logHandler",{get:function(){return this._logHandler},set:function(L){if("function"!=typeof L)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=L},enumerable:!1,configurable:!0}),Object.defineProperty(H.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(L){this._userLogHandler=L},enumerable:!1,configurable:!0}),H.prototype.debug=function(){for(var L=[],Y=0;Y<arguments.length;Y++)L[Y]=arguments[Y];this._userLogHandler&&this._userLogHandler.apply(this,E([this,m.DEBUG],L)),this._logHandler.apply(this,E([this,m.DEBUG],L))},H.prototype.log=function(){for(var L=[],Y=0;Y<arguments.length;Y++)L[Y]=arguments[Y];this._userLogHandler&&this._userLogHandler.apply(this,E([this,m.VERBOSE],L)),this._logHandler.apply(this,E([this,m.VERBOSE],L))},H.prototype.info=function(){for(var L=[],Y=0;Y<arguments.length;Y++)L[Y]=arguments[Y];this._userLogHandler&&this._userLogHandler.apply(this,E([this,m.INFO],L)),this._logHandler.apply(this,E([this,m.INFO],L))},H.prototype.warn=function(){for(var L=[],Y=0;Y<arguments.length;Y++)L[Y]=arguments[Y];this._userLogHandler&&this._userLogHandler.apply(this,E([this,m.WARN],L)),this._logHandler.apply(this,E([this,m.WARN],L))},H.prototype.error=function(){for(var L=[],Y=0;Y<arguments.length;Y++)L[Y]=arguments[Y];this._userLogHandler&&this._userLogHandler.apply(this,E([this,m.ERROR],L)),this._logHandler.apply(this,E([this,m.ERROR],L))},H}()},4685:(Rt,Ve,X)=>{"use strict";X.d(Ve,{BH:()=>Y,LL:()=>fe,ZR:()=>G,gQ:()=>pt,zI:()=>F,hu:()=>me,g5:()=>m,US:()=>Ae,tV:()=>k,h$:()=>Se,$s:()=>Xt,r3:()=>cn,ne:()=>yt,p$:()=>K,vZ:()=>Zt,gK:()=>Ce,pd:()=>gt,m9:()=>fn,z$:()=>we,GJ:()=>Pt,ru:()=>te,xb:()=>qe,w1:()=>x,hl:()=>P,uI:()=>B,Yr:()=>Ee,b$:()=>ne,w9:()=>xe,cI:()=>ie,UI:()=>ft,xO:()=>dt,zd:()=>dn,DV:()=>it,ug:()=>_t,dS:()=>Ke,Pz:()=>ce,eu:()=>D});var E=X(4762),me=function(I,v){if(!I)throw m(v)},m=function(I){return new Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+I)},Ie=function(I){for(var v=[],C=0,S=0;S<I.length;S++){var T=I.charCodeAt(S);T<128?v[C++]=T:T<2048?(v[C++]=T>>6|192,v[C++]=63&T|128):55296==(64512&T)&&S+1<I.length&&56320==(64512&I.charCodeAt(S+1))?(T=65536+((1023&T)<<10)+(1023&I.charCodeAt(++S)),v[C++]=T>>18|240,v[C++]=T>>12&63|128,v[C++]=T>>6&63|128,v[C++]=63&T|128):(v[C++]=T>>12|224,v[C++]=T>>6&63|128,v[C++]=63&T|128)}return v},Ae={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(I,v){if(!Array.isArray(I))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var C=v?this.byteToCharMapWebSafe_:this.byteToCharMap_,S=[],T=0;T<I.length;T+=3){var j=I[T],le=T+1<I.length,Pe=le?I[T+1]:0,ke=T+2<I.length,Re=ke?I[T+2]:0,rt=(15&Pe)<<2|Re>>6,en=63&Re;ke||(en=64,le||(rt=64)),S.push(C[j>>2],C[(3&j)<<4|Pe>>4],C[rt],C[en])}return S.join("")},encodeString:function(I,v){return this.HAS_NATIVE_SUPPORT&&!v?btoa(I):this.encodeByteArray(Ie(I),v)},decodeString:function(I,v){return this.HAS_NATIVE_SUPPORT&&!v?atob(I):function(I){for(var v=[],C=0,S=0;C<I.length;){var T=I[C++];if(T<128)v[S++]=String.fromCharCode(T);else if(T>191&&T<224){var j=I[C++];v[S++]=String.fromCharCode((31&T)<<6|63&j)}else if(T>239&&T<365){var ke=((7&T)<<18|(63&(j=I[C++]))<<12|(63&(le=I[C++]))<<6|63&I[C++])-65536;v[S++]=String.fromCharCode(55296+(ke>>10)),v[S++]=String.fromCharCode(56320+(1023&ke))}else{j=I[C++];var le=I[C++];v[S++]=String.fromCharCode((15&T)<<12|(63&j)<<6|63&le)}}return v.join("")}(this.decodeStringToByteArray(I,v))},decodeStringToByteArray:function(I,v){this.init_();for(var C=v?this.charToByteMapWebSafe_:this.charToByteMap_,S=[],T=0;T<I.length;){var j=C[I.charAt(T++)],Pe=T<I.length?C[I.charAt(T)]:0,Re=++T<I.length?C[I.charAt(T)]:64,ot=++T<I.length?C[I.charAt(T)]:64;if(++T,null==j||null==Pe||null==Re||null==ot)throw Error();S.push(j<<2|Pe>>4),64!==Re&&(S.push(Pe<<4&240|Re>>2),64!==ot&&S.push(Re<<6&192|ot))}return S},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var I=0;I<this.ENCODED_VALS.length;I++)this.byteToCharMap_[I]=this.ENCODED_VALS.charAt(I),this.charToByteMap_[this.byteToCharMap_[I]]=I,this.byteToCharMapWebSafe_[I]=this.ENCODED_VALS_WEBSAFE.charAt(I),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[I]]=I,I>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(I)]=I,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(I)]=I)}}},Se=function(I){var v=Ie(I);return Ae.encodeByteArray(v,!0)},k=function(I){try{return Ae.decodeString(I,!0)}catch(v){console.error("base64Decode failed: ",v)}return null};function K(I){return H(void 0,I)}function H(I,v){if(!(v instanceof Object))return v;switch(v.constructor){case Date:return new Date(v.getTime());case Object:void 0===I&&(I={});break;case Array:I=[];break;default:return v}for(var S in v)!v.hasOwnProperty(S)||!L(S)||(I[S]=H(I[S],v[S]));return I}function L(I){return"__proto__"!==I}var Y=function(){function I(){var v=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(C,S){v.resolve=C,v.reject=S})}return I.prototype.wrapCallback=function(v){var C=this;return function(S,T){S?C.reject(S):C.resolve(T),"function"==typeof v&&(C.promise.catch(function(){}),1===v.length?v(S):v(S,T))}},I}();function we(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function B(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(we())}function te(){var I="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof I&&void 0!==I.id}function ne(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function x(){var I=we();return I.indexOf("MSIE ")>=0||I.indexOf("Trident/")>=0}function Ee(){return!1}function P(){return"indexedDB"in self&&null!=indexedDB}function D(){return new Promise(function(I,v){try{var C=!0,S="validate-browser-context-for-indexeddb-analytics-module",T=self.indexedDB.open(S);T.onsuccess=function(){T.result.close(),C||self.indexedDB.deleteDatabase(S),I(!0)},T.onupgradeneeded=function(){C=!1},T.onerror=function(){var j;v((null===(j=T.error)||void 0===j?void 0:j.message)||"")}}catch(j){v(j)}})}function F(){return!(!navigator||!navigator.cookieEnabled)}var G=function(I){function v(C,S,T){var j=I.call(this,S)||this;return j.code=C,j.customData=T,j.name="FirebaseError",Object.setPrototypeOf(j,v.prototype),Error.captureStackTrace&&Error.captureStackTrace(j,fe.prototype.create),j}return(0,E.ZT)(v,I),v}(Error),fe=function(){function I(v,C,S){this.service=v,this.serviceName=C,this.errors=S}return I.prototype.create=function(v){for(var C=[],S=1;S<arguments.length;S++)C[S-1]=arguments[S];var T=C[0]||{},j=this.service+"/"+v,le=this.errors[v],Pe=le?Te(le,T):"Error",ke=this.serviceName+": "+Pe+" ("+j+").",Re=new G(j,ke,T);return Re},I}();function Te(I,v){return I.replace(je,function(C,S){var T=v[S];return null!=T?String(T):"<"+S+"?>"})}var je=/\{\$([^}]+)}/g;function ie(I){return JSON.parse(I)}function ce(I){return JSON.stringify(I)}var ze=function(I){var v={},C={},S={},T="";try{var j=I.split(".");v=ie(k(j[0])||""),C=ie(k(j[1])||""),T=j[2],S=C.d||{},delete C.d}catch(le){}return{header:v,claims:C,data:S,signature:T}},xe=function(I){var C=ze(I).claims;return!!C&&"object"==typeof C&&C.hasOwnProperty("iat")},Pt=function(I){var v=ze(I).claims;return"object"==typeof v&&!0===v.admin};function cn(I,v){return Object.prototype.hasOwnProperty.call(I,v)}function it(I,v){if(Object.prototype.hasOwnProperty.call(I,v))return I[v]}function qe(I){for(var v in I)if(Object.prototype.hasOwnProperty.call(I,v))return!1;return!0}function ft(I,v,C){var S={};for(var T in I)Object.prototype.hasOwnProperty.call(I,T)&&(S[T]=v.call(C,I[T],T,I));return S}function Zt(I,v){if(I===v)return!0;for(var C=Object.keys(I),S=Object.keys(v),T=0,j=C;T<j.length;T++){if(!S.includes(le=j[T]))return!1;var Pe=I[le],ke=v[le];if(Tt(Pe)&&Tt(ke)){if(!Zt(Pe,ke))return!1}else if(Pe!==ke)return!1}for(var Re=0,st=S;Re<st.length;Re++){var le;if(!C.includes(le=st[Re]))return!1}return!0}function Tt(I){return null!==I&&"object"==typeof I}function dt(I){for(var v=[],C=function(ke,Re){Array.isArray(Re)?Re.forEach(function(st){v.push(encodeURIComponent(ke)+"="+encodeURIComponent(st))}):v.push(encodeURIComponent(ke)+"="+encodeURIComponent(Re))},S=0,T=Object.entries(I);S<T.length;S++){var j=T[S];C(j[0],j[1])}return v.length?"&"+v.join("&"):""}function dn(I){var v={};return I.replace(/^\?/,"").split("&").forEach(function(S){if(S){var T=S.split("="),le=T[1];v[decodeURIComponent(T[0])]=decodeURIComponent(le)}}),v}function gt(I){var v=I.indexOf("?");if(!v)return"";var C=I.indexOf("#",v);return I.substring(v,C>0?C:void 0)}var pt=function(){function I(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var v=1;v<this.blockSize;++v)this.pad_[v]=0;this.reset()}return I.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},I.prototype.compress_=function(v,C){C||(C=0);var S=this.W_;if("string"==typeof v)for(var T=0;T<16;T++)S[T]=v.charCodeAt(C)<<24|v.charCodeAt(C+1)<<16|v.charCodeAt(C+2)<<8|v.charCodeAt(C+3),C+=4;else for(T=0;T<16;T++)S[T]=v[C]<<24|v[C+1]<<16|v[C+2]<<8|v[C+3],C+=4;for(T=16;T<80;T++)S[T]=4294967295&((j=S[T-3]^S[T-8]^S[T-14]^S[T-16])<<1|j>>>31);var ot,rt,le=this.chain_[0],Pe=this.chain_[1],ke=this.chain_[2],Re=this.chain_[3],st=this.chain_[4];for(T=0;T<80;T++){T<40?T<20?(ot=Re^Pe&(ke^Re),rt=1518500249):(ot=Pe^ke^Re,rt=1859775393):T<60?(ot=Pe&ke|Re&(Pe|ke),rt=2400959708):(ot=Pe^ke^Re,rt=3395469782);var j=(le<<5|le>>>27)+ot+st+rt+S[T]&4294967295;st=Re,Re=ke,ke=4294967295&(Pe<<30|Pe>>>2),Pe=le,le=j}this.chain_[0]=this.chain_[0]+le&4294967295,this.chain_[1]=this.chain_[1]+Pe&4294967295,this.chain_[2]=this.chain_[2]+ke&4294967295,this.chain_[3]=this.chain_[3]+Re&4294967295,this.chain_[4]=this.chain_[4]+st&4294967295},I.prototype.update=function(v,C){if(null!=v){void 0===C&&(C=v.length);for(var S=C-this.blockSize,T=0,j=this.buf_,le=this.inbuf_;T<C;){if(0===le)for(;T<=S;)this.compress_(v,T),T+=this.blockSize;if("string"==typeof v){for(;T<C;)if(j[le]=v.charCodeAt(T),++T,++le===this.blockSize){this.compress_(j),le=0;break}}else for(;T<C;)if(j[le]=v[T],++T,++le===this.blockSize){this.compress_(j),le=0;break}}this.inbuf_=le,this.total_+=C}},I.prototype.digest=function(){var v=[],C=8*this.total_;this.update(this.pad_,this.inbuf_<56?56-this.inbuf_:this.blockSize-(this.inbuf_-56));for(var S=this.blockSize-1;S>=56;S--)this.buf_[S]=255&C,C/=256;this.compress_(this.buf_);var T=0;for(S=0;S<5;S++)for(var j=24;j>=0;j-=8)v[T]=this.chain_[S]>>j&255,++T;return v},I}();function yt(I,v){var C=new Qt(I,v);return C.subscribe.bind(C)}var Qt=function(){function I(v,C){var S=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=C,this.task.then(function(){v(S)}).catch(function(T){S.error(T)})}return I.prototype.next=function(v){this.forEachObserver(function(C){C.next(v)})},I.prototype.error=function(v){this.forEachObserver(function(C){C.error(v)}),this.close(v)},I.prototype.complete=function(){this.forEachObserver(function(v){v.complete()}),this.close()},I.prototype.subscribe=function(v,C,S){var j,T=this;if(void 0===v&&void 0===C&&void 0===S)throw new Error("Missing Observer.");void 0===(j=function(I,v){if("object"!=typeof I||null===I)return!1;for(var C=0,S=["next","error","complete"];C<S.length;C++){var T=S[C];if(T in I&&"function"==typeof I[T])return!0}return!1}(v)?v:{next:v,error:C,complete:S}).next&&(j.next=de),void 0===j.error&&(j.error=de),void 0===j.complete&&(j.complete=de);var le=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{T.finalError?j.error(T.finalError):j.complete()}catch(Pe){}}),this.observers.push(j),le},I.prototype.unsubscribeOne=function(v){void 0===this.observers||void 0===this.observers[v]||(delete this.observers[v],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},I.prototype.forEachObserver=function(v){if(!this.finalized)for(var C=0;C<this.observers.length;C++)this.sendOne(C,v)},I.prototype.sendOne=function(v,C){var S=this;this.task.then(function(){if(void 0!==S.observers&&void 0!==S.observers[v])try{C(S.observers[v])}catch(T){"undefined"!=typeof console&&console.error&&console.error(T)}})},I.prototype.close=function(v){var C=this;this.finalized||(this.finalized=!0,void 0!==v&&(this.finalError=v),this.task.then(function(){C.observers=void 0,C.onNoObservers=void 0}))},I}();function de(){}function Ce(I,v){return I+" failed: "+v+" argument "}var Ke=function(I){for(var v=[],C=0,S=0;S<I.length;S++){var T=I.charCodeAt(S);if(T>=55296&&T<=56319){var j=T-55296;S++,me(S<I.length,"Surrogate pair missing trail surrogate."),T=65536+(j<<10)+(I.charCodeAt(S)-56320)}T<128?v[C++]=T:T<2048?(v[C++]=T>>6|192,v[C++]=63&T|128):T<65536?(v[C++]=T>>12|224,v[C++]=T>>6&63|128,v[C++]=63&T|128):(v[C++]=T>>18|240,v[C++]=T>>12&63|128,v[C++]=T>>6&63|128,v[C++]=63&T|128)}return v},_t=function(I){for(var v=0,C=0;C<I.length;C++){var S=I.charCodeAt(C);S<128?v++:S<2048?v+=2:S>=55296&&S<=56319?(v+=4,C++):v+=3}return v};function Xt(I,v,C){void 0===v&&(v=1e3),void 0===C&&(C=2);var S=v*Math.pow(C,I),T=Math.round(.5*S*(Math.random()-.5)*2);return Math.min(144e5,S+T)}function fn(I){return I&&I._delegate?I._delegate:I}},3653:(Rt,Ve,X)=>{"use strict";X.d(Ve,{IH:()=>wr});var E=X(8239),V=X(5452),me=X(300),m=X(4685),Ie=X(6034),Ue=X(6676);const k="w:0.5.0",K="FIS_v2",B=new m.LL("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function Z(f){return f instanceof m.ZR&&f.code.includes("request-failed")}function ee({projectId:f}){return`https://firebaseinstallations.googleapis.com/v1/projects/${f}/installations`}function te(f){return{token:f.token,requestStatus:2,expiresIn:P(f.expiresIn),creationTime:Date.now()}}function ne(f,_){return he.apply(this,arguments)}function he(){return(he=(0,E.Z)(function*(f,_){const N=(yield _.json()).error;return B.create("request-failed",{requestName:f,serverCode:N.code,serverMessage:N.message,serverStatus:N.status})})).apply(this,arguments)}function x({apiKey:f}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":f})}function Qe(f,{refreshToken:_}){const w=x(f);return w.append("Authorization",function(f){return`${K} ${f}`}(_)),w}function Ee(f){return Be.apply(this,arguments)}function Be(){return(Be=(0,E.Z)(function*(f){const _=yield f();return _.status>=500&&_.status<600?f():_})).apply(this,arguments)}function P(f){return Number(f.replace("s","000"))}function F(f,_){return M.apply(this,arguments)}function M(){return(M=(0,E.Z)(function*(f,{fid:_}){const w=ee(f),W={method:"POST",headers:x(f),body:JSON.stringify({fid:_,authVersion:K,appId:f.appId,sdkVersion:k})},re=yield Ee(()=>fetch(w,W));if(re.ok){const ue=yield re.json();return{fid:ue.fid||_,registrationStatus:2,refreshToken:ue.refreshToken,authToken:te(ue.authToken)}}throw yield ne("Create Installation",re)})).apply(this,arguments)}function q(f){return new Promise(_=>{setTimeout(_,f)})}const fe=/^[cdef][\w-]{21}$/;function je(){try{const f=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(f),f[0]=112+f[0]%16;const w=function(f){return function(f){return btoa(String.fromCharCode(...f)).replace(/\+/g,"-").replace(/\//g,"_")}(f).substr(0,22)}(f);return fe.test(w)?w:""}catch(f){return""}}function ce(f){return`${f.appName}!${f.appId}`}const ze=new Map;function $e(f,_){const w=ce(f);Pt(w,_),function(f,_){const w=(!it&&"BroadcastChannel"in self&&(it=new BroadcastChannel("[Firebase] FID Change"),it.onmessage=f=>{Pt(f.data.key,f.data.fid)}),it);w&&w.postMessage({key:f,fid:_}),0===ze.size&&it&&(it.close(),it=null)}(w,_)}function Pt(f,_){const w=ze.get(f);if(w)for(const N of w)N(_)}let it=null;const dt="firebase-installations-store";let dn=null;function gt(){return dn||(dn=(0,Ue.openDb)("firebase-installations-database",1,f=>{switch(f.oldVersion){case 0:f.createObjectStore(dt)}})),dn}function pt(f,_){return yt.apply(this,arguments)}function yt(){return(yt=(0,E.Z)(function*(f,_){const w=ce(f),z=(yield gt()).transaction(dt,"readwrite"),W=z.objectStore(dt),re=yield W.get(w);return yield W.put(_,w),yield z.complete,(!re||re.fid!==_.fid)&&$e(f,_.fid),_})).apply(this,arguments)}function Qt(f){return jt.apply(this,arguments)}function jt(){return(jt=(0,E.Z)(function*(f){const _=ce(f),N=(yield gt()).transaction(dt,"readwrite");yield N.objectStore(dt).delete(_),yield N.complete})).apply(this,arguments)}function ht(f,_){return de.apply(this,arguments)}function de(){return(de=(0,E.Z)(function*(f,_){const w=ce(f),z=(yield gt()).transaction(dt,"readwrite"),W=z.objectStore(dt),re=yield W.get(w),ue=_(re);return void 0===ue?yield W.delete(w):yield W.put(ue,w),yield z.complete,ue&&(!re||re.fid!==ue.fid)&&$e(f,ue.fid),ue})).apply(this,arguments)}function se(f){return Ce.apply(this,arguments)}function Ce(){return(Ce=(0,E.Z)(function*(f){let _;const w=yield ht(f,N=>{const z=He(N),W=tt(f,z);return _=W.registrationPromise,W.installationEntry});return""===w.fid?{installationEntry:yield _}:{installationEntry:w,registrationPromise:_}})).apply(this,arguments)}function He(f){return Jt(f||{fid:je(),registrationStatus:0})}function tt(f,_){if(0===_.registrationStatus){if(!navigator.onLine)return{installationEntry:_,registrationPromise:Promise.reject(B.create("app-offline"))};const w={fid:_.fid,registrationStatus:1,registrationTime:Date.now()};return{installationEntry:w,registrationPromise:function(f,_){return Ke.apply(this,arguments)}(f,w)}}return 1===_.registrationStatus?{installationEntry:_,registrationPromise:_t(f)}:{installationEntry:_}}function Ke(){return(Ke=(0,E.Z)(function*(f,_){try{return pt(f,yield F(f,_))}catch(w){throw Z(w)&&409===w.customData.serverCode?yield Qt(f):yield pt(f,{fid:_.fid,registrationStatus:0}),w}})).apply(this,arguments)}function _t(f){return hn.apply(this,arguments)}function hn(){return(hn=(0,E.Z)(function*(f){let _=yield Gn(f);for(;1===_.registrationStatus;)yield q(100),_=yield Gn(f);if(0===_.registrationStatus){const{installationEntry:w,registrationPromise:N}=yield se(f);return N||w}return _})).apply(this,arguments)}function Gn(f){return ht(f,_=>{if(!_)throw B.create("installation-not-found");return Jt(_)})}function Jt(f){return function(f){return 1===f.registrationStatus&&f.registrationTime+1e4<Date.now()}(f)?{fid:f.fid,registrationStatus:0}:f}function Xt(f,_){return Vn.apply(this,arguments)}function Vn(){return(Vn=(0,E.Z)(function*({appConfig:f,platformLoggerProvider:_},w){const N=wn(f,w),z=Qe(f,w),W=_.getImmediate({optional:!0});W&&z.append("x-firebase-client",W.getPlatformInfoString());const ue={method:"POST",headers:z,body:JSON.stringify({installation:{sdkVersion:k}})},Le=yield Ee(()=>fetch(N,ue));if(Le.ok)return te(yield Le.json());throw yield ne("Generate Auth Token",Le)})).apply(this,arguments)}function wn(f,{fid:_}){return`${ee(f)}/${_}/authTokens:generate`}function fn(f){return I.apply(this,arguments)}function I(){return(I=(0,E.Z)(function*(f,_=!1){let w;const N=yield ht(f.appConfig,W=>{if(!le(W))throw B.create("not-registered");const re=W.authToken;if(!_&&Pe(re))return W;if(1===re.requestStatus)return w=v(f,_),W;{if(!navigator.onLine)throw B.create("app-offline");const ue=Re(W);return w=T(f,ue),ue}});return w?yield w:N.authToken})).apply(this,arguments)}function v(f,_){return C.apply(this,arguments)}function C(){return(C=(0,E.Z)(function*(f,_){let w=yield S(f.appConfig);for(;1===w.authToken.requestStatus;)yield q(100),w=yield S(f.appConfig);const N=w.authToken;return 0===N.requestStatus?fn(f,_):N})).apply(this,arguments)}function S(f){return ht(f,_=>{if(!le(_))throw B.create("not-registered");return function(f){return 1===f.requestStatus&&f.requestTime+1e4<Date.now()}(_.authToken)?Object.assign(Object.assign({},_),{authToken:{requestStatus:0}}):_})}function T(f,_){return j.apply(this,arguments)}function j(){return(j=(0,E.Z)(function*(f,_){try{const w=yield Xt(f,_),N=Object.assign(Object.assign({},_),{authToken:w});return yield pt(f.appConfig,N),w}catch(w){if(!Z(w)||401!==w.customData.serverCode&&404!==w.customData.serverCode){const N=Object.assign(Object.assign({},_),{authToken:{requestStatus:0}});yield pt(f.appConfig,N)}else yield Qt(f.appConfig);throw w}})).apply(this,arguments)}function le(f){return void 0!==f&&2===f.registrationStatus}function Pe(f){return 2===f.requestStatus&&!function(f){const _=Date.now();return _<f.creationTime||f.creationTime+f.expiresIn<_+36e5}(f)}function Re(f){const _={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},f),{authToken:_})}function rt(){return(rt=(0,E.Z)(function*(f){const _=f,{installationEntry:w,registrationPromise:N}=yield se(_.appConfig);return N?N.catch(console.error):fn(_).catch(console.error),w.fid})).apply(this,arguments)}function pn(){return(pn=(0,E.Z)(function*(f,_=!1){const w=f;return yield Jr(w.appConfig),(yield fn(w,_)).token})).apply(this,arguments)}function Jr(f){return kt.apply(this,arguments)}function kt(){return(kt=(0,E.Z)(function*(f){const{registrationPromise:_}=yield se(f);_&&(yield _)})).apply(this,arguments)}function dr(f){return B.create("missing-app-config-values",{valueName:f})}const at="installations";(0,V.Xd)(new Ie.wA(at,f=>{const _=f.getProvider("app").getImmediate();return{app:_,appConfig:function(f){if(!f||!f.options)throw dr("App Configuration");if(!f.name)throw dr("App Name");const _=["projectId","apiKey","appId"];for(const w of _)if(!f.options[w])throw dr(w);return{appName:f.name,projectId:f.options.projectId,apiKey:f.options.apiKey,appId:f.options.appId}}(_),platformLoggerProvider:(0,V.qX)(_,"platform-logger"),_delete:()=>Promise.resolve()}},"PUBLIC")),(0,V.Xd)(new Ie.wA("installations-internal",f=>{const _=f.getProvider("app").getImmediate(),w=(0,V.qX)(_,at).getImmediate();return{getId:()=>function(f){return rt.apply(this,arguments)}(w),getToken:z=>function(f){return pn.apply(this,arguments)}(w,z)}},"PRIVATE")),(0,V.KN)("@firebase/installations","0.5.0");const Cn="analytics",ni="firebase_id",zn="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",pr="https://www.googletagmanager.com/gtag/js",Je=new me.Yd("@firebase/analytics");function _r(f){return Promise.all(f.map(_=>_.catch(w=>w)))}function $n(f,_){const w=document.createElement("script");w.src=`${pr}?l=${f}&id=${_}`,w.async=!0,document.head.appendChild(w)}function Kn(f,_,w,N,z,W){return nn.apply(this,arguments)}function nn(){return(nn=(0,E.Z)(function*(f,_,w,N,z,W){const re=N[z];try{if(re)yield _[re];else{const Le=(yield _r(w)).find(Ze=>Ze.measurementId===z);Le&&(yield _[Le.appId])}}catch(ue){Je.error(ue)}f("config",z,W)})).apply(this,arguments)}function Ne(f,_,w,N,z){return be.apply(this,arguments)}function be(){return(be=(0,E.Z)(function*(f,_,w,N,z){try{let W=[];if(z&&z.send_to){let re=z.send_to;Array.isArray(re)||(re=[re]);const ue=yield _r(w);for(const Le of re){const Ze=ue.find(an=>an.measurementId===Le),Wt=Ze&&_[Ze.appId];if(!Wt){W=[];break}W.push(Wt)}}0===W.length&&(W=Object.values(_)),yield Promise.all(W),f("event",N,z||{})}catch(W){Je.error(W)}})).apply(this,arguments)}function Oe(){const f=window.document.getElementsByTagName("script");for(const _ of Object.values(f))if(_.src&&_.src.includes(pr))return _;return null}const lt=new m.LL("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'}),_e=new class{constructor(_={},w=1e3){this.throttleMetadata=_,this.intervalMillis=w}getThrottleMetadata(_){return this.throttleMetadata[_]}setThrottleMetadata(_,w){this.throttleMetadata[_]=w}deleteThrottleMetadata(_){delete this.throttleMetadata[_]}};function ut(f){return new Headers({Accept:"application/json","x-goog-api-key":f})}function gr(f){return Ot.apply(this,arguments)}function Ot(){return(Ot=(0,E.Z)(function*(f){var _;const{appId:w,apiKey:N}=f,z={method:"GET",headers:ut(N)},W=zn.replace("{app-id}",w),re=yield fetch(W,z);if(200!==re.status&&304!==re.status){let ue="";try{const Le=yield re.json();(null===(_=Le.error)||void 0===_?void 0:_.message)&&(ue=Le.error.message)}catch(Le){}throw lt.create("config-fetch-failed",{httpStatus:re.status,responseMessage:ue})}return re.json()})).apply(this,arguments)}function Ye(f){return An.apply(this,arguments)}function An(){return(An=(0,E.Z)(function*(f,_=_e,w){const{appId:N,apiKey:z,measurementId:W}=f.options;if(!N)throw lt.create("no-app-id");if(!z){if(W)return{measurementId:W,appId:N};throw lt.create("no-api-key")}const re=_.getThrottleMetadata(N)||{backoffCount:0,throttleEndTimeMillis:Date.now()},ue=new yr;return setTimeout((0,E.Z)(function*(){ue.abort()}),void 0!==w?w:6e4),ri({appId:N,apiKey:z,measurementId:W},re,ue,_)})).apply(this,arguments)}function ri(f,_,w){return rn.apply(this,arguments)}function rn(){return(rn=(0,E.Z)(function*(f,{throttleEndTimeMillis:_,backoffCount:w},N,z=_e){const{appId:W,measurementId:re}=f;try{yield ii(N,_)}catch(ue){if(re)return Je.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${re} provided in the "measurementId" field in the local Firebase config. [${ue.message}]`),{appId:W,measurementId:re};throw ue}try{const ue=yield gr(f);return z.deleteThrottleMetadata(W),ue}catch(ue){if(!xt(ue)){if(z.deleteThrottleMetadata(W),re)return Je.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${re} provided in the "measurementId" field in the local Firebase config. [${ue.message}]`),{appId:W,measurementId:re};throw ue}const Le=503===Number(ue.customData.httpStatus)?(0,m.$s)(w,z.intervalMillis,30):(0,m.$s)(w,z.intervalMillis),Ze={throttleEndTimeMillis:Date.now()+Le,backoffCount:w+1};return z.setThrottleMetadata(W,Ze),Je.debug(`Calling attemptFetch again in ${Le} millis`),ri(f,Ze,N,z)}})).apply(this,arguments)}function ii(f,_){return new Promise((w,N)=>{const z=Math.max(_-Date.now(),0),W=setTimeout(w,z);f.addEventListener(()=>{clearTimeout(W),N(lt.create("fetch-throttle",{throttleEndTimeMillis:_}))})})}function xt(f){if(!(f instanceof m.ZR&&f.customData))return!1;const _=Number(f.customData.httpStatus);return 429===_||500===_||503===_||504===_}class yr{constructor(){this.listeners=[]}addEventListener(_){this.listeners.push(_)}abort(){this.listeners.forEach(_=>_())}}function sn(){return vr.apply(this,arguments)}function vr(){return(vr=(0,E.Z)(function*(){if(!(0,m.hl)())return Je.warn(lt.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{yield(0,m.eu)()}catch(f){return Je.warn(lt.create("indexeddb-unavailable",{errorInfo:f}).message),!1}return!0})).apply(this,arguments)}function Zn(){return(Zn=(0,E.Z)(function*(f,_,w,N,z,W,re){var ue;const Le=Ye(f);Le.then(bt=>{w[bt.measurementId]=bt.appId,f.options.measurementId&&bt.measurementId!==f.options.measurementId&&Je.warn(`The measurement ID in the local Firebase config (${f.options.measurementId}) does not match the measurement ID fetched from the server (${bt.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(bt=>Je.error(bt)),_.push(Le);const Ze=sn().then(bt=>{if(bt)return N.getId()}),[Wt,an]=yield Promise.all([Le,Ze]);Oe()||$n(W,Wt.measurementId),z("js",new Date);const Xn=null!==(ue=null==re?void 0:re.config)&&void 0!==ue?ue:{};return Xn.origin="firebase",Xn.update=!0,null!=an&&(Xn[ni]=an),z("config",Wt.measurementId,Xn),Wt.measurementId})).apply(this,arguments)}class ji{constructor(_){this.app=_}_delete(){return delete vt[this.app.options.appId],Promise.resolve()}}let vt={},mn=[];const Er={};let Qn,Mt,Dt="dataLayer",It=!1;function Ct(f,_,w){!function(){const f=[];if((0,m.ru)()&&f.push("This is a browser extension environment."),(0,m.zI)()||f.push("Cookies are not available."),f.length>0){const _=f.map((N,z)=>`(${z+1}) ${N}`).join(" "),w=lt.create("invalid-analytics-context",{errorInfo:_});Je.warn(w.message)}}();const N=f.options.appId;if(!N)throw lt.create("no-app-id");if(!f.options.apiKey){if(!f.options.measurementId)throw lt.create("no-api-key");Je.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${f.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=vt[N])throw lt.create("already-exists",{id:N});if(!It){!function(f){let _=[];Array.isArray(window[f])?_=window[f]:window[f]=_}(Dt);const{wrappedGtag:W,gtagCore:re}=function(f,_,w,N,z){let W=function(...re){window[N].push(arguments)};return window[z]&&"function"==typeof window[z]&&(W=window[z]),window[z]=function(f,_,w,N){function W(){return(W=(0,E.Z)(function*(re,ue,Le){try{"event"===re?yield Ne(f,_,w,ue,Le):"config"===re?yield Kn(f,_,w,N,ue,Le):f("set",ue)}catch(Ze){Je.error(Ze)}})).apply(this,arguments)}return function(re,ue,Le){return W.apply(this,arguments)}}(W,f,_,w),{gtagCore:W,wrappedGtag:window[z]}}(vt,mn,Er,Dt,"gtag");Mt=W,Qn=re,It=!0}return vt[N]=function(f,_,w,N,z,W,re){return Zn.apply(this,arguments)}(f,mn,Er,_,Qn,Dt,w),new ji(f)}function ct(){return(ct=(0,E.Z)(function*(f,_,w,N,z){if(z&&z.global)f("event",w,N);else{const W=yield _;f("event",w,Object.assign(Object.assign({},N),{send_to:W}))}})).apply(this,arguments)}function wr(f=(0,V.Mq)()){f=(0,m.m9)(f);const _=(0,V.qX)(f,Cn);return _.isInitialized()?_.getImmediate():function(f,_={}){const w=(0,V.qX)(f,Cn);if(w.isInitialized()){const z=w.getImmediate();if((0,m.vZ)(_,w.getOptions()))return z;throw lt.create("already-initialized")}return w.initialize({options:_})}(f)}(0,V.Xd)(new Ie.wA(Cn,(_,{options:w})=>Ct(_.getProvider("app").getImmediate(),_.getProvider("installations-internal").getImmediate(),w),"PUBLIC")),(0,V.Xd)(new Ie.wA("analytics-internal",function(_){try{const w=_.getProvider(Cn).getImmediate();return{logEvent:(N,z,W)=>function(f,_,w,N){f=(0,m.m9)(f),function(f,_,w,N,z){return ct.apply(this,arguments)}(Mt,vt[f.app.options.appId],_,w,N).catch(z=>Je.error(z))}(w,N,z,W)}}catch(w){throw lt.create("interop-component-reg-failed",{reason:w})}},"PRIVATE")),(0,V.KN)("@firebase/analytics","0.7.0")},2329:(Rt,Ve,X)=>{"use strict";X.d(Ve,{ZF:()=>E.ZF});var E=X(5452);(0,E.KN)("firebase","9.0.1","app")},1952:(Rt,Ve,X)=>{"use strict";X.d(Ve,{Xb:()=>E.Xb,v0:()=>E.v0,e5:()=>E.e5,w7:()=>E.w7});var E=X(3128)},4963:(Rt,Ve,X)=>{"use strict";X.d(Ve,{iU:()=>Qr,U2:()=>Xa,N8:()=>ml,jM:()=>qa,VF:()=>Ja,iH:()=>$a,i3:()=>Il,t8:()=>ba});var E=X(8239),V=X(5452),me=X(6034),m=X(4685),Ie=X(300);let Se="";class k{constructor(t){this.domStorage_=t,this.prefix_="firebase:"}set(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),(0,m.Pz)(e))}get(t){const e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:(0,m.cI)(e)}remove(t){this.domStorage_.removeItem(this.prefixedName_(t))}prefixedName_(t){return this.prefix_+t}toString(){return this.domStorage_.toString()}}class K{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e}get(t){return(0,m.r3)(this.cache_,t)?this.cache_[t]:null}remove(t){delete this.cache_[t]}}const H=function(n){try{if("undefined"!=typeof window&&void 0!==window[n]){const t=window[n];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new k(t)}}catch(t){}return new K},L=H("localStorage"),Y=H("sessionStorage"),ye=new Ie.Yd("@firebase/database"),we=function(){let n=1;return function(){return n++}}(),B=function(n){const t=(0,m.dS)(n),e=new m.gQ;e.update(t);const i=e.digest();return m.US.encodeByteArray(i)},Z=function(...n){let t="";for(let e=0;e<n.length;e++){const i=n[e];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?t+=Z.apply(null,i):t+="object"==typeof i?(0,m.Pz)(i):i,t+=" "}return t};let ee=null,te=!0;const he=function(...n){if(!0===te&&(te=!1,null===ee&&!0===Y.get("logging_enabled")&&function(n,t){(0,m.hu)(!t||!0===n||!1===n,"Can't turn on custom loggers persistently."),!0===n?(ye.logLevel=Ie.in.VERBOSE,ee=ye.log.bind(ye),t&&Y.set("logging_enabled",!0)):"function"==typeof n?ee=n:(ee=null,Y.remove("logging_enabled"))}(!0)),ee){const t=Z.apply(null,n);ee(t)}},x=function(n){return function(...t){he(n,...t)}},Qe=function(...n){const t="FIREBASE INTERNAL ERROR: "+Z(...n);ye.error(t)},Ee=function(...n){const t=`FIREBASE FATAL ERROR: ${Z(...n)}`;throw ye.error(t),new Error(t)},Be=function(...n){const t="FIREBASE WARNING: "+Z(...n);ye.warn(t)},D=function(n){return"number"==typeof n&&(n!=n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},M="[MIN_NAME]",q="[MAX_NAME]",G=function(n,t){if(n===t)return 0;if(n===M||t===q)return-1;if(t===M||n===q)return 1;{const e=qe(n),i=qe(t);return null!==e?null!==i?e-i==0?n.length-t.length:e-i:-1:null!==i?1:n<t?-1:1}},fe=function(n,t){return n===t?0:n<t?-1:1},Te=function(n,t){if(t&&n in t)return t[n];throw new Error("Missing required key ("+n+") in object: "+(0,m.Pz)(t))},je=function(n){if("object"!=typeof n||null===n)return(0,m.Pz)(n);const t=[];for(const i in n)t.push(i);t.sort();let e="{";for(let i=0;i<t.length;i++)0!==i&&(e+=","),e+=(0,m.Pz)(t[i]),e+=":",e+=je(n[t[i]]);return e+="}",e},ie=function(n,t){const e=n.length;if(e<=t)return[n];const i=[];for(let o=0;o<e;o+=t)i.push(n.substring(o,o+t>e?e:o+t));return i};function ce(n,t){for(const e in n)n.hasOwnProperty(e)&&t(e,n[e])}const ze=function(n){(0,m.hu)(!D(n),"Invalid JSON number");const i=1023;let o,u,c,h,g;0===n?(u=0,c=0,o=1/n==-1/0?1:0):(o=n<0,(n=Math.abs(n))>=Math.pow(2,1-i)?(h=Math.min(Math.floor(Math.log(n)/Math.LN2),i),u=h+i,c=Math.round(n*Math.pow(2,52-h)-Math.pow(2,52))):(u=0,c=Math.round(n/Math.pow(2,-1074))));const y=[];for(g=52;g;g-=1)y.push(c%2?1:0),c=Math.floor(c/2);for(g=11;g;g-=1)y.push(u%2?1:0),u=Math.floor(u/2);y.push(o?1:0),y.reverse();const R=y.join("");let A="";for(g=0;g<64;g+=8){let O=parseInt(R.substr(g,8),2).toString(16);1===O.length&&(O="0"+O),A+=O}return A.toLowerCase()},Pt=new RegExp("^-?(0*)\\d{1,10}$"),qe=function(n){if(Pt.test(n)){const t=Number(n);if(t>=-2147483648&&t<=2147483647)return t}return null},ft=function(n){try{n()}catch(t){setTimeout(()=>{throw Be("Exception was thrown by user callback.",t.stack||""),t},Math.floor(0))}},Tt=function(n,t){const e=setTimeout(n,t);return"object"==typeof e&&e.unref&&e.unref(),e};class dt{constructor(t,e){this.appName_=t,this.appCheckProvider=e,this.appCheck=null==e?void 0:e.getImmediate({optional:!0}),this.appCheck||null==e||e.get().then(i=>this.appCheck=i)}getToken(t){return this.appCheck?this.appCheck.getToken(t):new Promise((e,i)=>{setTimeout(()=>{this.appCheck?this.getToken(t).then(e,i):e(null)},0)})}addTokenChangeListener(t){var e;null===(e=this.appCheckProvider)||void 0===e||e.get().then(i=>i.addTokenListener(t))}notifyForInvalidToken(){Be(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class dn{constructor(t,e,i){this.appName_=t,this.firebaseOptions_=e,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(o=>this.auth_=o)}getToken(t){return this.auth_?this.auth_.getToken(t).catch(e=>e&&"auth/token-not-initialized"===e.code?(he("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((e,i)=>{setTimeout(()=>{this.auth_?this.getToken(t).then(e,i):e(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(e=>e.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(e=>e.removeAuthTokenListener(t))}notifyForInvalidToken(){let t='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';t+="credential"in this.firebaseOptions_?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Be(t)}}let gt=(()=>{class n{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}return n.OWNER="owner",n})();const de=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,tt="websocket",wt="long_polling";class Ke{constructor(t,e,i,o,u=!1,c="",h=!1){this.secure=e,this.namespace=i,this.webSocketOnly=o,this.nodeAdmin=u,this.persistenceKey=c,this.includeNamespaceInQueryParams=h,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=L.get("host:"+t)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&L.set("host:"+this._host,this.internalHost))}toString(){let t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t}toURLString(){return`${this.secure?"https://":"http://"}${this.host}/${this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:""}`}}function hn(n,t,e){let i;if((0,m.hu)("string"==typeof t,"typeof type must == string"),(0,m.hu)("object"==typeof e,"typeof params must == object"),t===tt)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else{if(t!==wt)throw new Error("Unknown connection type: "+t);i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?"}(function(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams})(n)&&(e.ns=n.namespace);const o=[];return ce(e,(u,c)=>{o.push(u+"="+c)}),i+o.join("&")}class Gn{constructor(){this.counters_={}}incrementCounter(t,e=1){(0,m.r3)(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e}get(){return(0,m.p$)(this.counters_)}}const Jt={},Nt={};function Xt(n){const t=n.toString();return Jt[t]||(Jt[t]=new Gn),Jt[t]}class wn{constructor(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(t,e){for(this.pendingResponses[t]=e;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let o=0;o<i.length;++o)i[o]&&ft(()=>{this.onMessage_(i[o])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class kt{constructor(t,e,i,o,u,c,h){this.connId=t,this.repoInfo=e,this.applicationId=i,this.appCheckToken=o,this.authToken=u,this.transportSessionId=c,this.lastSessionId=h,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=x(t),this.stats_=Xt(e),this.urlFn=g=>(this.appCheckToken&&(g.ac=this.appCheckToken),hn(e,wt,g))}open(t,e){this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new wn(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(n){if((0,m.Yr)()||"complete"===document.readyState)n();else{let t=!1;const e=function(){document.body?t||(t=!0,n()):setTimeout(e,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",e,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&e()}),window.attachEvent("onload",e))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Bn((...u)=>{const[c,h,g,y,R]=u;if(this.incrementIncomingBytes_(u),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===c)this.id=h,this.password=g;else{if("close"!==c)throw new Error("Unrecognized command received: "+c);h?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(h,()=>{this.onClosed_()})):this.onClosed_()}},(...u)=>{const[c,h]=u;this.incrementIncomingBytes_(u),this.myPacketOrderer.handleResponse(c,h)},()=>{this.onClosed_()},this.urlFn);const i={start:"t"};i.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(i.cb=this.scriptTagHolder.uniqueCallbackIdentifier),i.v="5",this.transportSessionId&&(i.s=this.transportSessionId),this.lastSessionId&&(i.ls=this.lastSessionId),this.applicationId&&(i.p=this.applicationId),this.appCheckToken&&(i.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&de.test(location.hostname)&&(i.r="f");const o=this.urlFn(i);this.log_("Connecting via long-poll to "+o),this.scriptTagHolder.addTag(o,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){kt.forceAllow_=!0}static forceDisallow(){kt.forceDisallow_=!0}static isAvailable(){return!((0,m.Yr)()||!kt.forceAllow_&&(kt.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(t){const e=(0,m.Pz)(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const i=(0,m.h$)(e),o=ie(i,1840);for(let u=0;u<o.length;u++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,o.length,o[u]),this.curSegmentNum++}addDisconnectPingFrame(t,e){if((0,m.Yr)())return;this.myDisconnFrame=document.createElement("iframe");const i={dframe:"t"};i.id=t,i.pw=e,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(t){const e=(0,m.Pz)(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)}}class Bn{constructor(t,e,i,o){if(this.onDisconnect=i,this.urlFn=o,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,m.Yr)())this.commandCB=t,this.onMessageCB=e;else{this.uniqueCallbackIdentifier=we(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=e,this.myIFrame=Bn.createIFrame_();let u="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(u='<script>document.domain="'+document.domain+'";<\/script>');const c="<html><body>"+u+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(c),this.myIFrame.doc.close()}catch(h){he("frame writing exception"),h.stack&&he(h.stack),he(h)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||he("No IE domain setting required")}catch(e){const i=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const t=this.onDisconnect;t&&(this.onDisconnect=null,t())}startLongPoll(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;let e=this.urlFn(t),i="",o=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+i.length<=1870;){const c=this.pendingSegs.shift();i=i+"&seg"+o+"="+c.seg+"&ts"+o+"="+c.ts+"&d"+o+"="+c.d,o++}return e+=i,this.addLongPollTag_(e,this.currentSerial),!0}return!1}enqueueSegment(t,e,i){this.pendingSegs.push({seg:t,ts:e,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(t,e){this.outstandingRequests.add(e);const i=()=>{this.outstandingRequests.delete(e),this.newRequest_()},o=setTimeout(i,Math.floor(25e3));this.addTag(t,()=>{clearTimeout(o),i()})}addTag(t,e){(0,m.Yr)()?this.doNodeLongPoll(t,e):setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=t,i.onload=i.onreadystatechange=function(){const o=i.readyState;(!o||"loaded"===o||"complete"===o)&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),e())},i.onerror=()=>{he("Long-poll script failed to load: "+t),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch(i){}},Math.floor(1))}}let Hn=null;"undefined"!=typeof MozWebSocket?Hn=MozWebSocket:"undefined"!=typeof WebSocket&&(Hn=WebSocket);let tn=(()=>{class n{constructor(e,i,o,u,c,h,g){this.connId=e,this.applicationId=o,this.appCheckToken=u,this.authToken=c,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=x(this.connId),this.stats_=Xt(i),this.connURL=n.connectionURL_(i,h,g,u),this.nodeAdmin=i.nodeAdmin}static connectionURL_(e,i,o,u){const c={v:"5"};return!(0,m.Yr)()&&"undefined"!=typeof location&&location.hostname&&de.test(location.hostname)&&(c.r="f"),i&&(c.s=i),o&&(c.ls=o),u&&(c.ac=u),hn(e,tt,c)}open(e,i){this.onDisconnect=i,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,L.set("previous_websocket_failure",!0);try{if((0,m.Yr)()){const u={headers:{"User-Agent":`Firebase/5/${Se}/${process.platform}/${this.nodeAdmin?"AdminNode":"Node"}`,"X-Firebase-GMPID":this.applicationId||""}};this.authToken&&(u.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(u.headers["X-Firebase-AppCheck"]=this.appCheckToken);const c=process.env,h=0===this.connURL.indexOf("wss://")?c.HTTPS_PROXY||c.https_proxy:c.HTTP_PROXY||c.http_proxy;h&&(u.proxy={origin:h}),this.mySock=new Hn(this.connURL,[],u)}else this.mySock=new Hn(this.connURL,[],{headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}})}catch(o){this.log_("Error instantiating WebSocket.");const u=o.message||o.data;return u&&this.log_(u),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=o=>{this.handleIncomingFrame(o)},this.mySock.onerror=o=>{this.log_("WebSocket error.  Closing connection.");const u=o.message||o.data;u&&this.log_(u),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const o=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);o&&o.length>1&&parseFloat(o[1])<4.4&&(e=!0)}return!e&&null!==Hn&&!n.forceDisallow_}static previouslyFailed(){return L.isInMemoryStorage||!0===L.get("previous_websocket_failure")}markConnectionHealthy(){L.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const i=this.frames.join("");this.frames=null;const o=(0,m.cI)(i);this.onMessage(o)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if((0,m.hu)(null===this.frames,"We already have a frame buffer"),e.length<=6){const i=Number(e);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const i=e.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(i);else{const o=this.extractFrameCount_(i);null!==o&&this.appendFrame_(o)}}send(e){this.resetKeepAlive();const i=(0,m.Pz)(e);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);const o=ie(i,16384);o.length>1&&this.sendString_(String(o.length));for(let u=0;u<o.length;u++)this.sendString_(o[u])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}return n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4,n})();class cr{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[kt,tn]}initTransports_(t){const e=tn&&tn.isAvailable();let i=e&&!tn.previouslyFailed();if(t.webSocketOnly&&(e||Be("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[tn];else{const o=this.transports_=[];for(const u of cr.ALL_TRANSPORTS)u&&u.isAvailable()&&o.push(u)}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}class Je{constructor(t,e,i,o,u,c,h,g,y,R){this.id=t,this.repoInfo_=e,this.applicationId_=i,this.appCheckToken_=o,this.authToken_=u,this.onMessage_=c,this.onReady_=h,this.onDisconnect_=g,this.onKill_=y,this.lastSessionId=R,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=x("c:"+this.id+":"),this.transportManager_=new cr(e),this.log_("Connection created"),this.start_()}start_(){const t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const e=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(e,i)},Math.floor(0));const o=t.healthyTimeout||0;o>0&&(this.healthyTimeout_=Tt(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(o)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(t){this.sendData_({t:"d",d:t})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(t){if("t"in t){const e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(t){const e=Te("t",t),i=Te("d",t);if("c"===e)this.onSecondaryControl_(i);else{if("d"!==e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(i)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(t){const e=Te("t",t),i=Te("d",t);"c"===e?this.onControl_(i):"d"===e&&this.onDataMessage_(i)}onDataMessage_(t){this.onPrimaryResponse_(),this.onMessage_(t)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(t){const e=Te("t",t);if("d"in t){const i=t.d;if("h"===e)this.onHandshake_(i);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let o=0;o<this.pendingDataMessages.length;++o)this.onDataMessage_(this.pendingDataMessages[o]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(i):"r"===e?this.onReset_(i):"e"===e?Qe("Server Error: "+i):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Qe("Unknown control packet command: "+e)}}onHandshake_(t){const e=t.ts,i=t.v,o=t.h;this.sessionId=t.s,this.repoInfo_.host=o,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==i&&Be("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)}startUpgrade_(t){this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const e=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(e,i),Tt(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.host=t,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(t,e){this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Tt(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&1===this.state_&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const t=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===t||this.rx_===t)&&this.close()}onConnectionLost_(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(L.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class _r{put(t,e,i,o){}merge(t,e,i,o){}refreshAuthToken(t){}refreshAppCheckToken(t){}onDisconnectPut(t,e,i){}onDisconnectMerge(t,e,i){}onDisconnectCancel(t,e){}reportStats(t){}}class $n{constructor(t){this.allowedEvents_=t,this.listeners_={},(0,m.hu)(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}trigger(t,...e){if(Array.isArray(this.listeners_[t])){const i=[...this.listeners_[t]];for(let o=0;o<i.length;o++)i[o].callback.apply(i[o].context,e)}}on(t,e,i){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:i});const o=this.getInitialEvent(t);o&&e.apply(i,o)}off(t,e,i){this.validateEventType_(t);const o=this.listeners_[t]||[];for(let u=0;u<o.length;u++)if(o[u].callback===e&&(!i||i===o[u].context))return void o.splice(u,1)}validateEventType_(t){(0,m.hu)(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}}class qn extends $n{constructor(){super(["online"]),this.online_=!0,"undefined"!=typeof window&&void 0!==window.addEventListener&&!(0,m.uI)()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new qn}getInitialEvent(t){return(0,m.hu)("online"===t,"Unknown event type: "+t),[this.online_]}currentlyOnline(){return this.online_}}class Ne{constructor(t,e){if(void 0===e){this.pieces_=t.split("/");let i=0;for(let o=0;o<this.pieces_.length;o++)this.pieces_[o].length>0&&(this.pieces_[i]=this.pieces_[o],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}toString(){let t="";for(let e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"}}function be(){return new Ne("")}function ge(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function zt(n){return n.pieces_.length-n.pieceNum_}function Oe(n){let t=n.pieceNum_;return t<n.pieces_.length&&t++,new Ne(n.pieces_,t)}function mr(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function bn(n,t=0){return n.pieces_.slice(n.pieceNum_+t)}function Yn(n){if(n.pieceNum_>=n.pieces_.length)return null;const t=[];for(let e=n.pieceNum_;e<n.pieces_.length-1;e++)t.push(n.pieces_[e]);return new Ne(t,0)}function We(n,t){const e=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)e.push(n.pieces_[i]);if(t instanceof Ne)for(let i=t.pieceNum_;i<t.pieces_.length;i++)e.push(t.pieces_[i]);else{const i=t.split("/");for(let o=0;o<i.length;o++)i[o].length>0&&e.push(i[o])}return new Ne(e,0)}function _e(n){return n.pieceNum_>=n.pieces_.length}function ut(n,t){const e=ge(n),i=ge(t);if(null===e)return t;if(e===i)return ut(Oe(n),Oe(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+n+")")}function Ot(n,t){if(zt(n)!==zt(t))return!1;for(let e=n.pieceNum_,i=t.pieceNum_;e<=n.pieces_.length;e++,i++)if(n.pieces_[e]!==t.pieces_[i])return!1;return!0}function Ye(n,t){let e=n.pieceNum_,i=t.pieceNum_;if(zt(n)>zt(t))return!1;for(;e<n.pieces_.length;){if(n.pieces_[e]!==t.pieces_[i])return!1;++e,++i}return!0}class An{constructor(t,e){this.errorPrefix_=e,this.parts_=bn(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=(0,m.ug)(this.parts_[i]);ii(this)}}function ii(n){if(n.byteLength_>768)throw new Error(n.errorPrefix_+"has a key path longer than 768 bytes ("+n.byteLength_+").");if(n.parts_.length>32)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+xt(n))}function xt(n){return 0===n.parts_.length?"":"in property '"+n.parts_.join(".")+"'"}class yr extends $n{constructor(){let t,e;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(e="visibilitychange",t="hidden"):void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(e="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,()=>{const i=!document[t];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}static getInstance(){return new yr}getInitialEvent(t){return(0,m.hu)("visible"===t,"Unknown event type: "+t),[this.visible_]}}const sn=1e3;let Mt,Dt=(()=>{class n extends _r{constructor(e,i,o,u,c,h,g,y){if(super(),this.repoInfo_=e,this.applicationId_=i,this.onDataUpdate_=o,this.onConnectStatus_=u,this.onServerInfoUpdate_=c,this.authTokenProvider_=h,this.appCheckTokenProvider_=g,this.authOverride_=y,this.id=n.nextPersistentConnectionId_++,this.log_=x("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=sn,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,y&&!(0,m.Yr)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");yr.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&qn.getInstance().on("online",this.onOnline_,this)}sendRequest(e,i,o){const u=++this.requestNumber_,c={r:u,a:e,b:i};this.log_((0,m.Pz)(c)),(0,m.hu)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(c),o&&(this.requestCBHash_[u]=o)}get(e){this.initConnection_();const i=new m.BH,o={p:e._path.toString(),q:e._queryObject},u={action:"g",request:o,onComplete:h=>{const g=h.d;"ok"===h.s?(this.onDataUpdate_(o.p,g,!1,null),i.resolve(g)):i.reject(g)}};this.outstandingGets_.push(u),this.outstandingGetCount_++;const c=this.outstandingGets_.length-1;return this.connected_||setTimeout(()=>{const h=this.outstandingGets_[c];void 0===h||u!==h||(delete this.outstandingGets_[c],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),this.log_("get "+c+" timed out on connection"),i.reject(new Error("Client is offline.")))},3e3),this.connected_&&this.sendGet_(c),i.promise}listen(e,i,o,u){this.initConnection_();const c=e._queryIdentifier,h=e._path.toString();this.log_("Listen called for "+h+" "+c),this.listens.has(h)||this.listens.set(h,new Map),(0,m.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,m.hu)(!this.listens.get(h).has(c),"listen() called twice for same path/queryId.");const g={onComplete:u,hashFn:i,query:e,tag:o};this.listens.get(h).set(c,g),this.connected_&&this.sendListen_(g)}sendGet_(e){const i=this.outstandingGets_[e];this.sendRequest("g",i.request,o=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(o)})}sendListen_(e){const i=e.query,o=i._path.toString(),u=i._queryIdentifier;this.log_("Listen on "+o+" for "+u);const c={p:o};e.tag&&(c.q=i._queryObject,c.t=e.tag),c.h=e.hashFn(),this.sendRequest("q",c,g=>{const y=g.d,R=g.s;n.warnOnListenWarnings_(y,i),(this.listens.get(o)&&this.listens.get(o).get(u))===e&&(this.log_("listen response",g),"ok"!==R&&this.removeListen_(o,u),e.onComplete&&e.onComplete(R,y))})}static warnOnListenWarnings_(e,i){if(e&&"object"==typeof e&&(0,m.r3)(e,"w")){const o=(0,m.DV)(e,"w");if(Array.isArray(o)&&~o.indexOf("no_index")){const u='".indexOn": "'+i._queryParams.getIndex().toString()+'"',c=i._path.toString();Be(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${u} at ${c} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||(0,m.GJ)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,i=(0,m.w9)(e)?"auth":"gauth",o={cred:e};null===this.authOverride_?o.noauth=!0:"object"==typeof this.authOverride_&&(o.authvar=this.authOverride_),this.sendRequest(i,o,u=>{const c=u.s,h=u.d||"error";this.authToken_===e&&("ok"===c?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(c,h))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const i=e.s,o=e.d||"error";"ok"===i?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,o)})}unlisten(e,i){const o=e._path.toString(),u=e._queryIdentifier;this.log_("Unlisten called for "+o+" "+u),(0,m.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(o,u)&&this.connected_&&this.sendUnlisten_(o,u,e._queryObject,i)}sendUnlisten_(e,i,o,u){this.log_("Unlisten on "+e+" for "+i);const c={p:e};u&&(c.q=o,c.t=u),this.sendRequest("n",c)}onDisconnectPut(e,i,o){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,i,o):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:i,onComplete:o})}onDisconnectMerge(e,i,o){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,i,o):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:i,onComplete:o})}onDisconnectCancel(e,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(e,i,o,u){const c={p:i,d:o};this.log_("onDisconnect "+e,c),this.sendRequest(e,c,h=>{u&&setTimeout(()=>{u(h.s,h.d)},Math.floor(0))})}put(e,i,o,u){this.putInternal("p",e,i,o,u)}merge(e,i,o,u){this.putInternal("m",e,i,o,u)}putInternal(e,i,o,u,c){this.initConnection_();const h={p:i,d:o};void 0!==c&&(h.h=c),this.outstandingPuts_.push({action:e,request:h,onComplete:u}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+i)}sendPut_(e){const i=this.outstandingPuts_[e].action,o=this.outstandingPuts_[e].request,u=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(i,o,c=>{this.log_(i+" response",c),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),u&&u(c.s,c.d)})}reportStats(e){if(this.connected_){const i={c:e};this.log_("reportStats",i),this.sendRequest("s",i,o=>{"ok"!==o.s&&this.log_("reportStats","Error sending stats: "+o.d)})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+(0,m.Pz)(e));const i=e.r,o=this.requestCBHash_[i];o&&(delete this.requestCBHash_[i],o(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,i){this.log_("handleServerMessage",e,i),"d"===e?this.onDataUpdate_(i.p,i.d,!1,i.t):"m"===e?this.onDataUpdate_(i.p,i.d,!0,i.t):"c"===e?this.onListenRevoked_(i.p,i.q):"ac"===e?this.onAuthRevoked_(i.s,i.d):"apc"===e?this.onAppCheckRevoked_(i.s,i.d):"sd"===e?this.onSecurityDebugPacket_(i):Qe("Unrecognized action received from server: "+(0,m.Pz)(e)+"\nAre you using the latest client?")}onReady_(e,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){(0,m.hu)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=sn,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=sn,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=sn),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let i=Math.max(0,this.reconnectDelay_-e);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}establishConnection_(){var e=this;return(0,E.Z)(function*(){if(e.shouldReconnect_()){e.log_("Making a connection attempt"),e.lastConnectionAttemptTime_=(new Date).getTime(),e.lastConnectionEstablishedTime_=null;const i=e.onDataMessage_.bind(e),o=e.onReady_.bind(e),u=e.onRealtimeDisconnect_.bind(e),c=e.id+":"+n.nextConnectionId_++,h=e.lastSessionId;let g=!1,y=null;const R=function(){y?y.close():(g=!0,u())};e.realtime_={close:R,sendRequest:function(Q){(0,m.hu)(y,"sendRequest call when we're not connected not allowed."),y.sendRequest(Q)}};const O=e.forceTokenRefresh_;e.forceTokenRefresh_=!1;try{const[Q,ae]=yield Promise.all([e.authTokenProvider_.getToken(O),e.appCheckTokenProvider_.getToken(O)]);g?he("getToken() completed but was canceled"):(he("getToken() completed. Creating connection."),e.authToken_=Q&&Q.accessToken,e.appCheckToken_=ae&&ae.token,y=new Je(c,e.repoInfo_,e.applicationId_,e.appCheckToken_,e.authToken_,i,o,u,Ge=>{Be(Ge+" ("+e.repoInfo_.toString()+")"),e.interrupt("server_kill")},h))}catch(Q){e.log_("Failed to get token: "+Q),g||(e.repoInfo_.nodeAdmin&&Be(Q),R())}}})()}interrupt(e){he("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){he("Resuming connection for reason: "+e),delete this.interruptReasons_[e],(0,m.xb)(this.interruptReasons_)&&(this.reconnectDelay_=sn,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const i=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const i=this.outstandingPuts_[e];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,i){let o;o=i?i.map(c=>je(c)).join("$"):"default";const u=this.removeListen_(e,o);u&&u.onComplete&&u.onComplete("permission_denied")}removeListen_(e,i){const o=new Ne(e).toString();let u;if(this.listens.has(o)){const c=this.listens.get(o);u=c.get(i),c.delete(i),0===c.size&&this.listens.delete(o)}else u=void 0;return u}onAuthRevoked_(e,i){he("Auth token revoked: "+e+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,i){he("App check token revoked: "+e+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const i of e.values())this.sendListen_(i);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let i="js";(0,m.Yr)()&&(i=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+i+"."+Se.replace(/\./g,"-")]=1,(0,m.uI)()?e["framework.cordova"]=1:(0,m.b$)()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=qn.getInstance().currentlyOnline();return(0,m.xb)(this.interruptReasons_)&&e}}return n.nextPersistentConnectionId_=0,n.nextConnectionId_=0,n})();class pe{constructor(t,e){this.name=t,this.node=e}static Wrap(t,e){return new pe(t,e)}}class Qn{getCompare(){return this.compare.bind(this)}indexedValueChanged(t,e){const i=new pe(M,t),o=new pe(M,e);return 0!==this.compare(i,o)}minPost(){return pe.MIN}}class It extends Qn{static get __EMPTY_NODE(){return Mt}static set __EMPTY_NODE(t){Mt=t}compare(t,e){return G(t.name,e.name)}isDefinedOn(t){throw(0,m.g5)("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(t,e){return!1}minPost(){return pe.MIN}maxPost(){return new pe(q,Mt)}makePost(t,e){return(0,m.hu)("string"==typeof t,"KeyIndex indexValue must always be a string."),new pe(t,Mt)}toString(){return".key"}}const Lt=new It;class on{constructor(t,e,i,o,u=null){this.isReverse_=o,this.resultGenerator_=u,this.nodeStack_=[];let c=1;for(;!t.isEmpty();)if(t=t,c=e?i(t.key,e):1,o&&(c*=-1),c<0)t=this.isReverse_?t.left:t.right;else{if(0===c){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}}}let Tr,Ct=(()=>{class n{constructor(e,i,o,u,c){this.key=e,this.value=i,this.color=null!=o?o:n.RED,this.left=null!=u?u:ct.EMPTY_NODE,this.right=null!=c?c:ct.EMPTY_NODE}copy(e,i,o,u,c){return new n(null!=e?e:this.key,null!=i?i:this.value,null!=o?o:this.color,null!=u?u:this.left,null!=c?c:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,i,o){let u=this;const c=o(e,u.key);return u=c<0?u.copy(null,null,null,u.left.insert(e,i,o),null):0===c?u.copy(null,i,null,null,null):u.copy(null,null,null,null,u.right.insert(e,i,o)),u.fixUp_()}removeMin_(){if(this.left.isEmpty())return ct.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,i){let o,u;if(o=this,i(e,o.key)<0)!o.left.isEmpty()&&!o.left.isRed_()&&!o.left.left.isRed_()&&(o=o.moveRedLeft_()),o=o.copy(null,null,null,o.left.remove(e,i),null);else{if(o.left.isRed_()&&(o=o.rotateRight_()),!o.right.isEmpty()&&!o.right.isRed_()&&!o.right.left.isRed_()&&(o=o.moveRedRight_()),0===i(e,o.key)){if(o.right.isEmpty())return ct.EMPTY_NODE;u=o.right.min_(),o=o.copy(u.key,u.value,null,null,o.right.removeMin_())}o=o.copy(null,null,null,null,o.right.remove(e,i))}return o.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,i)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})();class ct{constructor(t,e=ct.EMPTY_NODE){this.comparator_=t,this.root_=e}insert(t,e){return new ct(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,Ct.BLACK,null,null))}remove(t){return new ct(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Ct.BLACK,null,null))}get(t){let e,i=this.root_;for(;!i.isEmpty();){if(e=this.comparator_(t,i.key),0===e)return i.value;e<0?i=i.left:e>0&&(i=i.right)}return null}getPredecessorKey(t){let e,i=this.root_,o=null;for(;!i.isEmpty();){if(e=this.comparator_(t,i.key),0===e){if(i.left.isEmpty())return o?o.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}e<0?i=i.left:e>0&&(o=i,i=i.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(t){return this.root_.inorderTraversal(t)}reverseTraversal(t){return this.root_.reverseTraversal(t)}getIterator(t){return new on(this.root_,null,this.comparator_,!1,t)}getIteratorFrom(t,e){return new on(this.root_,t,this.comparator_,!1,e)}getReverseIteratorFrom(t,e){return new on(this.root_,t,this.comparator_,!0,e)}getReverseIterator(t){return new on(this.root_,null,this.comparator_,!0,t)}}function zi(n,t){return G(n.name,t.name)}function Ft(n,t){return G(n,t)}ct.EMPTY_NODE=new class{copy(t,e,i,o,u){return this}insert(t,e,i){return new Ct(t,e,null)}remove(t,e){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const $i=function(n){return"number"==typeof n?"number:"+ze(n):"string:"+n},Rn=function(n){if(n.isLeafNode()){const t=n.val();(0,m.hu)("string"==typeof t||"number"==typeof t||"object"==typeof t&&(0,m.r3)(t,".sv"),"Priority must be a string or number.")}else(0,m.hu)(n===Tr||n.isEmpty(),"priority of unexpected type.");(0,m.hu)(n===Tr||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Jn,wr,qi,Xe=(()=>{class n{constructor(e,i=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=i,this.lazyHash_=null,(0,m.hu)(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),Rn(this.priorityNode_)}static set __childrenNodeConstructor(e){Jn=e}static get __childrenNodeConstructor(){return Jn}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new n(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return _e(e)?this:".priority"===ge(e)?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,i){return null}updateImmediateChild(e,i){return".priority"===e?this.updatePriority(i):i.isEmpty()&&".priority"!==e?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,i).updatePriority(this.priorityNode_)}updateChild(e,i){const o=ge(e);return null===o?i:i.isEmpty()&&".priority"!==o?this:((0,m.hu)(".priority"!==o||1===zt(e),".priority must be the last token in a path"),this.updateImmediateChild(o,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(Oe(e),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,i){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+$i(this.priorityNode_.val())+":");const i=typeof this.value_;e+=i+":",e+="number"===i?ze(this.value_):this.value_,this.lazyHash_=B(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===n.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof n.__childrenNodeConstructor?-1:((0,m.hu)(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const i=typeof e.value_,o=typeof this.value_,u=n.VALUE_TYPE_ORDER.indexOf(i),c=n.VALUE_TYPE_ORDER.indexOf(o);return(0,m.hu)(u>=0,"Unknown leaf type: "+i),(0,m.hu)(c>=0,"Unknown leaf type: "+o),u===c?"object"===o?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:c-u}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const i=e;return this.value_===i.value_&&this.priorityNode_.equals(i.priorityNode_)}return!1}}return n.VALUE_TYPE_ORDER=["object","boolean","number","string"],n})();const Me=new class extends Qn{compare(t,e){const i=t.node.getPriority(),o=e.node.getPriority(),u=i.compareTo(o);return 0===u?G(t.name,e.name):u}isDefinedOn(t){return!t.getPriority().isEmpty()}indexedValueChanged(t,e){return!t.getPriority().equals(e.getPriority())}minPost(){return pe.MIN}maxPost(){return new pe(q,new Xe("[PRIORITY-POST]",qi))}makePost(t,e){const i=wr(t);return new pe(e,new Xe("[PRIORITY-POST]",i))}toString(){return".priority"}},ko=Math.log(2);class oi{constructor(t){this.count=parseInt(Math.log(t+1)/ko,10),this.current_=this.count-1;const o=(u=>parseInt(Array(this.count+1).join("1"),2))();this.bits_=t+1&o}nextBitIsOne(){const t=!(this.bits_&1<<this.current_);return this.current_--,t}}const yn=function(n,t,e,i){n.sort(t);const o=function(g,y){const R=y-g;let A,O;if(0===R)return null;if(1===R)return A=n[g],O=e?e(A):A,new Ct(O,A.node,Ct.BLACK,null,null);{const Q=parseInt(R/2,10)+g,ae=o(g,Q),Ge=o(Q+1,y);return A=n[Q],O=e?e(A):A,new Ct(O,A.node,Ct.BLACK,ae,Ge)}},h=function(g){let y=null,R=null,A=n.length;const O=function(ae,Ge){const mt=A-ae,Sa=A;A-=ae;const No=o(mt+1,Sa),Ra=n[mt],El=e?e(Ra):Ra;Q(new Ct(El,Ra.node,Ge,null,No))},Q=function(ae){y?(y.left=ae,y=ae):(R=ae,y=ae)};for(let ae=0;ae<g.count;++ae){const Ge=g.nextBitIsOne(),mt=Math.pow(2,g.count-(ae+1));Ge?O(mt,Ct.BLACK):(O(mt,Ct.BLACK),O(mt,Ct.RED))}return R}(new oi(n.length));return new ct(i||t,h)};let Pn;const Ut={};class Et{constructor(t,e){this.indexes_=t,this.indexSet_=e}static get Default(){return(0,m.hu)(Ut&&Me,"ChildrenNode.ts has not been loaded"),Pn=Pn||new Et({".priority":Ut},{".priority":Me}),Pn}get(t){const e=(0,m.DV)(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof ct?e:null}hasIndex(t){return(0,m.r3)(this.indexSet_,t.toString())}addIndex(t,e){(0,m.hu)(t!==Lt,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let o=!1;const u=e.getIterator(pe.Wrap);let h,c=u.getNext();for(;c;)o=o||t.isDefinedOn(c.node),i.push(c),c=u.getNext();h=o?yn(i,t.getCompare()):Ut;const g=t.toString(),y=Object.assign({},this.indexSet_);y[g]=t;const R=Object.assign({},this.indexes_);return R[g]=h,new Et(R,y)}addToIndexes(t,e){const i=(0,m.UI)(this.indexes_,(o,u)=>{const c=(0,m.DV)(this.indexSet_,u);if((0,m.hu)(c,"Missing index implementation for "+u),o===Ut){if(c.isDefinedOn(t.node)){const h=[],g=e.getIterator(pe.Wrap);let y=g.getNext();for(;y;)y.name!==t.name&&h.push(y),y=g.getNext();return h.push(t),yn(h,c.getCompare())}return Ut}{const h=e.get(t.name);let g=o;return h&&(g=g.remove(new pe(t.name,h))),g.insert(t,t.node)}});return new Et(i,this.indexSet_)}removeFromIndexes(t,e){const i=(0,m.UI)(this.indexes_,o=>{if(o===Ut)return o;{const u=e.get(t.name);return u?o.remove(new pe(t.name,u)):o}});return new Et(i,this.indexSet_)}}let f,_=(()=>{class n{constructor(e,i,o){this.children_=e,this.priorityNode_=i,this.indexMap_=o,this.lazyHash_=null,this.priorityNode_&&Rn(this.priorityNode_),this.children_.isEmpty()&&(0,m.hu)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return f||(f=new n(new ct(Ft),null,Et.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||f}updatePriority(e){return this.children_.isEmpty()?this:new n(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const i=this.children_.get(e);return null===i?f:i}}getChild(e){const i=ge(e);return null===i?this:this.getImmediateChild(i).getChild(Oe(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,i){if((0,m.hu)(i,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(i);{const o=new pe(e,i);let u,c;i.isEmpty()?(u=this.children_.remove(e),c=this.indexMap_.removeFromIndexes(o,this.children_)):(u=this.children_.insert(e,i),c=this.indexMap_.addToIndexes(o,this.children_));const h=u.isEmpty()?f:this.priorityNode_;return new n(u,h,c)}}updateChild(e,i){const o=ge(e);if(null===o)return i;{(0,m.hu)(".priority"!==ge(e)||1===zt(e),".priority must be the last token in a path");const u=this.getImmediateChild(o).updateChild(Oe(e),i);return this.updateImmediateChild(o,u)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const i={};let o=0,u=0,c=!0;if(this.forEachChild(Me,(h,g)=>{i[h]=g.val(e),o++,c&&n.INTEGER_REGEXP_.test(h)?u=Math.max(u,Number(h)):c=!1}),!e&&c&&u<2*o){const h=[];for(const g in i)h[g]=i[g];return h}return e&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+$i(this.getPriority().val())+":"),this.forEachChild(Me,(i,o)=>{const u=o.hash();""!==u&&(e+=":"+i+":"+u)}),this.lazyHash_=""===e?"":B(e)}return this.lazyHash_}getPredecessorChildName(e,i,o){const u=this.resolveIndex_(o);if(u){const c=u.getPredecessorKey(new pe(e,i));return c?c.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const i=this.resolveIndex_(e);if(i){const o=i.minKey();return o&&o.name}return this.children_.minKey()}getFirstChild(e){const i=this.getFirstChildName(e);return i?new pe(i,this.children_.get(i)):null}getLastChildName(e){const i=this.resolveIndex_(e);if(i){const o=i.maxKey();return o&&o.name}return this.children_.maxKey()}getLastChild(e){const i=this.getLastChildName(e);return i?new pe(i,this.children_.get(i)):null}forEachChild(e,i){const o=this.resolveIndex_(e);return o?o.inorderTraversal(u=>i(u.name,u.node)):this.children_.inorderTraversal(i)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,i){const o=this.resolveIndex_(i);if(o)return o.getIteratorFrom(e,u=>u);{const u=this.children_.getIteratorFrom(e.name,pe.Wrap);let c=u.peek();for(;null!=c&&i.compare(c,e)<0;)u.getNext(),c=u.peek();return u}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,i){const o=this.resolveIndex_(i);if(o)return o.getReverseIteratorFrom(e,u=>u);{const u=this.children_.getReverseIteratorFrom(e.name,pe.Wrap);let c=u.peek();for(;null!=c&&i.compare(c,e)>0;)u.getNext(),c=u.peek();return u}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===N?-1:0}withIndex(e){if(e===Lt||this.indexMap_.hasIndex(e))return this;{const i=this.indexMap_.addIndex(e,this.children_);return new n(this.children_,this.priorityNode_,i)}}isIndexed(e){return e===Lt||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const i=e;if(this.getPriority().equals(i.getPriority())){if(this.children_.count()===i.children_.count()){const o=this.getIterator(Me),u=i.getIterator(Me);let c=o.getNext(),h=u.getNext();for(;c&&h;){if(c.name!==h.name||!c.node.equals(h.node))return!1;c=o.getNext(),h=u.getNext()}return null===c&&null===h}return!1}return!1}}resolveIndex_(e){return e===Lt?null:this.indexMap_.get(e.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})();const N=new class extends _{constructor(){super(new ct(Ft),_.EMPTY_NODE,Et.Default)}compareTo(t){return t===this?0:1}equals(t){return t===this}getPriority(){return this}getImmediateChild(t){return _.EMPTY_NODE}isEmpty(){return!1}};function W(n,t=null){if(null===n)return _.EMPTY_NODE;if("object"==typeof n&&".priority"in n&&(t=n[".priority"]),(0,m.hu)(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof n&&".value"in n&&null!==n[".value"]&&(n=n[".value"]),"object"!=typeof n||".sv"in n)return new Xe(n,W(t));if(n instanceof Array){let e=_.EMPTY_NODE;return ce(n,(i,o)=>{if((0,m.r3)(n,i)&&"."!==i.substring(0,1)){const u=W(o);(u.isLeafNode()||!u.isEmpty())&&(e=e.updateImmediateChild(i,u))}}),e.updatePriority(W(t))}{const e=[];let i=!1;if(ce(n,(c,h)=>{if("."!==c.substring(0,1)){const g=W(h);g.isEmpty()||(i=i||!g.getPriority().isEmpty(),e.push(new pe(c,g)))}}),0===e.length)return _.EMPTY_NODE;const u=yn(e,zi,c=>c.name,Ft);if(i){const c=yn(e,Me.getCompare());return new _(u,W(t),new Et({".priority":c},{".priority":Me}))}return new _(u,W(t),Et.Default)}}Object.defineProperties(pe,{MIN:{value:new pe(M,_.EMPTY_NODE)},MAX:{value:new pe(q,N)}}),It.__EMPTY_NODE=_.EMPTY_NODE,Xe.__childrenNodeConstructor=_,Tr=N,qi=N,function(n){wr=n}(W);class re extends Qn{constructor(t){super(),this.indexPath_=t,(0,m.hu)(!_e(t)&&".priority"!==ge(t),"Can't create PathIndex with empty path or .priority key")}extractChild(t){return t.getChild(this.indexPath_)}isDefinedOn(t){return!t.getChild(this.indexPath_).isEmpty()}compare(t,e){const i=this.extractChild(t.node),o=this.extractChild(e.node),u=i.compareTo(o);return 0===u?G(t.name,e.name):u}makePost(t,e){const i=W(t),o=_.EMPTY_NODE.updateChild(this.indexPath_,i);return new pe(e,o)}maxPost(){const t=_.EMPTY_NODE.updateChild(this.indexPath_,N);return new pe(q,t)}toString(){return bn(this.indexPath_,0).join("/")}}const Le=new class extends Qn{compare(t,e){const i=t.node.compareTo(e.node);return 0===i?G(t.name,e.name):i}isDefinedOn(t){return!0}indexedValueChanged(t,e){return!t.equals(e)}minPost(){return pe.MIN}maxPost(){return pe.MAX}makePost(t,e){const i=W(t);return new pe(e,i)}toString(){return".value"}},Ze="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",bt=function(){let n=0;const t=[];return function(e){const i=e===n;let o;n=e;const u=new Array(8);for(o=7;o>=0;o--)u[o]=Ze.charAt(e%64),e=Math.floor(e/64);(0,m.hu)(0===e,"Cannot push at time == 0");let c=u.join("");if(i){for(o=11;o>=0&&63===t[o];o--)t[o]=0;t[o]++}else for(o=0;o<12;o++)t[o]=Math.floor(64*Math.random());for(o=0;o<12;o++)c+=Ze.charAt(t[o]);return(0,m.hu)(20===c.length,"nextPushId: Length should be 20."),c}}();function Cr(n){return{type:"value",snapshotNode:n}}function br(n,t){return{type:"child_added",snapshotNode:t,childName:n}}function Nn(n,t){return{type:"child_removed",snapshotNode:t,childName:n}}function ui(n,t,e){return{type:"child_changed",snapshotNode:t,childName:n,oldSnap:e}}class Hs{constructor(t){this.index_=t}updateChild(t,e,i,o,u,c){(0,m.hu)(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");const h=t.getImmediateChild(e);return h.getChild(o).equals(i.getChild(o))&&h.isEmpty()===i.isEmpty()||(null!=c&&(i.isEmpty()?t.hasChild(e)?c.trackChildChange(Nn(e,h)):(0,m.hu)(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):h.isEmpty()?c.trackChildChange(br(e,i)):c.trackChildChange(ui(e,i,h))),t.isLeafNode()&&i.isEmpty())?t:t.updateImmediateChild(e,i).withIndex(this.index_)}updateFullNode(t,e,i){return null!=i&&(t.isLeafNode()||t.forEachChild(Me,(o,u)=>{e.hasChild(o)||i.trackChildChange(Nn(o,u))}),e.isLeafNode()||e.forEachChild(Me,(o,u)=>{if(t.hasChild(o)){const c=t.getImmediateChild(o);c.equals(u)||i.trackChildChange(ui(o,u,c))}else i.trackChildChange(br(o,u))})),e.withIndex(this.index_)}updatePriority(t,e){return t.isEmpty()?_.EMPTY_NODE:t.updatePriority(e)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class kn{constructor(t){this.indexedFilter_=new Hs(t.getIndex()),this.index_=t.getIndex(),this.startPost_=kn.getStartPost_(t),this.endPost_=kn.getEndPost_(t)}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0}updateChild(t,e,i,o,u,c){return this.matches(new pe(e,i))||(i=_.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,i,o,u,c)}updateFullNode(t,e,i){e.isLeafNode()&&(e=_.EMPTY_NODE);let o=e.withIndex(this.index_);o=o.updatePriority(_.EMPTY_NODE);const u=this;return e.forEachChild(Me,(c,h)=>{u.matches(new pe(c,h))||(o=o.updateImmediateChild(c,_.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,o,i)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(t){if(t.hasStart()){const e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()}static getEndPost_(t){if(t.hasEnd()){const e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()}}class Oo{constructor(t){this.rangedFilter_=new kn(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}updateChild(t,e,i,o,u,c){return this.rangedFilter_.matches(new pe(e,i))||(i=_.EMPTY_NODE),t.getImmediateChild(e).equals(i)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,i,o,u,c):this.fullLimitUpdateChild_(t,e,i,u,c)}updateFullNode(t,e,i){let o;if(e.isLeafNode()||e.isEmpty())o=_.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){let u;o=_.EMPTY_NODE.withIndex(this.index_),u=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let c=0;for(;u.hasNext()&&c<this.limit_;){const h=u.getNext();let g;if(g=this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),h)<=0:this.index_.compare(h,this.rangedFilter_.getEndPost())<=0,!g)break;o=o.updateImmediateChild(h.name,h.node),c++}}else{let u,c,h,g;if(o=e.withIndex(this.index_),o=o.updatePriority(_.EMPTY_NODE),this.reverse_){g=o.getReverseIterator(this.index_),u=this.rangedFilter_.getEndPost(),c=this.rangedFilter_.getStartPost();const A=this.index_.getCompare();h=(O,Q)=>A(Q,O)}else g=o.getIterator(this.index_),u=this.rangedFilter_.getStartPost(),c=this.rangedFilter_.getEndPost(),h=this.index_.getCompare();let y=0,R=!1;for(;g.hasNext();){const A=g.getNext();!R&&h(u,A)<=0&&(R=!0),R&&y<this.limit_&&h(A,c)<=0?y++:o=o.updateImmediateChild(A.name,_.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,o,i)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(t,e,i,o,u){let c;if(this.reverse_){const A=this.index_.getCompare();c=(O,Q)=>A(Q,O)}else c=this.index_.getCompare();const h=t;(0,m.hu)(h.numChildren()===this.limit_,"");const g=new pe(e,i),y=this.reverse_?h.getFirstChild(this.index_):h.getLastChild(this.index_),R=this.rangedFilter_.matches(g);if(h.hasChild(e)){const A=h.getImmediateChild(e);let O=o.getChildAfterChild(this.index_,y,this.reverse_);for(;null!=O&&(O.name===e||h.hasChild(O.name));)O=o.getChildAfterChild(this.index_,O,this.reverse_);const Q=null==O?1:c(O,g);if(R&&!i.isEmpty()&&Q>=0)return null!=u&&u.trackChildChange(ui(e,i,A)),h.updateImmediateChild(e,i);{null!=u&&u.trackChildChange(Nn(e,A));const Ge=h.updateImmediateChild(e,_.EMPTY_NODE);return null!=O&&this.rangedFilter_.matches(O)?(null!=u&&u.trackChildChange(br(O.name,O.node)),Ge.updateImmediateChild(O.name,O.node)):Ge}}return i.isEmpty()?t:R&&c(y,g)>=0?(null!=u&&(u.trackChildChange(Nn(y.name,y.node)),u.trackChildChange(br(e,i))),h.updateImmediateChild(e,i).updateImmediateChild(y.name,_.EMPTY_NODE)):t}}class Ar{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Me}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return(0,m.hu)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(0,m.hu)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:M}hasEnd(){return this.endSet_}getIndexEndValue(){return(0,m.hu)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(0,m.hu)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:q}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return(0,m.hu)(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Me}copy(){const t=new Ar;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}}function Mo(n){const t={};if(n.isDefault())return t;let e;return n.index_===Me?e="$priority":n.index_===Le?e="$value":n.index_===Lt?e="$key":((0,m.hu)(n.index_ instanceof re,"Unrecognized index type!"),e=n.index_.toString()),t.orderBy=(0,m.Pz)(e),n.startSet_&&(t.startAt=(0,m.Pz)(n.indexStartValue_),n.startNameSet_&&(t.startAt+=","+(0,m.Pz)(n.indexStartName_))),n.endSet_&&(t.endAt=(0,m.Pz)(n.indexEndValue_),n.endNameSet_&&(t.endAt+=","+(0,m.Pz)(n.indexEndName_))),n.limitSet_&&(n.isViewFromLeft()?t.limitToFirst=n.limit_:t.limitToLast=n.limit_),t}function ci(n){const t={};if(n.startSet_&&(t.sp=n.indexStartValue_,n.startNameSet_&&(t.sn=n.indexStartName_)),n.endSet_&&(t.ep=n.indexEndValue_,n.endNameSet_&&(t.en=n.indexEndName_)),n.limitSet_){t.l=n.limit_;let e=n.viewFrom_;""===e&&(e=n.isViewFromLeft()?"l":"r"),t.vf=e}return n.index_!==Me&&(t.i=n.index_.toString()),t}class di extends _r{constructor(t,e,i,o){super(),this.repoInfo_=t,this.onDataUpdate_=e,this.authTokenProvider_=i,this.appCheckTokenProvider_=o,this.log_=x("p:rest:"),this.listens_={}}reportStats(t){throw new Error("Method not implemented.")}static getListenId_(t,e){return void 0!==e?"tag$"+e:((0,m.hu)(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())}listen(t,e,i,o){const u=t._path.toString();this.log_("Listen called for "+u+" "+t._queryIdentifier);const c=di.getListenId_(t,i),h={};this.listens_[c]=h;const g=Mo(t._queryParams);this.restRequest_(u+".json",g,(y,R)=>{let A=R;if(404===y&&(A=null,y=null),null===y&&this.onDataUpdate_(u,A,!1,i),(0,m.DV)(this.listens_,c)===h){let O;O=y?401===y?"permission_denied":"rest_error:"+y:"ok",o(O,null)}})}unlisten(t,e){const i=di.getListenId_(t,e);delete this.listens_[i]}get(t){const e=Mo(t._queryParams),i=t._path.toString(),o=new m.BH;return this.restRequest_(i+".json",e,(u,c)=>{let h=c;404===u&&(h=null,u=null),null===u?(this.onDataUpdate_(i,h,!1,null),o.resolve(h)):o.reject(new Error(h))}),o.promise}refreshAuthToken(t){}restRequest_(t,e={},i){return e.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([o,u])=>{o&&o.accessToken&&(e.auth=o.accessToken),u&&u.token&&(e.ac=u.token);const c=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+t+"?ns="+this.repoInfo_.namespace+(0,m.xO)(e);this.log_("Sending REST request for "+c);const h=new XMLHttpRequest;h.onreadystatechange=()=>{if(i&&4===h.readyState){this.log_("REST Response for "+c+" received. status:",h.status,"response:",h.responseText);let g=null;if(h.status>=200&&h.status<300){try{g=(0,m.cI)(h.responseText)}catch(y){Be("Failed to parse JSON response for "+c+": "+h.responseText)}i(null,g)}else 401!==h.status&&404!==h.status&&Be("Got unsuccessful REST response for "+c+" Status: "+h.status),i(h.status);i=null}},h.open("GET",c,!0),h.send()})}}class Xi{constructor(){this.rootNode_=_.EMPTY_NODE}getNode(t){return this.rootNode_.getChild(t)}updateSnapshot(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)}}function es(){return{value:null,children:new Map}}function vn(n,t,e){if(_e(t))n.value=e,n.children.clear();else if(null!==n.value)n.value=n.value.updateChild(t,e);else{const i=ge(t);n.children.has(i)||n.children.set(i,es()),vn(n.children.get(i),t=Oe(t),e)}}function Rr(n,t,e){null!==n.value?e(t,n.value):function(n,t){n.children.forEach((e,i)=>{t(i,e)})}(n,(i,o)=>{Rr(o,new Ne(t.toString()+"/"+i),e)})}class ts{constructor(t){this.collection_=t,this.last_=null}get(){const t=this.collection_.get(),e=Object.assign({},t);return this.last_&&ce(this.last_,(i,o)=>{e[i]=e[i]-o}),this.last_=t,e}}class rs{constructor(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new ts(t);const i=1e4+2e4*Math.random();Tt(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const t=this.statsListener_.get(),e={};let i=!1;ce(t,(o,u)=>{u>0&&(0,m.r3)(this.statsToReport_,o)&&(e[o]=u,i=!0)}),i&&this.server_.reportStats(e),Tt(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var Gt=(()=>(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(Gt||(Gt={})),Gt))();function Pr(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class fi{constructor(t,e,i){this.path=t,this.affectedTree=e,this.revert=i,this.type=Gt.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(t){if(_e(this.path)){if(null!=this.affectedTree.value)return(0,m.hu)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const e=this.affectedTree.subtree(new Ne(t));return new fi(be(),e,this.revert)}}return(0,m.hu)(ge(this.path)===t,"operationForChild called for unrelated child."),new fi(Oe(this.path),this.affectedTree,this.revert)}}class On{constructor(t,e){this.source=t,this.path=e,this.type=Gt.LISTEN_COMPLETE}operationForChild(t){return _e(this.path)?new On(this.source,be()):new On(this.source,Oe(this.path))}}class er{constructor(t,e,i){this.source=t,this.path=e,this.snap=i,this.type=Gt.OVERWRITE}operationForChild(t){return _e(this.path)?new er(this.source,be(),this.snap.getImmediateChild(t)):new er(this.source,Oe(this.path),this.snap)}}class tr{constructor(t,e,i){this.source=t,this.path=e,this.children=i,this.type=Gt.MERGE}operationForChild(t){if(_e(this.path)){const e=this.children.subtree(new Ne(t));return e.isEmpty()?null:e.value?new er(this.source,be(),e.value):new tr(this.source,be(),e)}return(0,m.hu)(ge(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new tr(this.source,Oe(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class In{constructor(t,e,i){this.node_=t,this.fullyInitialized_=e,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(t){if(_e(t))return this.isFullyInitialized()&&!this.filtered_;const e=ge(t);return this.isCompleteForChild(e)}isCompleteForChild(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)}getNode(){return this.node_}}class Lo{constructor(t){this.query_=t,this.index_=this.query_._queryParams.getIndex()}}function pi(n,t,e,i,o,u){const c=i.filter(h=>h.type===e);c.sort((h,g)=>function(n,t,e){if(null==t.childName||null==e.childName)throw(0,m.g5)("Should only compare child_ events.");const i=new pe(t.childName,t.snapshotNode),o=new pe(e.childName,e.snapshotNode);return n.index_.compare(i,o)}(n,h,g)),c.forEach(h=>{const g=function(n,t,e){return"value"===t.type||"child_removed"===t.type||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,n.index_)),t}(n,h,u);o.forEach(y=>{y.respondsTo(h.type)&&t.push(y.createEvent(g,n.query_))})})}function is(n,t){return{eventCache:n,serverCache:t}}function _i(n,t,e,i){return is(new In(t,e,i),n.serverCache)}function Uo(n,t,e,i){return is(n.eventCache,new In(t,e,i))}function mi(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function nr(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let Nr;class Fe{constructor(t,e=(()=>(Nr||(Nr=new ct(fe)),Nr))()){this.value=t,this.children=e}static fromObject(t){let e=new Fe(null);return ce(t,(i,o)=>{e=e.set(new Ne(i),o)}),e}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(t,e){if(null!=this.value&&e(this.value))return{path:be(),value:this.value};if(_e(t))return null;{const i=ge(t),o=this.children.get(i);if(null!==o){const u=o.findRootMostMatchingPathAndValue(Oe(t),e);return null!=u?{path:We(new Ne(i),u.path),value:u.value}:null}return null}}findRootMostValueAndPath(t){return this.findRootMostMatchingPathAndValue(t,()=>!0)}subtree(t){if(_e(t))return this;{const e=ge(t),i=this.children.get(e);return null!==i?i.subtree(Oe(t)):new Fe(null)}}set(t,e){if(_e(t))return new Fe(e,this.children);{const i=ge(t),u=(this.children.get(i)||new Fe(null)).set(Oe(t),e),c=this.children.insert(i,u);return new Fe(this.value,c)}}remove(t){if(_e(t))return this.children.isEmpty()?new Fe(null):new Fe(null,this.children);{const e=ge(t),i=this.children.get(e);if(i){const o=i.remove(Oe(t));let u;return u=o.isEmpty()?this.children.remove(e):this.children.insert(e,o),null===this.value&&u.isEmpty()?new Fe(null):new Fe(this.value,u)}return this}}get(t){if(_e(t))return this.value;{const e=ge(t),i=this.children.get(e);return i?i.get(Oe(t)):null}}setTree(t,e){if(_e(t))return e;{const i=ge(t),u=(this.children.get(i)||new Fe(null)).setTree(Oe(t),e);let c;return c=u.isEmpty()?this.children.remove(i):this.children.insert(i,u),new Fe(this.value,c)}}fold(t){return this.fold_(be(),t)}fold_(t,e){const i={};return this.children.inorderTraversal((o,u)=>{i[o]=u.fold_(We(t,o),e)}),e(t,this.value,i)}findOnPath(t,e){return this.findOnPath_(t,be(),e)}findOnPath_(t,e,i){const o=!!this.value&&i(e,this.value);if(o)return o;if(_e(t))return null;{const u=ge(t),c=this.children.get(u);return c?c.findOnPath_(Oe(t),We(e,u),i):null}}foreachOnPath(t,e){return this.foreachOnPath_(t,be(),e)}foreachOnPath_(t,e,i){if(_e(t))return this;{this.value&&i(e,this.value);const o=ge(t),u=this.children.get(o);return u?u.foreachOnPath_(Oe(t),We(e,o),i):new Fe(null)}}foreach(t){this.foreach_(be(),t)}foreach_(t,e){this.children.inorderTraversal((i,o)=>{o.foreach_(We(t,i),e)}),this.value&&e(t,this.value)}foreachChild(t){this.children.inorderTraversal((e,i)=>{i.value&&t(e,i.value)})}}class $t{constructor(t){this.writeTree_=t}static empty(){return new $t(new Fe(null))}}function kr(n,t,e){if(_e(t))return new $t(new Fe(e));{const i=n.writeTree_.findRootMostValueAndPath(t);if(null!=i){const o=i.path;let u=i.value;const c=ut(o,t);return u=u.updateChild(c,e),new $t(n.writeTree_.set(o,u))}{const o=new Fe(e),u=n.writeTree_.setTree(t,o);return new $t(u)}}}function ss(n,t,e){let i=n;return ce(e,(o,u)=>{i=kr(i,We(t,o),u)}),i}function Ks(n,t){if(_e(t))return $t.empty();{const e=n.writeTree_.setTree(t,new Fe(null));return new $t(e)}}function Or(n,t){return null!=ln(n,t)}function ln(n,t){const e=n.writeTree_.findRootMostValueAndPath(t);return null!=e?n.writeTree_.get(e.path).getChild(ut(e.path,t)):null}function Wo(n){const t=[],e=n.writeTree_.value;return null!=e?e.isLeafNode()||e.forEachChild(Me,(i,o)=>{t.push(new pe(i,o))}):n.writeTree_.children.inorderTraversal((i,o)=>{null!=o.value&&t.push(new pe(i,o.value))}),t}function Vt(n,t){if(_e(t))return n;{const e=ln(n,t);return new $t(null!=e?new Fe(e):n.writeTree_.subtree(t))}}function gi(n){return n.writeTree_.isEmpty()}function rr(n,t){return Ys(be(),n.writeTree_,t)}function Ys(n,t,e){if(null!=t.value)return e.updateChild(n,t.value);{let i=null;return t.children.inorderTraversal((o,u)=>{".priority"===o?((0,m.hu)(null!==u.value,"Priority writes must always be leaf nodes"),i=u.value):e=Ys(We(n,o),u,e)}),!e.getChild(n).isEmpty()&&null!==i&&(e=e.updateChild(We(n,".priority"),i)),e}}function yi(n,t){return vi(t,n)}function Vo(n,t){if(n.snap)return Ye(n.path,t);for(const e in n.children)if(n.children.hasOwnProperty(e)&&Ye(We(n.path,e),t))return!0;return!1}function os(n){return n.visible}function Qs(n,t,e){let i=$t.empty();for(let o=0;o<n.length;++o){const u=n[o];if(t(u)){const c=u.path;let h;if(u.snap)Ye(e,c)?(h=ut(e,c),i=kr(i,h,u.snap)):Ye(c,e)&&(h=ut(c,e),i=kr(i,be(),u.snap.getChild(h)));else{if(!u.children)throw(0,m.g5)("WriteRecord should have .snap or .children");if(Ye(e,c))h=ut(e,c),i=ss(i,h,u.children);else if(Ye(c,e))if(h=ut(c,e),_e(h))i=ss(i,be(),u.children);else{const g=(0,m.DV)(u.children,ge(h));if(g){const y=g.getChild(Oe(h));i=kr(i,be(),y)}}}}}return i}function nt(n,t,e,i,o){if(i||o){const u=Vt(n.visibleWrites,t);return!o&&gi(u)?e:o||null!=e||Or(u,be())?rr(Qs(n.allWrites,function(y){return(y.visible||o)&&(!i||!~i.indexOf(y.writeId))&&(Ye(y.path,t)||Ye(t,y.path))},t),e||_.EMPTY_NODE):null}{const u=ln(n.visibleWrites,t);if(null!=u)return u;{const c=Vt(n.visibleWrites,t);return gi(c)?e:null!=e||Or(c,be())?rr(c,e||_.EMPTY_NODE):null}}}function xr(n,t,e,i){return nt(n.writeTree,n.treePath,t,e,i)}function us(n,t){return function(n,t,e){let i=_.EMPTY_NODE;const o=ln(n.visibleWrites,t);if(o)return o.isLeafNode()||o.forEachChild(Me,(u,c)=>{i=i.updateImmediateChild(u,c)}),i;if(e){const u=Vt(n.visibleWrites,t);return e.forEachChild(Me,(c,h)=>{const g=rr(Vt(u,new Ne(c)),h);i=i.updateImmediateChild(c,g)}),Wo(u).forEach(c=>{i=i.updateImmediateChild(c.name,c.node)}),i}return Wo(Vt(n.visibleWrites,t)).forEach(c=>{i=i.updateImmediateChild(c.name,c.node)}),i}(n.writeTree,n.treePath,t)}function Dr(n,t,e,i){return function(n,t,e,i,o){(0,m.hu)(i||o,"Either existingEventSnap or existingServerSnap must exist");const u=We(t,e);if(Or(n.visibleWrites,u))return null;{const c=Vt(n.visibleWrites,u);return gi(c)?o.getChild(e):rr(c,o.getChild(e))}}(n.writeTree,n.treePath,t,e,i)}function Mr(n,t){return function(n,t){return ln(n.visibleWrites,t)}(n.writeTree,We(n.treePath,t))}function ir(n,t,e){return function(n,t,e,i){const o=We(t,e),u=ln(n.visibleWrites,o);return null!=u?u:i.isCompleteForChild(e)?rr(Vt(n.visibleWrites,o),i.getNode().getImmediateChild(e)):null}(n.writeTree,n.treePath,t,e)}function Js(n,t){return vi(We(n.treePath,t),n.writeTree)}function vi(n,t){return{treePath:n,writeTree:t}}class Xs{constructor(){this.changeMap=new Map}trackChildChange(t){const e=t.type,i=t.childName;(0,m.hu)("child_added"===e||"child_changed"===e||"child_removed"===e,"Only child changes supported for tracking"),(0,m.hu)(".priority"!==i,"Only non-priority child changes can be tracked.");const o=this.changeMap.get(i);if(o){const u=o.type;if("child_added"===e&&"child_removed"===u)this.changeMap.set(i,ui(i,t.snapshotNode,o.snapshotNode));else if("child_removed"===e&&"child_added"===u)this.changeMap.delete(i);else if("child_removed"===e&&"child_changed"===u)this.changeMap.set(i,Nn(i,o.oldSnap));else if("child_changed"===e&&"child_added"===u)this.changeMap.set(i,br(i,t.snapshotNode));else{if("child_changed"!==e||"child_changed"!==u)throw(0,m.g5)("Illegal combination of changes: "+t+" occurred after "+o);this.changeMap.set(i,ui(i,t.snapshotNode,o.oldSnap))}}else this.changeMap.set(i,t)}getChanges(){return Array.from(this.changeMap.values())}}const eo=new class{getCompleteChild(t){return null}getChildAfterChild(t,e,i){return null}};class Fr{constructor(t,e,i=null){this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=i}getCompleteChild(t){const e=this.viewCache_.eventCache;if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);{const i=null!=this.optCompleteServerCache_?new In(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return ir(this.writes_,t,i)}}getChildAfterChild(t,e,i){const o=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:nr(this.viewCache_),u=function(n,t,e,i,o,u){return function(n,t,e,i,o,u,c){let h;const g=Vt(n.visibleWrites,t),y=ln(g,be());if(null!=y)h=y;else{if(null==e)return[];h=rr(g,e)}if(h=h.withIndex(c),h.isEmpty()||h.isLeafNode())return[];{const R=[],A=c.getCompare(),O=u?h.getReverseIteratorFrom(i,c):h.getIteratorFrom(i,c);let Q=O.getNext();for(;Q&&R.length<o;)0!==A(Q,i)&&R.push(Q),Q=O.getNext();return R}}(n.writeTree,n.treePath,t,e,i,o,u)}(this.writes_,o,e,1,i,t);return 0===u.length?null:u[0]}}function no(n,t,e,i,o,u){const c=t.eventCache;if(null!=Mr(i,e))return t;{let h,g;if(_e(e))if((0,m.hu)(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const y=nr(t),A=us(i,y instanceof _?y:_.EMPTY_NODE);h=n.filter.updateFullNode(t.eventCache.getNode(),A,u)}else{const y=xr(i,nr(t));h=n.filter.updateFullNode(t.eventCache.getNode(),y,u)}else{const y=ge(e);if(".priority"===y){(0,m.hu)(1===zt(e),"Can't have a priority with additional path components");const R=c.getNode();g=t.serverCache.getNode();const A=Dr(i,e,R,g);h=null!=A?n.filter.updatePriority(R,A):c.getNode()}else{const R=Oe(e);let A;if(c.isCompleteForChild(y)){g=t.serverCache.getNode();const O=Dr(i,e,c.getNode(),g);A=null!=O?c.getNode().getImmediateChild(y).updateChild(R,O):c.getNode().getImmediateChild(y)}else A=ir(i,y,t.serverCache);h=null!=A?n.filter.updateChild(c.getNode(),y,A,R,o,u):c.getNode()}}return _i(t,h,c.isFullyInitialized()||_e(e),n.filter.filtersNodes())}}function Ii(n,t,e,i,o,u,c,h){const g=t.serverCache;let y;const R=c?n.filter:n.filter.getIndexedFilter();if(_e(e))y=R.updateFullNode(g.getNode(),i,null);else if(R.filtersNodes()&&!g.isFiltered()){const Q=g.getNode().updateChild(e,i);y=R.updateFullNode(g.getNode(),Q,null)}else{const Q=ge(e);if(!g.isCompleteForPath(e)&&zt(e)>1)return t;const ae=Oe(e),mt=g.getNode().getImmediateChild(Q).updateChild(ae,i);y=".priority"===Q?R.updatePriority(g.getNode(),mt):R.updateChild(g.getNode(),Q,mt,ae,eo,null)}const A=Uo(t,y,g.isFullyInitialized()||_e(e),R.filtersNodes());return no(n,A,e,o,new Fr(o,A,u),h)}function ds(n,t,e,i,o,u,c){const h=t.eventCache;let g,y;const R=new Fr(o,t,u);if(_e(e))y=n.filter.updateFullNode(t.eventCache.getNode(),i,c),g=_i(t,y,!0,n.filter.filtersNodes());else{const A=ge(e);if(".priority"===A)y=n.filter.updatePriority(t.eventCache.getNode(),i),g=_i(t,y,h.isFullyInitialized(),h.isFiltered());else{const O=Oe(e),Q=h.getNode().getImmediateChild(A);let ae;if(_e(O))ae=i;else{const Ge=R.getCompleteChild(A);ae=null!=Ge?".priority"===mr(O)&&Ge.getChild(Yn(O)).isEmpty()?Ge:Ge.updateChild(O,i):_.EMPTY_NODE}g=Q.equals(ae)?t:_i(t,n.filter.updateChild(h.getNode(),A,ae,O,R,c),h.isFullyInitialized(),n.filter.filtersNodes())}}return g}function ro(n,t){return n.eventCache.isCompleteForChild(t)}function io(n,t,e){return e.foreach((i,o)=>{t=t.updateChild(i,o)}),t}function Ei(n,t,e,i,o,u,c,h){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let y,g=t;y=_e(e)?i:new Fe(null).setTree(e,i);const R=t.serverCache.getNode();return y.children.inorderTraversal((A,O)=>{if(R.hasChild(A)){const ae=io(0,t.serverCache.getNode().getImmediateChild(A),O);g=Ii(n,g,new Ne(A),ae,o,u,c,h)}}),y.children.inorderTraversal((A,O)=>{const Q=!t.serverCache.isCompleteForChild(A)&&void 0===O.value;if(!R.hasChild(A)&&!Q){const Ge=io(0,t.serverCache.getNode().getImmediateChild(A),O);g=Ii(n,g,new Ne(A),Ge,o,u,c,h)}}),g}class Ti{constructor(t,e){this.query_=t,this.eventRegistrations_=[];const i=this.query_._queryParams,o=new Hs(i.getIndex()),u=function(n){return n.loadsAllData()?new Hs(n.getIndex()):n.hasLimit()?new Oo(n):new kn(n)}(i);this.processor_=function(n){return{filter:n}}(u);const c=e.serverCache,h=e.eventCache,g=o.updateFullNode(_.EMPTY_NODE,c.getNode(),null),y=u.updateFullNode(_.EMPTY_NODE,h.getNode(),null),R=new In(g,c.isFullyInitialized(),o.filtersNodes()),A=new In(y,h.isFullyInitialized(),u.filtersNodes());this.viewCache_=is(A,R),this.eventGenerator_=new Lo(this.query_)}get query(){return this.query_}}function Xo(n,t){const e=nr(n.viewCache_);return e&&(n.query._queryParams.loadsAllData()||!_e(t)&&!e.getImmediateChild(ge(t)).isEmpty())?e.getChild(t):null}function wi(n){return 0===n.eventRegistrations_.length}function oo(n,t,e){const i=[];if(e){(0,m.hu)(null==t,"A cancel should cancel all event registrations.");const o=n.query._path;n.eventRegistrations_.forEach(u=>{const c=u.createCancelEvent(e,o);c&&i.push(c)})}if(t){let o=[];for(let u=0;u<n.eventRegistrations_.length;++u){const c=n.eventRegistrations_[u];if(c.matches(t)){if(t.hasAnyCallback()){o=o.concat(n.eventRegistrations_.slice(u+1));break}}else o.push(c)}n.eventRegistrations_=o}else n.eventRegistrations_=[];return i}function ao(n,t,e,i){t.type===Gt.MERGE&&null!==t.source.queryId&&((0,m.hu)(nr(n.viewCache_),"We should always have a full cache before handling merges"),(0,m.hu)(mi(n.viewCache_),"Missing event cache, even though we have a server cache"));const o=n.viewCache_,u=function(n,t,e,i,o){const u=new Xs;let c,h;if(e.type===Gt.OVERWRITE){const y=e;y.source.fromUser?c=ds(n,t,y.path,y.snap,i,o,u):((0,m.hu)(y.source.fromServer,"Unknown source."),h=y.source.tagged||t.serverCache.isFiltered()&&!_e(y.path),c=Ii(n,t,y.path,y.snap,i,o,h,u))}else if(e.type===Gt.MERGE){const y=e;y.source.fromUser?c=function(n,t,e,i,o,u,c){let h=t;return i.foreach((g,y)=>{const R=We(e,g);ro(t,ge(R))&&(h=ds(n,h,R,y,o,u,c))}),i.foreach((g,y)=>{const R=We(e,g);ro(t,ge(R))||(h=ds(n,h,R,y,o,u,c))}),h}(n,t,y.path,y.children,i,o,u):((0,m.hu)(y.source.fromServer,"Unknown source."),h=y.source.tagged||t.serverCache.isFiltered(),c=Ei(n,t,y.path,y.children,i,o,h,u))}else if(e.type===Gt.ACK_USER_WRITE){const y=e;c=y.revert?function(n,t,e,i,o,u){let c;if(null!=Mr(i,e))return t;{const h=new Fr(i,t,o),g=t.eventCache.getNode();let y;if(_e(e)||".priority"===ge(e)){let R;if(t.serverCache.isFullyInitialized())R=xr(i,nr(t));else{const A=t.serverCache.getNode();(0,m.hu)(A instanceof _,"serverChildren would be complete if leaf node"),R=us(i,A)}R=R,y=n.filter.updateFullNode(g,R,u)}else{const R=ge(e);let A=ir(i,R,t.serverCache);null==A&&t.serverCache.isCompleteForChild(R)&&(A=g.getImmediateChild(R)),y=null!=A?n.filter.updateChild(g,R,A,Oe(e),h,u):t.eventCache.getNode().hasChild(R)?n.filter.updateChild(g,R,_.EMPTY_NODE,Oe(e),h,u):g,y.isEmpty()&&t.serverCache.isFullyInitialized()&&(c=xr(i,nr(t)),c.isLeafNode()&&(y=n.filter.updateFullNode(y,c,u)))}return c=t.serverCache.isFullyInitialized()||null!=Mr(i,be()),_i(t,y,c,n.filter.filtersNodes())}}(n,t,y.path,i,o,u):function(n,t,e,i,o,u,c){if(null!=Mr(o,e))return t;const h=t.serverCache.isFiltered(),g=t.serverCache;if(null!=i.value){if(_e(e)&&g.isFullyInitialized()||g.isCompleteForPath(e))return Ii(n,t,e,g.getNode().getChild(e),o,u,h,c);if(_e(e)){let y=new Fe(null);return g.getNode().forEachChild(Lt,(R,A)=>{y=y.set(new Ne(R),A)}),Ei(n,t,e,y,o,u,h,c)}return t}{let y=new Fe(null);return i.foreach((R,A)=>{const O=We(e,R);g.isCompleteForPath(O)&&(y=y.set(R,g.getNode().getChild(O)))}),Ei(n,t,e,y,o,u,h,c)}}(n,t,y.path,y.affectedTree,i,o,u)}else{if(e.type!==Gt.LISTEN_COMPLETE)throw(0,m.g5)("Unknown operation type: "+e.type);c=function(n,t,e,i,o){const u=t.serverCache;return no(n,Uo(t,u.getNode(),u.isFullyInitialized()||_e(e),u.isFiltered()),e,i,eo,o)}(n,t,e.path,i,u)}const g=u.getChanges();return function(n,t,e){const i=t.eventCache;if(i.isFullyInitialized()){const o=i.getNode().isLeafNode()||i.getNode().isEmpty(),u=mi(n);(e.length>0||!n.eventCache.isFullyInitialized()||o&&!i.getNode().equals(u)||!i.getNode().getPriority().equals(u.getPriority()))&&e.push(Cr(mi(t)))}}(t,c,g),{viewCache:c,changes:g}}(n.processor_,o,t,e,i);return function(n,t){(0,m.hu)(t.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),(0,m.hu)(t.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}(n.processor_,u.viewCache),(0,m.hu)(u.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=u.viewCache,lo(n,u.changes,u.viewCache.eventCache.getNode(),null)}function lo(n,t,e,i){return function(n,t,e,i){const o=[],u=[];return t.forEach(c=>{"child_changed"===c.type&&n.index_.indexedValueChanged(c.oldSnap,c.snapshotNode)&&u.push(function(n,t){return{type:"child_moved",snapshotNode:t,childName:n}}(c.childName,c.snapshotNode))}),pi(n,o,"child_removed",t,i,e),pi(n,o,"child_added",t,i,e),pi(n,o,"child_moved",u,i,e),pi(n,o,"child_changed",t,i,e),pi(n,o,"value",t,i,e),o}(n.eventGenerator_,t,e,i?[i]:n.eventRegistrations_)}let Ur,_s;class uo{constructor(){this.views=new Map}}function co(n,t,e,i){const o=t.source.queryId;if(null!==o){const u=n.views.get(o);return(0,m.hu)(null!=u,"SyncTree gave us an op for an invalid query."),ao(u,t,e,i)}{let u=[];for(const c of n.views.values())u=u.concat(ao(c,t,e,i));return u}}function Ci(n,t,e,i,o){const c=n.views.get(t._queryIdentifier);if(!c){let h=xr(e,o?i:null),g=!1;h?g=!0:i instanceof _?(h=us(e,i),g=!1):(h=_.EMPTY_NODE,g=!1);const y=is(new In(h,g,!1),new In(i,o,!1));return new Ti(t,y)}return c}function ra(n){const t=[];for(const e of n.views.values())e.query._queryParams.loadsAllData()||t.push(e);return t}function qt(n,t){let e=null;for(const i of n.views.values())e=e||Xo(i,t);return e}function bi(n,t){return t._queryParams.loadsAllData()?sr(n):n.views.get(t._queryIdentifier)}function Ai(n,t){return null!=bi(n,t)}function Dn(n){return null!=sr(n)}function sr(n){for(const t of n.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let ia=1;class ho{constructor(t){this.listenProvider_=t,this.syncPointTree_=new Fe(null),this.pendingWriteTree_={visibleWrites:$t.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function gs(n,t,e,i,o){return function(n,t,e,i,o){(0,m.hu)(i>n.lastWriteId,"Stacking an older write on top of newer ones"),void 0===o&&(o=!0),n.allWrites.push({path:t,snap:e,writeId:i,visible:o}),o&&(n.visibleWrites=kr(n.visibleWrites,t,e)),n.lastWriteId=i}(n.pendingWriteTree_,t,e,i,o),o?or(n,new er({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,e)):[]}function En(n,t,e=!1){const i=function(n,t){for(let e=0;e<n.allWrites.length;e++){const i=n.allWrites[e];if(i.writeId===t)return i}return null}(n.pendingWriteTree_,t);if(function(n,t){const e=n.allWrites.findIndex(h=>h.writeId===t);(0,m.hu)(e>=0,"removeWrite called with nonexistent writeId.");const i=n.allWrites[e];n.allWrites.splice(e,1);let o=i.visible,u=!1,c=n.allWrites.length-1;for(;o&&c>=0;){const h=n.allWrites[c];h.visible&&(c>=e&&Vo(h,i.path)?o=!1:Ye(i.path,h.path)&&(u=!0)),c--}return!!o&&(u?(function(n){n.visibleWrites=Qs(n.allWrites,os,be()),n.lastWriteId=n.allWrites.length>0?n.allWrites[n.allWrites.length-1].writeId:-1}(n),!0):(i.snap?n.visibleWrites=Ks(n.visibleWrites,i.path):ce(i.children,g=>{n.visibleWrites=Ks(n.visibleWrites,We(i.path,g))}),!0))}(n.pendingWriteTree_,t)){let u=new Fe(null);return null!=i.snap?u=u.set(be(),!0):ce(i.children,c=>{u=u.set(new Ne(c),!0)}),or(n,new fi(i.path,u,e))}return[]}function Si(n,t,e){return or(n,new er({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,e))}function Wr(n,t,e,i){const o=t._path,u=n.syncPointTree_.get(o);let c=[];if(u&&("default"===t._queryIdentifier||Ai(u,t))){const h=function(n,t,e,i){const o=t._queryIdentifier,u=[];let c=[];const h=Dn(n);if("default"===o)for(const[g,y]of n.views.entries())c=c.concat(oo(y,e,i)),wi(y)&&(n.views.delete(g),y.query._queryParams.loadsAllData()||u.push(y.query));else{const g=n.views.get(o);g&&(c=c.concat(oo(g,e,i)),wi(g)&&(n.views.delete(o),g.query._queryParams.loadsAllData()||u.push(g.query)))}return h&&!Dn(n)&&u.push(new((0,m.hu)(Ur,"Reference.ts has not been loaded"),Ur)(t._repo,t._path)),{removed:u,events:c}}(u,t,e,i);(function(n){return 0===n.views.size})(u)&&(n.syncPointTree_=n.syncPointTree_.remove(o));const g=h.removed;c=h.events;const y=-1!==g.findIndex(A=>A._queryParams.loadsAllData()),R=n.syncPointTree_.findOnPath(o,(A,O)=>Dn(O));if(y&&!R){const A=n.syncPointTree_.subtree(o);if(!A.isEmpty()){const O=function(n){return n.fold((t,e,i)=>{if(e&&Dn(e))return[sr(e)];{let o=[];return e&&(o=ra(e)),ce(i,(u,c)=>{o=o.concat(c)}),o}})}(A);for(let Q=0;Q<O.length;++Q){const ae=O[Q],Ge=ae.query,mt=ki(n,ae);n.listenProvider_.startListening(Ln(Ge),ar(n,Ge),mt.hashFn,mt.onComplete)}}}if(!R&&g.length>0&&!i)if(y){const A=null;n.listenProvider_.stopListening(Ln(t),A)}else g.forEach(A=>{const O=n.queryToTagMap.get(Ts(A));n.listenProvider_.stopListening(Ln(A),O)});!function(n,t){for(let e=0;e<t.length;++e){const i=t[e];if(!i._queryParams.loadsAllData()){const o=Ts(i),u=n.queryToTagMap.get(o);n.queryToTagMap.delete(o),n.tagToQueryMap.delete(u)}}}(n,g)}return c}function Ri(n,t,e){const i=t._path;let o=null,u=!1;n.syncPointTree_.foreachOnPath(i,(A,O)=>{const Q=ut(A,i);o=o||qt(O,Q),u=u||Dn(O)});let h,c=n.syncPointTree_.get(i);c?(u=u||Dn(c),o=o||qt(c,be())):(c=new uo,n.syncPointTree_=n.syncPointTree_.set(i,c)),null!=o?h=!0:(h=!1,o=_.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((O,Q)=>{const ae=qt(Q,be());ae&&(o=o.updateImmediateChild(O,ae))}));const g=Ai(c,t);if(!g&&!t._queryParams.loadsAllData()){const A=Ts(t);(0,m.hu)(!n.queryToTagMap.has(A),"View does not exist, but we have a tag");const O=ia++;n.queryToTagMap.set(A,O),n.tagToQueryMap.set(O,A)}let R=function(n,t,e,i,o,u){const c=Ci(n,t,i,o,u);return n.views.has(t._queryIdentifier)||n.views.set(t._queryIdentifier,c),function(n,t){n.eventRegistrations_.push(t)}(c,e),function(n,t){const e=n.viewCache_.eventCache,i=[];return e.getNode().isLeafNode()||e.getNode().forEachChild(Me,(u,c)=>{i.push(br(u,c))}),e.isFullyInitialized()&&i.push(Cr(e.getNode())),lo(n,i,e.getNode(),t)}(c,e)}(c,t,e,yi(n.pendingWriteTree_,i),o,h);if(!g&&!u){const A=bi(c,t);R=R.concat(function(n,t,e){const i=t._path,o=ar(n,t),u=ki(n,e),c=n.listenProvider_.startListening(Ln(t),o,u.hashFn,u.onComplete),h=n.syncPointTree_.subtree(i);if(o)(0,m.hu)(!Dn(h.value),"If we're adding a query, it shouldn't be shadowed");else{const g=h.fold((y,R,A)=>{if(!_e(y)&&R&&Dn(R))return[sr(R).query];{let O=[];return R&&(O=O.concat(ra(R).map(Q=>Q.query))),ce(A,(Q,ae)=>{O=O.concat(ae)}),O}});for(let y=0;y<g.length;++y){const R=g[y];n.listenProvider_.stopListening(Ln(R),ar(n,R))}}return c}(n,t,A))}return R}function Pi(n,t,e){const o=n.pendingWriteTree_,u=n.syncPointTree_.findOnPath(t,(c,h)=>{const y=qt(h,ut(c,t));if(y)return y});return nt(o,t,u,e,!0)}function or(n,t){return fo(t,n.syncPointTree_,null,yi(n.pendingWriteTree_,be()))}function fo(n,t,e,i){if(_e(n.path))return Ni(n,t,e,i);{const o=t.get(be());null==e&&null!=o&&(e=qt(o,be()));let u=[];const c=ge(n.path),h=n.operationForChild(c),g=t.children.get(c);if(g&&h){const y=e?e.getImmediateChild(c):null,R=Js(i,c);u=u.concat(fo(h,g,y,R))}return o&&(u=u.concat(co(o,n,i,e))),u}}function Ni(n,t,e,i){const o=t.get(be());null==e&&null!=o&&(e=qt(o,be()));let u=[];return t.children.inorderTraversal((c,h)=>{const g=e?e.getImmediateChild(c):null,y=Js(i,c),R=n.operationForChild(c);R&&(u=u.concat(Ni(R,h,g,y)))}),o&&(u=u.concat(co(o,n,i,e))),u}function ki(n,t){const e=t.query,i=ar(n,e);return{hashFn:()=>(function(n){return n.viewCache_.serverCache.getNode()}(t)||_.EMPTY_NODE).hash(),onComplete:o=>{if("ok"===o)return i?function(n,t,e){const i=Gr(n,e);if(i){const o=Oi(i),u=o.path,c=o.queryId,h=ut(u,t);return po(n,u,new On(Pr(c),h))}return[]}(n,e._path,i):function(n,t){return or(n,new On({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(n,e._path);{const u=function(n,t){let e="Unknown Error";"too_big"===n?e="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===n?e="Client doesn't have permission to access the desired data.":"unavailable"===n&&(e="The service is unavailable");const i=new Error(n+" at "+t._path.toString()+": "+e);return i.code=n.toUpperCase(),i}(o,e);return Wr(n,e,null,u)}}}}function ar(n,t){const e=Ts(t);return n.queryToTagMap.get(e)}function Ts(n){return n._path.toString()+"$"+n._queryIdentifier}function Gr(n,t){return n.tagToQueryMap.get(t)}function Oi(n){const t=n.indexOf("$");return(0,m.hu)(-1!==t&&t<n.length-1,"Bad queryKey."),{queryId:n.substr(t+1),path:new Ne(n.substr(0,t))}}function po(n,t,e){const i=n.syncPointTree_.get(t);return(0,m.hu)(i,"Missing sync point for query tag that we're tracking"),co(i,e,yi(n.pendingWriteTree_,t),null)}function Ln(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new((0,m.hu)(_s,"Reference.ts has not been loaded"),_s)(n._repo,n._path):n}class _o{constructor(t){this.node_=t}getImmediateChild(t){const e=this.node_.getImmediateChild(t);return new _o(e)}node(){return this.node_}}class Cs{constructor(t,e){this.syncTree_=t,this.path_=e}getImmediateChild(t){const e=We(this.path_,t);return new Cs(this.syncTree_,e)}node(){return Pi(this.syncTree_,this.path_)}}const aa=function(n,t,e){return n&&"object"==typeof n?((0,m.hu)(".sv"in n,"Unexpected leaf node or priority contents"),"string"==typeof n[".sv"]?As(n[".sv"],t,e):"object"==typeof n[".sv"]?mo(n[".sv"],t):void(0,m.hu)(!1,"Unexpected server value: "+JSON.stringify(n,null,2))):n},As=function(n,t,e){switch(n){case"timestamp":return e.timestamp;default:(0,m.hu)(!1,"Unexpected server value: "+n)}},mo=function(n,t,e){n.hasOwnProperty("increment")||(0,m.hu)(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const i=n.increment;"number"!=typeof i&&(0,m.hu)(!1,"Unexpected increment value: "+i);const o=t.node();if((0,m.hu)(null!=o,"Expected ChildrenNode.EMPTY_NODE for nulls"),!o.isLeafNode())return i;const c=o.getValue();return"number"!=typeof c?i:c+i},Di=function(n,t,e){return Vr(n,new _o(t),e)};function Vr(n,t,e){const i=n.getPriority().val(),o=aa(i,t.getImmediateChild(".priority"),e);let u;if(n.isLeafNode()){const c=n,h=aa(c.getValue(),t,e);return h!==c.getValue()||o!==c.getPriority().val()?new Xe(h,W(o)):n}{const c=n;return u=c,o!==c.getPriority().val()&&(u=u.updatePriority(new Xe(o))),c.forEachChild(Me,(h,g)=>{const y=Vr(g,t.getImmediateChild(h),e);y!==g&&(u=u.updateImmediateChild(h,y))}),u}}class Ss{constructor(t="",e=null,i={children:{},childCount:0}){this.name=t,this.parent=e,this.node=i}}function Mi(n,t){let e=t instanceof Ne?t:new Ne(t),i=n,o=ge(e);for(;null!==o;){const u=(0,m.DV)(i.node.children,o)||{children:{},childCount:0};i=new Ss(o,i,u),e=Oe(e),o=ge(e)}return i}function Tn(n){return n.node.value}function Li(n,t){n.node.value=t,Hr(n)}function go(n){return n.node.childCount>0}function lr(n,t){ce(n.node.children,(e,i)=>{t(new Ss(e,n,i))})}function yo(n,t,e,i){e&&!i&&t(n),lr(n,o=>{yo(o,t,!0,i)}),e&&i&&t(n)}function Br(n){return new Ne(null===n.parent?n.name:Br(n.parent)+"/"+n.name)}function Hr(n){null!==n.parent&&function(n,t,e){const i=function(n){return void 0===Tn(n)&&!go(n)}(e),o=(0,m.r3)(n.node.children,t);i&&o?(delete n.node.children[t],n.node.childCount--,Hr(n)):!i&&!o&&(n.node.children[t]=e.node,n.node.childCount++,Hr(n))}(n.parent,n.name,n)}const da=/[\[\].#$\/\u0000-\u001F\u007F]/,vo=/[\[\].#$\u0000-\u001F\u007F]/,Rs=10485760,Fn=function(n){return"string"==typeof n&&0!==n.length&&!da.test(n)},Io=function(n){return"string"==typeof n&&0!==n.length&&!vo.test(n)},Kt=function(n,t,e,i){i&&void 0===t||zr((0,m.gK)(n,"value"),t,e)},zr=function(n,t,e){const i=e instanceof Ne?new An(e,n):e;if(void 0===t)throw new Error(n+"contains undefined "+xt(i));if("function"==typeof t)throw new Error(n+"contains a function "+xt(i)+" with contents = "+t.toString());if(D(t))throw new Error(n+"contains "+t.toString()+" "+xt(i));if("string"==typeof t&&t.length>Rs/3&&(0,m.ug)(t)>Rs)throw new Error(n+"contains a string greater than "+Rs+" utf8 bytes "+xt(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let o=!1,u=!1;if(ce(t,(c,h)=>{if(".value"===c)o=!0;else if(".priority"!==c&&".sv"!==c&&(u=!0,!Fn(c)))throw new Error(n+" contains an invalid key ("+c+") "+xt(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');(function(n,t){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(t),n.byteLength_+=(0,m.ug)(t),ii(n)})(i,c),zr(n,h,i),function(n){const t=n.parts_.pop();n.byteLength_-=(0,m.ug)(t),n.parts_.length>0&&(n.byteLength_-=1)}(i)}),o&&u)throw new Error(n+' contains ".value" child '+xt(i)+" in addition to actual children.")}},Ns=function(n,t,e,i){if(!(i&&void 0===e||Io(e)))throw new Error((0,m.gK)(n,t)+'was an invalid path = "'+e+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Yt=function(n,t){if(".info"===ge(t))throw new Error(n+" failed = Can't modify data under /.info/")};class _a{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function $r(n,t){let e=null;for(let i=0;i<t.length;i++){const o=t[i],u=o.getPath();null!==e&&!Ot(u,e.path)&&(n.eventLists_.push(e),e=null),null===e&&(e={events:[],path:u}),e.events.push(o)}e&&n.eventLists_.push(e)}function ks(n,t,e){$r(n,e),wo(n,i=>Ot(i,t))}function At(n,t,e){$r(n,e),wo(n,i=>Ye(i,t)||Ye(t,i))}function wo(n,t){n.recursionDepth_++;let e=!0;for(let i=0;i<n.eventLists_.length;i++){const o=n.eventLists_[i];o&&(t(o.path)?(ma(n.eventLists_[i]),n.eventLists_[i]=null):e=!1)}e&&(n.eventLists_=[]),n.recursionDepth_--}function ma(n){for(let t=0;t<n.events.length;t++){const e=n.events[t];if(null!==e){n.events[t]=null;const i=e.getEventRunner();ee&&he("event: "+e.toString()),ft(i)}}}class xs{constructor(t,e,i,o){this.repoInfo_=t,this.forceRestClient_=e,this.authTokenProvider_=i,this.appCheckProvider_=o,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new _a,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=es(),this.transactionQueueTree_=new Ss,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Co(n){const e=n.infoData_.getNode(new Ne(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+e}function Fi(n){return function(n){return(n=n||{}).timestamp=n.timestamp||(new Date).getTime(),n}({timestamp:Co(n)})}function Ui(n,t,e,i,o){n.dataUpdateCount++;const u=new Ne(t);e=n.interceptServerDataCallback_?n.interceptServerDataCallback_(t,e):e;let c=[];if(o)if(i){const g=(0,m.UI)(e,y=>W(y));c=function(n,t,e,i){const o=Gr(n,i);if(o){const u=Oi(o),c=u.path,h=u.queryId,g=ut(c,t),y=Fe.fromObject(e);return po(n,c,new tr(Pr(h),g,y))}return[]}(n.serverSyncTree_,u,g,o)}else{const g=W(e);c=function(n,t,e,i){const o=Gr(n,i);if(null!=o){const u=Oi(o),c=u.path,h=u.queryId,g=ut(c,t);return po(n,c,new er(Pr(h),g,e))}return[]}(n.serverSyncTree_,u,g,o)}else if(i){const g=(0,m.UI)(e,y=>W(y));c=function(n,t,e){const i=Fe.fromObject(e);return or(n,new tr({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,i))}(n.serverSyncTree_,u,g)}else{const g=W(e);c=Si(n.serverSyncTree_,u,g)}let h=u;c.length>0&&(h=Wn(n,u)),At(n.eventQueue_,h,c)}function va(n,t){Ds(n,"connected",t),!1===t&&function(n){oe(n,"onDisconnectEvents");const t=Fi(n),e=es();Rr(n.onDisconnect_,be(),(o,u)=>{const c=function(n,t,e,i){return Vr(t,new Cs(e,n),i)}(o,u,n.serverSyncTree_,t);vn(e,o,c)});let i=[];Rr(e,be(),(o,u)=>{i=i.concat(Si(n.serverSyncTree_,o,u));const c=Bi(n,o);Wn(n,c)}),n.onDisconnect_=es(),At(n.eventQueue_,be(),i)}(n)}function Ds(n,t,e){const i=new Ne("/.info/"+t),o=W(e);n.infoData_.updateSnapshot(i,o);const u=Si(n.infoSyncTree_,i,o);At(n.eventQueue_,i,u)}function Wi(n){return n.nextWriteId_++}function Ms(n,t,e,i,o){oe(n,"set",{path:t.toString(),value:e,priority:i});const u=Fi(n),c=W(e,i),h=Pi(n.serverSyncTree_,t),g=Di(c,h,u),y=Wi(n),R=gs(n.serverSyncTree_,t,g,y,!0);$r(n.eventQueue_,R),n.server_.put(t.toString(),c.val(!0),(O,Q)=>{const ae="ok"===O;ae||Be("set at "+t+" failed: "+O);const Ge=En(n.serverSyncTree_,y,!ae);At(n.eventQueue_,t,Ge),function(n,t,e,i){t&&ft(()=>{if("ok"===e)t(null);else{const o=(e||"error").toUpperCase();let u=o;i&&(u+=": "+i);const c=new Error(u);c.code=o,t(c)}})}(0,o,O,Q)});const A=Bi(n,t);Wn(n,A),At(n.eventQueue_,A,[])}function b(n,t,e){let i;i=".info"===ge(t._path)?Wr(n.infoSyncTree_,t,e):Wr(n.serverSyncTree_,t,e),ks(n.eventQueue_,t._path,i)}function oe(n,...t){let e="";n.persistentConnection_&&(e=n.persistentConnection_.id+":"),he(e,...t)}function St(n,t,e){return Pi(n.serverSyncTree_,t,e)||_.EMPTY_NODE}function Bt(n,t=n.transactionQueueTree_){if(t||qr(n,t),Tn(t)){const e=Us(n,t);(0,m.hu)(e.length>0,"Sending zero length transaction queue"),e.every(o=>0===o.status)&&function(n,t,e){const i=e.map(y=>y.currentWriteId),o=St(n,t,i);let u=o;const c=o.hash();for(let y=0;y<e.length;y++){const R=e[y];(0,m.hu)(0===R.status,"tryToSendTransactionQueue_: items in queue should all be run."),R.status=1,R.retryCount++;const A=ut(t,R.path);u=u.updateChild(A,R.currentOutputSnapshotRaw)}const h=u.val(!0),g=t;n.server_.put(g.toString(),h,y=>{oe(n,"transaction put response",{path:g.toString(),status:y});let R=[];if("ok"===y){const A=[];for(let O=0;O<e.length;O++)e[O].status=2,R=R.concat(En(n.serverSyncTree_,e[O].currentWriteId)),e[O].onComplete&&A.push(()=>e[O].onComplete(null,!0,e[O].currentOutputSnapshotResolved)),e[O].unwatcher();qr(n,Mi(n.transactionQueueTree_,t)),Bt(n,n.transactionQueueTree_),At(n.eventQueue_,t,R);for(let O=0;O<A.length;O++)ft(A[O])}else{if("datastale"===y)for(let A=0;A<e.length;A++)e[A].status=3===e[A].status?4:0;else{Be("transaction at "+g.toString()+" failed: "+y);for(let A=0;A<e.length;A++)e[A].status=4,e[A].abortReason=y}Wn(n,t)}},c)}(n,Br(t),e)}else go(t)&&lr(t,e=>{Bt(n,e)})}function Wn(n,t){const e=Fs(n,t),i=Br(e);return function(n,t,e){if(0===t.length)return;const i=[];let o=[];const c=t.filter(h=>0===h.status).map(h=>h.currentWriteId);for(let h=0;h<t.length;h++){const g=t[h],y=ut(e,g.path);let A,R=!1;if((0,m.hu)(null!==y,"rerunTransactionsUnderNode_: relativePath should not be null."),4===g.status)R=!0,A=g.abortReason,o=o.concat(En(n.serverSyncTree_,g.currentWriteId,!0));else if(0===g.status)if(g.retryCount>=25)R=!0,A="maxretry",o=o.concat(En(n.serverSyncTree_,g.currentWriteId,!0));else{const O=St(n,g.path,c);g.currentInputSnapshot=O;const Q=t[h].update(O.val());if(void 0!==Q){zr("transaction failed: Data returned ",Q,g.path);let ae=W(Q);"object"==typeof Q&&null!=Q&&(0,m.r3)(Q,".priority")||(ae=ae.updatePriority(O.getPriority()));const mt=g.currentWriteId,Sa=Fi(n),No=Di(ae,O,Sa);g.currentOutputSnapshotRaw=ae,g.currentOutputSnapshotResolved=No,g.currentWriteId=Wi(n),c.splice(c.indexOf(mt),1),o=o.concat(gs(n.serverSyncTree_,g.path,No,g.currentWriteId,g.applyLocally)),o=o.concat(En(n.serverSyncTree_,mt,!0))}else R=!0,A="nodata",o=o.concat(En(n.serverSyncTree_,g.currentWriteId,!0))}At(n.eventQueue_,e,o),o=[],R&&(t[h].status=2,setTimeout(t[h].unwatcher,Math.floor(0)),t[h].onComplete&&i.push("nodata"===A?()=>t[h].onComplete(null,!1,t[h].currentInputSnapshot):()=>t[h].onComplete(new Error(A),!1,null)))}qr(n,n.transactionQueueTree_);for(let h=0;h<i.length;h++)ft(i[h]);Bt(n,n.transactionQueueTree_)}(n,Us(n,e),i),i}function Fs(n,t){let e,i=n.transactionQueueTree_;for(e=ge(t);null!==e&&void 0===Tn(i);)i=Mi(i,e),e=ge(t=Oe(t));return i}function Us(n,t){const e=[];return Vi(n,t,e),e.sort((i,o)=>i.order-o.order),e}function Vi(n,t,e){const i=Tn(t);if(i)for(let o=0;o<i.length;o++)e.push(i[o]);lr(t,o=>{Vi(n,o,e)})}function qr(n,t){const e=Tn(t);if(e){let i=0;for(let o=0;o<e.length;o++)2!==e[o].status&&(e[i]=e[o],i++);e.length=i,Li(t,e.length>0?e:void 0)}lr(t,i=>{qr(n,i)})}function Bi(n,t){const e=Br(Fs(n,t)),i=Mi(n.transactionQueueTree_,t);return function(n,t,e){let i=n.parent;for(;null!==i;){if(t(i))return!0;i=i.parent}}(i,o=>{Kr(n,o)}),Kr(n,i),yo(i,o=>{Kr(n,o)}),e}function Kr(n,t){const e=Tn(t);if(e){const i=[];let o=[],u=-1;for(let c=0;c<e.length;c++)3===e[c].status||(1===e[c].status?((0,m.hu)(u===c-1,"All SENT items should be at beginning of queue."),u=c,e[c].status=3,e[c].abortReason="set"):((0,m.hu)(0===e[c].status,"Unexpected transaction status in abort"),e[c].unwatcher(),o=o.concat(En(n.serverSyncTree_,e[c].currentWriteId,!0)),e[c].onComplete&&i.push(e[c].onComplete.bind(null,new Error("set"),!1,null))));-1===u?Li(t,void 0):e.length=u+1,At(n.eventQueue_,Br(t),o);for(let c=0;c<i.length;c++)ft(i[c])}}const Yr=function(n,t){const e=Ca(n),i=e.namespace;return"firebase.com"===e.domain&&Ee(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||"undefined"===i)&&"localhost"!==e.domain&&Ee("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Be("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new Ke(e.host,e.secure,i,t,"ws"===e.scheme||"wss"===e.scheme,"",i!==e.subdomain),path:new Ne(e.pathString)}},Ca=function(n){let t="",e="",i="",o="",u="",c=!0,h="https",g=443;if("string"==typeof n){let y=n.indexOf("//");y>=0&&(h=n.substring(0,y-1),n=n.substring(y+2));let R=n.indexOf("/");-1===R&&(R=n.length);let A=n.indexOf("?");-1===A&&(A=n.length),t=n.substring(0,Math.min(R,A)),R<A&&(o=function(n){let t="";const e=n.split("/");for(let i=0;i<e.length;i++)if(e[i].length>0){let o=e[i];try{o=decodeURIComponent(o.replace(/\+/g," "))}catch(u){}t+="/"+o}return t}(n.substring(R,A)));const O=function(n){const t={};"?"===n.charAt(0)&&(n=n.substring(1));for(const e of n.split("&")){if(0===e.length)continue;const i=e.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):Be(`Invalid query segment '${e}' in query '${n}'`)}return t}(n.substring(Math.min(n.length,A)));y=t.indexOf(":"),y>=0?(c="https"===h||"wss"===h,g=parseInt(t.substring(y+1),10)):y=t.length;const Q=t.slice(0,y);if("localhost"===Q.toLowerCase())e="localhost";else if(Q.split(".").length<=2)e=Q;else{const ae=t.indexOf(".");i=t.substring(0,ae).toLowerCase(),e=t.substring(ae+1),u=i}"ns"in O&&(u=O.ns)}return{host:t,port:g,domain:e,subdomain:i,secure:c,scheme:h,pathString:o,namespace:u}};class Ha{constructor(t,e,i,o){this.eventType=t,this.eventRegistration=e,this.snapshot=i,this.prevName=o}getPath(){const t=this.snapshot.ref;return"value"===this.eventType?t._path:t.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+(0,m.Pz)(this.snapshot.exportVal())}}class ja{constructor(t,e,i){this.eventRegistration=t,this.error=e,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class za{constructor(t,e){this.snapshotCallback=t,this.cancelCallback=e}onValue(t,e){this.snapshotCallback.call(null,t,e)}onCancel(t){return(0,m.hu)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,t)}get hasCancelCallback(){return!!this.cancelCallback}matches(t){return this.snapshotCallback===t.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===t.snapshotCallback.userCallback&&this.snapshotCallback.context===t.snapshotCallback.context}}class Ht{constructor(t,e,i,o){this._repo=t,this._path=e,this._queryParams=i,this._orderByCalled=o}get key(){return _e(this._path)?null:mr(this._path)}get ref(){return new un(this._repo,this._path)}get _queryIdentifier(){const t=ci(this._queryParams),e=je(t);return"{}"===e?"default":e}get _queryObject(){return ci(this._queryParams)}isEqual(t){if(!((t=(0,m.m9)(t))instanceof Ht))return!1;const e=this._repo===t._repo,i=Ot(this._path,t._path);return e&&i&&this._queryIdentifier===t._queryIdentifier}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(n){let t="";for(let e=n.pieceNum_;e<n.pieces_.length;e++)""!==n.pieces_[e]&&(t+="/"+encodeURIComponent(String(n.pieces_[e])));return t||"/"}(this._path)}}class un extends Ht{constructor(t,e){super(t,e,new Ar,!1)}get parent(){const t=Yn(this._path);return null===t?null:new un(this._repo,t)}get root(){let t=this;for(;null!==t.parent;)t=t.parent;return t}}class Zr{constructor(t,e,i){this._node=t,this.ref=e,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(t){const e=new Ne(t),i=Qr(this.ref,t);return new Zr(this._node.getChild(e),i,Me)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(t){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(i,o)=>t(new Zr(o,Qr(this.ref,i),Me)))}hasChild(t){const e=new Ne(t);return!this._node.getChild(e).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function $a(n,t){return(n=(0,m.m9)(n))._checkNotDeleted("ref"),void 0!==t?Qr(n._root,t):n._root}function Qr(n,t){return null===ge((n=(0,m.m9)(n))._path)?((e=t)&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Ns("child","path",e,!1)):Ns("child","path",t,!1),new un(n._repo,We(n._path,t));var e}function Ja(n,t){n=(0,m.m9)(n),Yt("push",n._path),Kt("push",t,n._path,!0);const e=Co(n._repo),i=bt(e),o=Qr(n,i),u=Qr(n,i);let c;return c=null!=t?ba(u,t).then(()=>u):Promise.resolve(u),o.then=c.then.bind(c),o.catch=c.then.bind(c,void 0),o}function ba(n,t){n=(0,m.m9)(n),Yt("set",n._path),Kt("set",t,n._path,!1);const e=new m.BH;return Ms(n._repo,n._path,t,null,e.wrapCallback(()=>{})),e.promise}function Xa(n){return function(n,t){const e=function(n,t){const e=t._path;let i=null;n.syncPointTree_.foreachOnPath(e,(y,R)=>{const A=ut(y,e);i=i||qt(R,A)});let o=n.syncPointTree_.get(e);o?i=i||qt(o,be()):(o=new uo,n.syncPointTree_=n.syncPointTree_.set(e,o));const u=null!=i,c=u?new In(i,!0,!1):null;return function(n){return mi(n.viewCache_)}(Ci(o,t,yi(n.pendingWriteTree_,t._path),u?c.getNode():_.EMPTY_NODE,u))}(n.serverSyncTree_,t);return null!=e?Promise.resolve(e):n.server_.get(t).then(i=>{const o=W(i).withIndex(t._queryParams.getIndex()),u=Si(n.serverSyncTree_,t._path,o);return ks(n.eventQueue_,t._path,u),Promise.resolve(o)},i=>(oe(n,"get for query "+(0,m.Pz)(t)+" failed: "+i),Promise.reject(new Error(i))))}((n=(0,m.m9)(n))._repo,n).then(t=>new Zr(t,new un(n._repo,n._path),n._queryParams.getIndex()))}class Ro{constructor(t){this.callbackContext=t}respondsTo(t){return"value"===t}createEvent(t,e){const i=e._queryParams.getIndex();return new Ha("value",this,new Zr(t.snapshotNode,new un(e._repo,e._path),i))}getEventRunner(t){return"cancel"===t.getEventType()?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,null)}createCancelEvent(t,e){return this.callbackContext.hasCancelCallback?new ja(this,t,e):null}matches(t){return t instanceof Ro&&(!t.callbackContext||!this.callbackContext||t.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class Po{constructor(t,e){this.eventType=t,this.callbackContext=e}respondsTo(t){let e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,this.eventType===e}createCancelEvent(t,e){return this.callbackContext.hasCancelCallback?new ja(this,t,e):null}createEvent(t,e){(0,m.hu)(null!=t.childName,"Child events should have a childName.");const i=Qr(new un(e._repo,e._path),t.childName),o=e._queryParams.getIndex();return new Ha(t.type,this,new Zr(t.snapshotNode,i,o),t.prevName)}getEventRunner(t){return"cancel"===t.getEventType()?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,t.prevName)}matches(t){return t instanceof Po&&this.eventType===t.eventType&&(!this.callbackContext||!t.callbackContext||this.callbackContext.matches(t.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function qa(n,t,e,i){return function(n,t,e,i,o){let u;if("object"==typeof i&&(u=void 0,o=i),"function"==typeof i&&(u=i),o&&o.onlyOnce){const g=e,y=(R,A)=>{b(n._repo,n,h),g(R,A)};y.userCallback=e.userCallback,y.context=e.context,e=y}const c=new za(e,u||void 0),h="value"===t?new Ro(c):new Po(t,c);return function(n,t,e){let i;i=".info"===ge(t._path)?Ri(n.infoSyncTree_,t,e):Ri(n.serverSyncTree_,t,e),ks(n.eventQueue_,t._path,i)}(n._repo,n,h),()=>b(n._repo,n,h)}(n,"value",t,e,i)}(function(n){(0,m.hu)(!Ur,"__referenceConstructor has already been defined"),Ur=n})(un),function(n){(0,m.hu)(!_s,"__referenceConstructor has already been defined"),_s=n}(un);const Aa={};function dl(n,t,e,i,o){let u=i||n.options.databaseURL;void 0===u&&(n.options.projectId||Ee("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),he("Using default host for project ",n.options.projectId),u=`${n.options.projectId}-default-rtdb.firebaseio.com`);let g,y,c=Yr(u,o),h=c.repoInfo;"undefined"!=typeof process&&(y=process.env.FIREBASE_DATABASE_EMULATOR_HOST),y?(g=!0,u=`http://${y}?ns=${h.namespace}`,c=Yr(u,o),h=c.repoInfo):g=!c.repoInfo.secure;const R=o&&g?new gt(gt.OWNER):new dn(n.name,n.options,t);(function(n,t){const e=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Fn(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==e.length&&!function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Io(n)}(e))throw new Error((0,m.gK)(n,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')})("Invalid Firebase Database URL",c),_e(c.path)||Ee("Database URL must point to the root of a Firebase Database (not including a child path).");const A=function(n,t,e,i){let o=Aa[t.name];o||(o={},Aa[t.name]=o);let u=o[n.toURLString()];return u&&Ee("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),u=new xs(n,false,e,i),o[n.toURLString()]=u,u}(h,n,R,new dt(n.name,e));return new _l(A,n)}class _l{constructor(t,e){this._repoInternal=t,this.app=e,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(function(n,t,e){if(n.stats_=Xt(n.repoInfo_),n.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)n.server_=new di(n.repoInfo_,(i,o,u,c)=>{Ui(n,i,o,u,c)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>va(n,!0),0);else{if(null!=e){if("object"!=typeof e)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,m.Pz)(e)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new Dt(n.repoInfo_,t,(i,o,u,c)=>{Ui(n,i,o,u,c)},i=>{va(n,i)},i=>{!function(n,t){ce(t,(e,i)=>{Ds(n,e,i)})}(n,i)},n.authTokenProvider_,n.appCheckProvider_,e),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=function(n,t){const e=n.toString();return Nt[e]||(Nt[e]=t()),Nt[e]}(n.repoInfo_,()=>new rs(n.stats_,n.server_)),n.infoData_=new Xi,n.infoSyncTree_=new ho({startListening:(i,o,u,c)=>{let h=[];const g=n.infoData_.getNode(i._path);return g.isEmpty()||(h=Si(n.infoSyncTree_,i._path,g),setTimeout(()=>{c("ok")},0)),h},stopListening:()=>{}}),Ds(n,"connected",!1),n.serverSyncTree_=new ho({startListening:(i,o,u,c)=>(n.server_.listen(i,u,o,(h,g)=>{const y=c(h,g);At(n.eventQueue_,i._path,y)}),[]),stopListening:(i,o)=>{n.server_.unlisten(i,o)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new un(this._repo,be())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(n,t){const e=Aa[t];(!e||e[n.key]!==n)&&Ee(`Database ${t}(${n.repoInfo_}) has already been deleted.`),function(n){n.persistentConnection_&&n.persistentConnection_.interrupt("repo_interrupt")}(n),delete e[n.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(t){null===this._rootInternal&&Ee("Cannot call "+t+" on a deleted database.")}}function ml(n=(0,V.Mq)(),t){return(0,V.qX)(n,"database").getImmediate({identifier:t})}class vl{constructor(t,e){this.committed=t,this.snapshot=e}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function Il(n,t,e){var i;if(n=(0,m.m9)(n),Yt("Reference.transaction",n._path),".length"===n.key||".keys"===n.key)throw"Reference.transaction failed: "+n.key+" is a read-only object.";const o=null===(i=null==e?void 0:e.applyLocally)||void 0===i||i,u=new m.BH,h=qa(n,()=>{});return function(n,t,e,i,o,u){oe(n,"transaction on "+t);const c={path:t,update:e,onComplete:i,status:null,order:we(),applyLocally:u,retryCount:0,unwatcher:o,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},h=St(n,t,void 0);c.currentInputSnapshot=h;const g=c.update(h.val());if(void 0===g)c.unwatcher(),c.currentOutputSnapshotRaw=null,c.currentOutputSnapshotResolved=null,c.onComplete&&c.onComplete(null,!1,c.currentInputSnapshot);else{zr("transaction failed: Data returned ",g,c.path),c.status=0;const y=Mi(n.transactionQueueTree_,t),R=Tn(y)||[];let A;R.push(c),Li(y,R),"object"==typeof g&&null!==g&&(0,m.r3)(g,".priority")?(A=(0,m.DV)(g,".priority"),(0,m.hu)(function(n){return null===n||"string"==typeof n||"number"==typeof n&&!D(n)||n&&"object"==typeof n&&(0,m.r3)(n,".sv")}(A),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):A=(Pi(n.serverSyncTree_,t)||_.EMPTY_NODE).getPriority().val();const O=Fi(n),Q=W(g,A),ae=Di(Q,h,O);c.currentOutputSnapshotRaw=Q,c.currentOutputSnapshotResolved=ae,c.currentWriteId=Wi(n);const Ge=gs(n.serverSyncTree_,t,ae,c.currentWriteId,c.applyLocally);At(n.eventQueue_,t,Ge),Bt(n,n.transactionQueueTree_)}}(n._repo,n._path,t,(g,y,R)=>{let A=null;g?u.reject(g):(A=new Zr(R,new un(n._repo,n._path),Me),u.resolve(new vl(y,A)))},h,o),u.promise}Dt.prototype.simpleListen=function(n,t){this.sendRequest("q",{p:n},t)},Dt.prototype.echo=function(n,t){this.sendRequest("echo",{d:n},t)},function(n){Se=n}(V.Jn),(0,V.Xd)(new me.wA("database",(t,{instanceIdentifier:e})=>dl(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"),t.getProvider("app-check-internal"),e),"PUBLIC").setMultipleInstances(!0)),(0,V.KN)("@firebase/database","0.12.0",void 0)},6676:function(Rt,Ve){!function(X){"use strict";function E(B){return Array.prototype.slice.call(B)}function V(B){return new Promise(function(Z,ee){B.onsuccess=function(){Z(B.result)},B.onerror=function(){ee(B.error)}})}function me(B,Z,ee){var te,ne=new Promise(function(he,x){V(te=B[Z].apply(B,ee)).then(he,x)});return ne.request=te,ne}function m(B,Z,ee){var te=me(B,Z,ee);return te.then(function(ne){if(ne)return new k(ne,te.request)})}function Ie(B,Z,ee){ee.forEach(function(te){Object.defineProperty(B.prototype,te,{get:function(){return this[Z][te]},set:function(ne){this[Z][te]=ne}})})}function Ue(B,Z,ee,te){te.forEach(function(ne){ne in ee.prototype&&(B.prototype[ne]=function(){return me(this[Z],ne,arguments)})})}function Ae(B,Z,ee,te){te.forEach(function(ne){ne in ee.prototype&&(B.prototype[ne]=function(){return this[Z][ne].apply(this[Z],arguments)})})}function Se(B,Z,ee,te){te.forEach(function(ne){ne in ee.prototype&&(B.prototype[ne]=function(){return m(this[Z],ne,arguments)})})}function $(B){this._index=B}function k(B,Z){this._cursor=B,this._request=Z}function K(B){this._store=B}function H(B){this._tx=B,this.complete=new Promise(function(Z,ee){B.oncomplete=function(){Z()},B.onerror=function(){ee(B.error)},B.onabort=function(){ee(B.error)}})}function L(B,Z,ee){this._db=B,this.oldVersion=Z,this.transaction=new H(ee)}function Y(B){this._db=B}Ie($,"_index",["name","keyPath","multiEntry","unique"]),Ue($,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),Se($,"_index",IDBIndex,["openCursor","openKeyCursor"]),Ie(k,"_cursor",["direction","key","primaryKey","value"]),Ue(k,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(B){B in IDBCursor.prototype&&(k.prototype[B]=function(){var Z=this,ee=arguments;return Promise.resolve().then(function(){return Z._cursor[B].apply(Z._cursor,ee),V(Z._request).then(function(te){if(te)return new k(te,Z._request)})})})}),K.prototype.createIndex=function(){return new $(this._store.createIndex.apply(this._store,arguments))},K.prototype.index=function(){return new $(this._store.index.apply(this._store,arguments))},Ie(K,"_store",["name","keyPath","indexNames","autoIncrement"]),Ue(K,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),Se(K,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),Ae(K,"_store",IDBObjectStore,["deleteIndex"]),H.prototype.objectStore=function(){return new K(this._tx.objectStore.apply(this._tx,arguments))},Ie(H,"_tx",["objectStoreNames","mode"]),Ae(H,"_tx",IDBTransaction,["abort"]),L.prototype.createObjectStore=function(){return new K(this._db.createObjectStore.apply(this._db,arguments))},Ie(L,"_db",["name","version","objectStoreNames"]),Ae(L,"_db",IDBDatabase,["deleteObjectStore","close"]),Y.prototype.transaction=function(){return new H(this._db.transaction.apply(this._db,arguments))},Ie(Y,"_db",["name","version","objectStoreNames"]),Ae(Y,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(B){[K,$].forEach(function(Z){B in Z.prototype&&(Z.prototype[B.replace("open","iterate")]=function(){var ee=E(arguments),te=ee[ee.length-1],ne=this._store||this._index,he=ne[B].apply(ne,ee.slice(0,-1));he.onsuccess=function(){te(he.result)}})})}),[$,K].forEach(function(B){B.prototype.getAll||(B.prototype.getAll=function(Z,ee){var te=this,ne=[];return new Promise(function(he){te.iterateCursor(Z,function(x){x?(ne.push(x.value),void 0===ee||ne.length!=ee?x.continue():he(ne)):he(ne)})})})}),X.openDb=function(B,Z,ee){var te=me(indexedDB,"open",[B,Z]),ne=te.request;return ne&&(ne.onupgradeneeded=function(he){ee&&ee(new L(ne.result,he.oldVersion,ne.transaction))}),te.then(function(he){return new Y(he)})},X.deleteDb=function(B){return me(indexedDB,"deleteDatabase",[B])},Object.defineProperty(X,"__esModule",{value:!0})}(Ve)},5639:(Rt,Ve,X)=>{"use strict";X.d(Ve,{a:()=>m});var E=X(639),V=X(5528),me=X(6945);let m=(()=>{class Ie{constructor(Ae,Se){this.router=Ae,this.storageService=Se}canActivate(Ae,Se){return"/auth/login"===Se.url?!this.storageService.localActiveUser(!1)||(this.router.navigate(["/"]),!1):"/home"===Se.url||"/chat"===Se.url||Se.url?!!this.storageService.localActiveUser(!1)||(this.router.navigate(["auth/login"]),!1):void 0}}return Ie.\u0275fac=function(Ae){return new(Ae||Ie)(E.LFG(V.F0),E.LFG(me.V))},Ie.\u0275prov=E.Yz7({token:Ie,factory:Ie.\u0275fac,providedIn:"root"}),Ie})()},6945:(Rt,Ve,X)=>{"use strict";X.d(Ve,{V:()=>Ue});var E=X(2329),V=X(3653),me=X(2340),m=X(4963),Ie=X(639);let Ue=(()=>{class Ae{constructor(){this.fireApp=(0,E.ZF)(me.N.firebaseConfig),this.analytics=(0,V.IH)(this.fireApp),this.database=(0,m.N8)(),this.onDatabase=(0,m.iH)(this.database)}saveOnDatabase($){(0,m.t8)((0,m.iH)(this.database,"users/"+$.uid),{email:$.email,password:$.password,name:$.name,img:$.img,regTime:(new Date).getTime(),pm:[]})}setLoginData($){(0,m.t8)((0,m.iH)(this.database,"users/"+$+"/lastLogin"),{loginTime:(new Date).getTime()})}getFromDatabase($){return(0,m.U2)((0,m.iU)(this.onDatabase,`users/${$}`)).then(k=>{if(k.exists())return{name:k.val().name,email:k.val().email,img:k.val().img,uid:$}}).then(k=>{localStorage.setItem("active-user",JSON.stringify(k))})}sendMessage($,k,K){(0,m.t8)((0,m.VF)((0,m.iH)(this.database,"users/"+$+"/pm/"+k)),{from:$,to:k,message:K,timeStamp:(new Date).getTime()}),(0,m.t8)((0,m.VF)((0,m.iH)(this.database,"users/"+k+"/pm/"+$)),{from:$,to:k,message:K,timeStamp:(new Date).getTime()})}getUser($){return(0,m.U2)((0,m.iU)(this.onDatabase,"users/"+$)).then(k=>({name:k.val().name,img:k.val().img}))}saveAndPost($){(0,m.t8)((0,m.VF)((0,m.iH)(this.database,"posts/")),{post:$})}localActiveUser($){return $?JSON.parse(localStorage.getItem("active-user")):localStorage.getItem("active-user")}}return Ae.\u0275fac=function($){return new($||Ae)},Ae.\u0275prov=Ie.Yz7({token:Ae,factory:Ae.\u0275fac,providedIn:"root"}),Ae})()},4762:(Rt,Ve,X)=>{"use strict";X.d(Ve,{ZT:()=>V,_T:()=>m,mG:()=>Se,Jh:()=>$,XA:()=>H,CR:()=>L,ev:()=>we});var E=function(P,D){return(E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,M){F.__proto__=M}||function(F,M){for(var q in M)Object.prototype.hasOwnProperty.call(M,q)&&(F[q]=M[q])})(P,D)};function V(P,D){if("function"!=typeof D&&null!==D)throw new TypeError("Class extends value "+String(D)+" is not a constructor or null");function F(){this.constructor=P}E(P,D),P.prototype=null===D?Object.create(D):(F.prototype=D.prototype,new F)}function m(P,D){var F={};for(var M in P)Object.prototype.hasOwnProperty.call(P,M)&&D.indexOf(M)<0&&(F[M]=P[M]);if(null!=P&&"function"==typeof Object.getOwnPropertySymbols){var q=0;for(M=Object.getOwnPropertySymbols(P);q<M.length;q++)D.indexOf(M[q])<0&&Object.prototype.propertyIsEnumerable.call(P,M[q])&&(F[M[q]]=P[M[q]])}return F}function Se(P,D,F,M){return new(F||(F=Promise))(function(G,fe){function Te(ce){try{ie(M.next(ce))}catch(ze){fe(ze)}}function je(ce){try{ie(M.throw(ce))}catch(ze){fe(ze)}}function ie(ce){ce.done?G(ce.value):function(G){return G instanceof F?G:new F(function(fe){fe(G)})}(ce.value).then(Te,je)}ie((M=M.apply(P,D||[])).next())})}function $(P,D){var M,q,G,fe,F={label:0,sent:function(){if(1&G[0])throw G[1];return G[1]},trys:[],ops:[]};return fe={next:Te(0),throw:Te(1),return:Te(2)},"function"==typeof Symbol&&(fe[Symbol.iterator]=function(){return this}),fe;function Te(ie){return function(ce){return function(ie){if(M)throw new TypeError("Generator is already executing.");for(;F;)try{if(M=1,q&&(G=2&ie[0]?q.return:ie[0]?q.throw||((G=q.return)&&G.call(q),0):q.next)&&!(G=G.call(q,ie[1])).done)return G;switch(q=0,G&&(ie=[2&ie[0],G.value]),ie[0]){case 0:case 1:G=ie;break;case 4:return F.label++,{value:ie[1],done:!1};case 5:F.label++,q=ie[1],ie=[0];continue;case 7:ie=F.ops.pop(),F.trys.pop();continue;default:if(!(G=(G=F.trys).length>0&&G[G.length-1])&&(6===ie[0]||2===ie[0])){F=0;continue}if(3===ie[0]&&(!G||ie[1]>G[0]&&ie[1]<G[3])){F.label=ie[1];break}if(6===ie[0]&&F.label<G[1]){F.label=G[1],G=ie;break}if(G&&F.label<G[2]){F.label=G[2],F.ops.push(ie);break}G[2]&&F.ops.pop(),F.trys.pop();continue}ie=D.call(P,F)}catch(ce){ie=[6,ce],q=0}finally{M=G=0}if(5&ie[0])throw ie[1];return{value:ie[0]?ie[1]:void 0,done:!0}}([ie,ce])}}}function H(P){var D="function"==typeof Symbol&&Symbol.iterator,F=D&&P[D],M=0;if(F)return F.call(P);if(P&&"number"==typeof P.length)return{next:function(){return P&&M>=P.length&&(P=void 0),{value:P&&P[M++],done:!P}}};throw new TypeError(D?"Object is not iterable.":"Symbol.iterator is not defined.")}function L(P,D){var F="function"==typeof Symbol&&P[Symbol.iterator];if(!F)return P;var q,fe,M=F.call(P),G=[];try{for(;(void 0===D||D-- >0)&&!(q=M.next()).done;)G.push(q.value)}catch(Te){fe={error:Te}}finally{try{q&&!q.done&&(F=M.return)&&F.call(M)}finally{if(fe)throw fe.error}}return G}function we(P,D,F){if(F||2===arguments.length)for(var G,M=0,q=D.length;M<q;M++)(G||!(M in D))&&(G||(G=Array.prototype.slice.call(D,0,M)),G[M]=D[M]);return P.concat(G||Array.prototype.slice.call(D))}},8239:(Rt,Ve,X)=>{"use strict";function E(me,m,Ie,Ue,Ae,Se,$){try{var k=me[Se]($),K=k.value}catch(H){return void Ie(H)}k.done?m(K):Promise.resolve(K).then(Ue,Ae)}function V(me){return function(){var m=this,Ie=arguments;return new Promise(function(Ue,Ae){var Se=me.apply(m,Ie);function $(K){E(Se,Ue,Ae,$,k,"next",K)}function k(K){E(Se,Ue,Ae,$,k,"throw",K)}$(void 0)})}}X.d(Ve,{Z:()=>V})}}]);